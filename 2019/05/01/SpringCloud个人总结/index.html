<!DOCTYPE html>



  




<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
<script>
    (function(){
        if(''){
            if (prompt('OOPS, 主人请输入文章密码才能够观看哟') !== ''){
                alert('哎呀，密码错误哟！');
                history.back();
            }
        }
    })();
</script>


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|40:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="分布式,springcloud,微服务架构," />





  <link rel="alternate" href="/atom.xml" title="King哥" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="一下内容就是个人学习sc微服务架构中的学习总结，整个架构的东西很多，大家可以在需要某个组件时再去学习。 一、为什么需要微服务 我么那首先思考下面这些问题，为什么需要微服务，微服务能够解决什么痛点，它有什么优缺点？微服务和微服务架构是什么关系？什么是分布式？什么是集群？为了解决这些问题我们得从实现一个系统的架构的到底发生了那些演变说起。 1.1分布式的演化 1.1.1单一应用架构当网站流量很小时，只">
<meta name="keywords" content="分布式,springcloud,微服务架构">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud个人总结">
<meta property="og:url" content="http://kingge.top/2019/05/01/SpringCloud个人总结/index.html">
<meta property="og:site_name" content="King哥">
<meta property="og:description" content="一下内容就是个人学习sc微服务架构中的学习总结，整个架构的东西很多，大家可以在需要某个组件时再去学习。 一、为什么需要微服务 我么那首先思考下面这些问题，为什么需要微服务，微服务能够解决什么痛点，它有什么优缺点？微服务和微服务架构是什么关系？什么是分布式？什么是集群？为了解决这些问题我们得从实现一个系统的架构的到底发生了那些演变说起。 1.1分布式的演化 1.1.1单一应用架构当网站流量很小时，只">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-07-20.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-10-27.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-15-13.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-28-15.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-32-41.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1525530804753.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1526860071166.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Topic17NotesImage48.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-01-12.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1525573702492.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-08-43.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-09-14.png">
<meta property="og:image" content="http://kingge.top/SpringCloud个人总结/1525575656796.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1528263985902.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1528263942152.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-24-07.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image003.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image005.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image007.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image008.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image010.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image012.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image014.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image015.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image017.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image018.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image019.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image020.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image021.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image023.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image024.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image025.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image027.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image029.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image030.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image032.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1565962178357.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image034.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image036.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image038.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-17_11-15-12.png">
<meta property="og:image" content="http://kingge.top/SpringCloud个人总结/1525597885059.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1565961802586.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-17_11-16-35.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/65963220408.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/966479080.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/963618268.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/565964019636.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/565964513626.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/64617801.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1565965118437.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1528696142799.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1525618396076.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1565967990809.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1565968096288.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1565968242592.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1565970421791.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1565970941327.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/565971841015.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1565972117167.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/963618212368.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566008410173.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566008463016.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/6009325282.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566008980542.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/66009196970.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566009240467.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/6009501569.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/6009599956.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566009617535.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566009632534.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566009826135.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566009838479.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566009865015.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566010881201.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566011120741.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566011157293.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/6011173416.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/66011196418.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566011028903.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566012847807.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566013203247.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1528776489965.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/66013476262.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566013958604.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566014122746.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622320277.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566014544201.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566015460435.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622652849.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622699666.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622754316.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622817451.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1528782624098.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566022083352.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/19186732.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566019594262.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566019672480.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/19186732.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566021323120.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566021621272.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566021993675.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566106445678.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566106480369.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566106719992.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image0ee02.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image0ee04.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566107268418.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566108827974.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566108849361.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/646178ttttt01.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/64rrrttt01.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/565964513rrr626.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/6009599rrr956.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566145616539.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566146282120.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-36-15.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-46-55.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-49-56.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/dashbnoars.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-53-58.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566221714611.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/njl002.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image0yy04.png">
<meta property="og:image" content="file:///C:/Users/JEREMY~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566226205578.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/566222721701.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566222752232.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/C1566223608884.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_image002yyyy.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/clip_imaggggge004.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566226606544.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/5C1566226821375.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566226885002.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_09-42-33.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_09-59-45.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-01-44.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-06-13.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-08-51.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-09-16.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-18-53.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-23-00.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-23-19.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Topic578NotesImage5.jpg">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_11-07-11.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_11-05-27.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566377247710.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566377271635.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566379397446.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566379561052.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/1566379675277.png">
<meta property="og:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/asdfafd.png">
<meta property="og:updated_time" content="2019-08-25T04:44:06.310Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringCloud个人总结">
<meta name="twitter:description" content="一下内容就是个人学习sc微服务架构中的学习总结，整个架构的东西很多，大家可以在需要某个组件时再去学习。 一、为什么需要微服务 我么那首先思考下面这些问题，为什么需要微服务，微服务能够解决什么痛点，它有什么优缺点？微服务和微服务架构是什么关系？什么是分布式？什么是集群？为了解决这些问题我们得从实现一个系统的架构的到底发生了那些演变说起。 1.1分布式的演化 1.1.1单一应用架构当网站流量很小时，只">
<meta name="twitter:image" content="http://kingge.top/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-07-20.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://kingge.top/2019/05/01/SpringCloud个人总结/"/>





  <title>SpringCloud个人总结 | King哥</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">King哥</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">To know everything, no words don't talk, listening to people is enough to cause alarm（知无不言，言无不尽 言者无罪，闻者足戒）</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-picture">
          <a href="/picture/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-camera"></i> <br />
            
            照片
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingge.top/2019/05/01/SpringCloud个人总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeremy Kinge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King哥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">SpringCloud个人总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-01T10:21:59+08:00">
                2019-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springcloud/" itemprop="url" rel="index">
                    <span itemprop="name">springcloud</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  31,204
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  125
                </span>
              
            </div>
          

          

		  
		  
        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>一下内容就是个人学习sc微服务架构中的学习总结，整个架构的东西很多，大家可以在需要某个组件时再去学习。</p>
<p>一、为什么需要微服务</p>
<p>我么那首先思考下面这些问题，为什么需要微服务，微服务能够解决什么痛点，它有什么优缺点？微服务和微服务架构是什么关系？什么是分布式？什么是集群？为了解决这些问题我们得从实现一个系统的架构的到底发生了那些演变说起。</p>
<h2 id="1-1分布式的演化"><a href="#1-1分布式的演化" class="headerlink" title="1.1分布式的演化"></a>1.1分布式的演化</h2><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-07-20.png" alt=""></p>
<h3 id="1-1-1单一应用架构"><a href="#1-1-1单一应用架构" class="headerlink" title="1.1.1单一应用架构"></a>1.1.1单一应用架构</h3><p>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-10-27.png" alt=""></p>
<p>优点：</p>
<blockquote>
<p>适用于小型网站，小型管理系统，将所有功能都部署到一个工程里，简单易用，易于开发</p>
</blockquote>
<p>缺点：</p>
<blockquote>
<p>  1、性能扩展比较难 </p>
<p>  2、协同开发问题</p>
<p>  3、不利于升级维护</p>
<p>  4、  只能采用同一种技术，很难用不同的语言或者语言不同版本开发不同模块；</p>
<p>  5、系统耦合性强，一旦其中一个模块有问题，整个系统就瘫痪了；一旦升级其中一个模块，整个系统就停机了；</p>
<p>  6、  <strong>集群只能是复制整个系统，即使只是其中一个模块压力大</strong>。（可能整个订单处理，仅仅是支付模块压力过大，按道理只需要升级支付模块，但是在单一场景里面是不能的）</p>
</blockquote>
<p>那么这个时候我么那肯定产生了想法，就是把所有功能模块切开，分而治之，那么就演变成了下面的架构。</p>
<h3 id="1-1-2-垂直应用架构"><a href="#1-1-2-垂直应用架构" class="headerlink" title="1.1.2 垂直应用架构"></a>1.1.2 垂直应用架构</h3><pre><code>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用**拆成互不相干**的几个应用，以提升效率，**这样就可以单独修改某个模块而不用重启或者影响其他模块，同时也可以给某个访问量剧增的模块，单独添加服务器部署集群**。此时，用于加速前端页面开发的Web框架(MVC)是关键。
</code></pre><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-15-13.png" alt=""></p>
<pre><code>通过切分业务来实现各个模块独立部署，降低了维护和部署的难度，团队各司其职更易管理，性能扩展也更方便，更有针对性。
</code></pre><p>缺点： </p>
<blockquote>
<p>公用模块无法重复利用，开发性的浪费（存在重复开发的问题）</p>
<p>面对突变的应用场景，可能某个模块对于web界面会频繁修改，但是模块业务功能没有变化，这样会造成单个应用频繁修改。所以需要<strong>界面+业务逻辑的实现分离。</strong></p>
<p>没有处理好应用之间的交互问题，系统之间相互独立，例如订单模块可能会需要查询商品模块的信息。</p>
</blockquote>
<p>这个时候，虽然切分了各个模块，但是没有很好地考虑到服务之间的引用等等问题。</p>
<h3 id="1-1-3-分布式服务架构"><a href="#1-1-3-分布式服务架构" class="headerlink" title="1.1.3 分布式服务架构"></a>1.1.3 分布式服务架构</h3><p>当垂直应用越来越多，<strong>应用之间交互不可避免</strong>，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的<strong>分布式服务框架(RPC)是关键。</strong></p>
<p>例如我们常见的springcloud和dubbo就是属于分布式服务架构，但是严格上来讲dubbo并不是属于分布式架构，因为他并不具备分布式架构的某些特性，例如服务的分布式配置，服务网关，数据流，批量任务等等。一般认为Dubbo只是相当于SpringCloud中的Eureka模块（服务注册中心）</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-28-15.png" alt=""></p>
<p><a href=""><strong>分布式服务框架很好的解决了垂直应用架构的缺点，实现界面和服务的分离，实现界面和服务，以及服务与服务之间的调度。</strong></a></p>
<pre><code>但是存在问题，那就是没有一个**统一管理服务的机制和基于访问压力的调度中心(服务注册中心，负载均衡)**，容易造成资源浪费，什么意思呢？假设用户服务部署了200台服务器，但是在某个时间段，他的访问压力很小，订单服务的访问压力剧增，服务器不够用。那么就会造成资源浪费和倾斜，存在服务器闲置或者请求量少的情况。
</code></pre><h3 id="1-1-4-流动计算架构"><a href="#1-1-4-流动计算架构" class="headerlink" title="1.1.4 流动计算架构"></a>1.1.4 流动计算架构</h3><p>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个<strong>调度中心</strong>基于访问压力实时管理集群容量，提高集群利用率。此时，用于<strong>提高机器利用率的资源调度和治理中心</strong>(SOA)<a href="">Service Oriented Architecture]</a><strong>是关键</strong>。</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_15-32-41.png" alt=""></p>
<p><img src="/2019/05/01/SpringCloud个人总结/1525530804753.png" alt="1525530804753"></p>
<p>以前出现了什么问题？</p>
<ul>
<li>服务越来越多，需要管理每个服务的地址</li>
<li>调用关系错综复杂，难以理清依赖关系</li>
<li>服务过多，服务状态难以管理，无法根据服务情况动态管理</li>
</ul>
<p>服务治理要做什么？</p>
<ul>
<li>服务注册中心，实现服务自动注册和发现，无需人为记录服务地址</li>
<li>服务自动订阅，服务列表自动推送，服务调用透明化，无需关心依赖关系</li>
<li>动态监控服务状态监控报告，人为控制服务状态</li>
</ul>
<p>缺点：</p>
<ul>
<li>服务间会有依赖关系，一旦某个环节出错会影响较大</li>
<li>服务关系复杂，运维、测试部署困难，不符合DevOps思想</li>
</ul>
<p></p>
<h3 id="1-1-5-微服务架构"><a href="#1-1-5-微服务架构" class="headerlink" title="1.1.5 微服务架构"></a>1.1.5 微服务架构</h3><p>前面说的SOA，英文翻译过来是面向服务。微服务，似乎也是服务，都是对系统进行拆分。因此两者非常容易混淆，但其实却有一些差别：</p>
<p>微服务的特点：</p>
<ul>
<li>单一职责：微服务中每一个服务都对应唯一的业务能力，做到单一职责</li>
<li>微：微服务的服务拆分粒度很小，例如一个用户管理就可以作为一个服务。每个服务虽小，但“五脏俱全”。</li>
<li>面向服务：面向服务是说每个服务都要对外暴露Rest风格服务接口API。并不关心服务的技术实现，做到与平台和语言无关，也不限定用什么技术实现，只要提供Rest的接口即可。</li>
<li>自治：自治是说服务间互相独立，互不干扰<ul>
<li>团队独立：每个服务都是一个独立的开发团队，人数不能过多。</li>
<li>技术独立：因为是面向服务，提供Rest接口，使用什么技术没有别人干涉</li>
<li>前后端分离：采用前后端分离开发，提供统一Rest接口，后端不用再为PC、移动段开发不同接口</li>
<li>数据库分离：每个服务都使用自己的数据源</li>
<li>部署独立，服务间虽然有调用，但要做到服务重启不影响其它服务。有利于持续集成和持续交付。每个服务都是独立的组件，可复用，可替换，降低耦合，易维护</li>
</ul>
</li>
</ul>
<p>微服务结构图：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1526860071166.png" alt="1526860071166"></p>
<h2 id="1-2-基本概念梳理"><a href="#1-2-基本概念梳理" class="headerlink" title="1.2 基本概念梳理"></a>1.2 基本概念梳理</h2><blockquote>
<p>分布式：一个业务分拆多个子业务，部署在不同的服务器上</p>
<p>集群：  同一个业务，部署在多个服务器上</p>
<p>微服务： 微服务化的核心就是<strong>将传统的一站式应用,根据业务拆分成一个一个的服务</strong>,彻底地去耦合,每一个微服务提供<strong>单个业务功能的服务</strong>,一个服务做一件事,从技术角度看就是一种小而独立的处理过程,类似进程概念,能够自行单独启动或销毁，可以拥有自己独立的数据库。（我们之前使用springboot开发的项目就是属于一个微服务，他是单一进程，处理单一服务。-<strong>他关注的是单一业务的实现细节</strong>）    </p>
<p>微服务架构：微服务架构是一种架构模式,它提倡将单一应用程序划分成一组小的服务,服务之间互相协调、互相配合,为用户提供最终价值.每个服务运行在其独立的进程中,服务与服务间采用轻量级的通信机制互相协作(通常是基于HTTP协议的RESTful API).每个服务都围绕着具体业务进行构建,并且能够被独立的部署到生产环境、类生产环境等.另外,应当尽量避免统一的、集中式的服务管理机制,对具体的一个服务而言,应根据业务上下文,选择合适的语言、工具对其进行构建.（springcloud就是一个微服务架构，通过一系列措施，管理微服务，实现系统整体的功能-<strong>他关注的是整体项目的实现和架构</strong>）</p>
</blockquote>
<p>微服务提出者：马丁.福勒(Martin Fowler) </p>
<p>论文网址:<a href="https://martinfowler.com/articles/microservices.html" target="_blank" rel="external">https://martinfowler.com/articles/microservices.html</a></p>
<p>​    </p>
<p><img src="/2019/05/01/SpringCloud个人总结/Topic17NotesImage48.jpg" alt=""></p>
<h2 id="1-3-微服务优缺点"><a href="#1-3-微服务优缺点" class="headerlink" title="1.3 微服务优缺点"></a>1.3 微服务优缺点</h2><p>优点：</p>
<blockquote>
<p>每个服务足够内聚,足够小,代码容易理解这样能聚焦一个指定的业务功能或业务需求</p>
<p>开发简单、开发效率提高,一个服务可能就是专一的只干一件事.</p>
<p>微服务能够被小团队单独开服,这个小团队是2到5人的开发人员组成</p>
<p>微服务是松耦合的,是有功能意义的服务,无论是在开发阶段或部署阶段都是独立的.</p>
<p>微服务能试用不同的语言开发</p>
<p>易于和第三方集成,微服务允许容易且灵活的方式集成自动部署,通过持续集成工具,如Jenkins,Hudson,bamboo.</p>
<p>微服务易于被一个开发人员理解,修改和维护,这样小团队能够更关注自己的工作成果.无需通过合作才能体现价值</p>
<p>微服务允许你利用融合最新技术.</p>
<p>微服务只是业务逻辑的代码,不会和HTML,CSS或其他界面组件混合.</p>
<p>每个微服务都有自己的存储能力,可以有自己的数据库.也可以有统一的数据库</p>
</blockquote>
<p>缺点：</p>
<blockquote>
<p>开发人员要处理分布式系统的复杂性</p>
<p>多服务运维难度,随着服务的增加,运维的压力也在增大</p>
<p>系统部署依赖</p>
<p>服务间通信成本</p>
<p>数据一致性</p>
<p>系统集成测试</p>
<p>性能监控</p>
</blockquote>
<h2 id="1-4-常见微服务架构"><a href="#1-4-常见微服务架构" class="headerlink" title="1.4 常见微服务架构"></a>1.4 常见微服务架构</h2><table>
<thead>
<tr>
<th style="text-align:center">微服务条目</th>
<th style="text-align:center">落地技术</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">服务开发</td>
<td style="text-align:center">SpringBoot,Spring,SpringMVC</td>
</tr>
<tr>
<td style="text-align:center">服务配置与管理</td>
<td style="text-align:center">Netflix公司的Archaius、阿里的Diamond等</td>
</tr>
<tr>
<td style="text-align:center">服务注册与发现</td>
<td style="text-align:center">Eureka、Consul、Zookeeper等</td>
</tr>
<tr>
<td style="text-align:center">服务调用</td>
<td style="text-align:center">Rest、RPC、gRPC</td>
</tr>
<tr>
<td style="text-align:center">服务熔断器</td>
<td style="text-align:center">Hystrix、Envoy等</td>
</tr>
<tr>
<td style="text-align:center">负载均衡</td>
<td style="text-align:center">Ribbon、Nginx等</td>
</tr>
<tr>
<td style="text-align:center">服务接口调用（客户端调用服务的简化工具）</td>
<td style="text-align:center">Feign等</td>
</tr>
<tr>
<td style="text-align:center">消息队列</td>
<td style="text-align:center">Kafka、RabbitMQ、ActiveMQ等</td>
</tr>
<tr>
<td style="text-align:center">服务配置中心管理</td>
<td style="text-align:center">SpringCloudConfig、Chef等</td>
</tr>
<tr>
<td style="text-align:center">服务路由（API网关）</td>
<td style="text-align:center">Zuul等</td>
</tr>
<tr>
<td style="text-align:center">服务监控</td>
<td style="text-align:center">Zabbix、Nagios、Metrics、Specatator等</td>
</tr>
<tr>
<td style="text-align:center">全链路追踪</td>
<td style="text-align:center">Zipkin、Brave、Dapper等</td>
</tr>
<tr>
<td style="text-align:center">服务部署</td>
<td style="text-align:center">Docker、OpenStack、Kubernetes等</td>
</tr>
<tr>
<td style="text-align:center">数据流操作开发包</td>
<td style="text-align:center">SpringCloud Stream(封装与Redis，Rabbit，Kafka等发送接收消息)</td>
</tr>
<tr>
<td style="text-align:center">事件消息总线</td>
<td style="text-align:center">SpringCloud Bus</td>
</tr>
</tbody>
</table>
<h1 id="二、springcloud和dubbo"><a href="#二、springcloud和dubbo" class="headerlink" title="二、springcloud和dubbo"></a>二、springcloud和dubbo</h1><p>为什么现在流行的微服务架构是springcloud而不是dubbo，最主要的是dubbo在这之前停止更新过几年的时间，这个时候springcloud异军突起，很好地抢占了先机，整体解决方案和框架成熟度，社区热度，可维护性，学习曲线也是它更加火爆的原因：</p>
<p>最主要的是，Dubbo 的定位始终是一款 RPC 框架，目的是提<a href=""><strong>供高性能和透明化的RPC远程服务调用方案，以及SOA服务治理方案</strong></a></p>
<p>然而：Spring Cloud 的目标是微服务架构下的一站式解决方案，换句话说，dubbo更像是springcloud的Eureka模块。</p>
<p>接下来我么你看一段关于Dubbo目前负责人刘军的一段采访</p>
<p><a href="https://www.oschina.net/question/2896879_2272652?sort=time" target="_blank" rel="external">https://www.oschina.net/question/2896879_2272652?sort=time</a></p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-01-12.png" alt=""></p>
<p>当前各大IT公司用的微服务架构有哪些</p>
<blockquote>
<p>阿里Dubbo/HSF<br>京东JSF<br>新浪微博Motan<br>当当网DubboX</p>
</blockquote>
<h2 id="1-各微服务的框架对比"><a href="#1-各微服务的框架对比" class="headerlink" title="1.各微服务的框架对比"></a>1.各微服务的框架对比</h2><table>
<thead>
<tr>
<th style="text-align:center">功能点/服务框架</th>
<th style="text-align:center">Netflix/SpringCloud</th>
<th style="text-align:center">Motan</th>
<th style="text-align:center">gRPC</th>
<th style="text-align:center">Thrift</th>
<th style="text-align:center">Dubbo/DubboX</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">功能定位</td>
<td style="text-align:center">完整的微服务架构</td>
<td style="text-align:center">RPC框架，但整合了ZK或Consul，实现集群环境的基本服务注册/发现</td>
<td style="text-align:center">RPC框架</td>
<td style="text-align:center">RPC框架</td>
<td style="text-align:center">服务框架</td>
</tr>
<tr>
<td style="text-align:center">支持Rest</td>
<td style="text-align:center">是，Ribbon支持多种可插拔的序列化选择</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">支持RPC</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
</tr>
<tr>
<td style="text-align:center">支持多语言</td>
<td style="text-align:center">是（Rest形式）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">服务注册/发现</td>
<td style="text-align:center">是（Eureka） Eureka服务注册表，Karyon服务端框架支持服务自注册和健康检查</td>
<td style="text-align:center">是（zookeeper/consul）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
</tr>
<tr>
<td style="text-align:center">负载均衡</td>
<td style="text-align:center">是（服务端zuul+客户端Ribbon） zuul-服务，动态路由 云端负载均衡  Eureka（针对中间层服务器）</td>
<td style="text-align:center">是（客户端）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是（客户端）</td>
</tr>
<tr>
<td style="text-align:center">配置服务</td>
<td style="text-align:center">Netflix Archaius SpringCloud Config Server集中配置</td>
<td style="text-align:center">是（zookeeper提供）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">服务调用链监控</td>
<td style="text-align:center">是（zuul） Zuul提供边缘服务，API网关</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">高可用/容错</td>
<td style="text-align:center">是（服务端Hystrix+客户端Ribbon）</td>
<td style="text-align:center">是（客户端）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是（客户端）</td>
</tr>
<tr>
<td style="text-align:center">典型应用案例</td>
<td style="text-align:center">Netflix</td>
<td style="text-align:center">Sina</td>
<td style="text-align:center">Google</td>
<td style="text-align:center">Facebook</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">社区活跃度</td>
<td style="text-align:center">高</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">高</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">2017年7月才重启</td>
</tr>
<tr>
<td style="text-align:center">学习难度</td>
<td style="text-align:center">中等</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">高</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">低</td>
</tr>
<tr>
<td style="text-align:center">文档丰富度</td>
<td style="text-align:center">高</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">一般</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center">其他</td>
<td style="text-align:center">Spring Cloud Bus为我们应用程序带来了更多管理端点</td>
<td style="text-align:center">支持降级</td>
<td style="text-align:center">Netflix内部在开发集成gRPC</td>
<td style="text-align:center">IDL定义</td>
<td style="text-align:center">实践公司比较多</td>
</tr>
</tbody>
</table>
<h2 id="2-springcloud-VS-Dubbo"><a href="#2-springcloud-VS-Dubbo" class="headerlink" title="2. springcloud VS Dubbo"></a>2. springcloud VS Dubbo</h2><p>社区活跃度</p>
<p><a href="https://github.com/dubbo" target="_blank" rel="external">https://github.com/dubbo</a><br><a href="https://github.com/springcloud" target="_blank" rel="external">https://github.com/springcloud</a></p>
<p>功能对比</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">Dubbo</th>
<th style="text-align:center">Spring</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务注册中心</td>
<td style="text-align:center">Zookeeper</td>
<td style="text-align:center">Spring Cloud Netfilx Eureka</td>
</tr>
<tr>
<td>服务调用方式</td>
<td style="text-align:center">RPC</td>
<td style="text-align:center">REST API</td>
</tr>
<tr>
<td>服务监控</td>
<td style="text-align:center">Dubbo-monitor</td>
<td style="text-align:center">Spring Boot Admin</td>
</tr>
<tr>
<td>断路器</td>
<td style="text-align:center">不完善</td>
<td style="text-align:center">Spring Cloud Netflix Hystrix</td>
</tr>
<tr>
<td>服务网关</td>
<td style="text-align:center">无</td>
<td style="text-align:center">Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td>分布式配置</td>
<td style="text-align:center">无</td>
<td style="text-align:center">Spring Cloud Config</td>
</tr>
<tr>
<td>服务跟踪</td>
<td style="text-align:center">无</td>
<td style="text-align:center">Spring Cloud Sleuth</td>
</tr>
<tr>
<td>消息总线</td>
<td style="text-align:center">无</td>
<td style="text-align:center">Spring Cloud Bus</td>
</tr>
<tr>
<td>数据流</td>
<td style="text-align:center">无</td>
<td style="text-align:center">Spring Cloud Stream</td>
</tr>
<tr>
<td>批量任务</td>
<td style="text-align:center">无</td>
<td style="text-align:center">Spring Cloud Task</td>
</tr>
</tbody>
</table>
<p><strong>最大区别：</strong></p>
<ul>
<li>Spring Cloud抛弃了RPC通讯，采用基于HTTP的REST方式。Spring Cloud牺牲了服务调用的性能，但是同时也避免了原生RPC带来的问题。REST比RPC更为灵活，不存在代码级别的强依赖，在强调快速演化的微服务环境下，显然更合适。</li>
<li>==一句话：Dubbo像组装机，Spring Cloud像一体机==</li>
<li>社区的支持与力度：Dubbo曾经停运了5年，虽然重启了，但是对于技术发展的新需求，还是需要开发者自行去拓展，对于中小型公司，显然显得比较费时费力，也不一定有强大的实力去修改源码</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>解决的问题域不一样：Dubbo的定位是一款RPC框架，Spring Cloud的目标是微服务架构下的一站式解决方案</li>
</ol>
<h1 id="三、服务调用方式"><a href="#三、服务调用方式" class="headerlink" title="三、服务调用方式"></a>三、服务调用方式</h1><h2 id="1-RPC和HTTP"><a href="#1-RPC和HTTP" class="headerlink" title="1.RPC和HTTP"></a>1.RPC和HTTP</h2><p>无论是微服务还是SOA，都面临着服务间的远程调用。那么服务间的远程调用方式有哪些呢？</p>
<p>常见的远程调用方式有以下2种：</p>
<ul>
<li><p>RPC：Remote Produce Call远程过程调用，类似的还有RMI。自定义数据格式，基于原生TCP通信，速度快，效率高。早期的webservice，现在热门的dubbo，都是RPC的典型代表</p>
</li>
<li><p>Http：http其实是一种网络传输协议，基于TCP，规定了数据传输的格式。现在客户端浏览器与服务端通信基本都是采用Http协议，也可以用来进行远程服务调用。缺点是消息封装臃肿，优势是对服务的提供和调用方没有任何技术限定，自由灵活，更符合微服务理念。</p>
<p>现在热门的Rest风格，就可以通过http协议来实现。</p>
</li>
</ul>
<p>如果你们公司全部采用Java技术栈，那么使用Dubbo作为微服务架构是一个不错的选择。</p>
<p>相反，如果公司的技术栈多样化，而且你更青睐Spring家族，那么SpringCloud搭建微服务是不二之选。在我们的项目中，我们会选择SpringCloud套件，因此我们会使用Http方式来实现服务间调用。</p>
<h2 id="2-Http客户端工具"><a href="#2-Http客户端工具" class="headerlink" title="2.Http客户端工具"></a>2.Http客户端工具</h2><p>既然微服务选择了Http，那么我们就需要考虑自己来实现对请求和响应的处理。不过开源世界已经有很多的http客户端工具，能够帮助我们做这些事情，例如：</p>
<ul>
<li>HttpClient</li>
<li>OKHttp</li>
<li>URLConnection</li>
</ul>
<p>接下来，不过这些不同的客户端，API各不相同</p>
<h2 id="3-Spring的RestTemplate"><a href="#3-Spring的RestTemplate" class="headerlink" title="3.Spring的RestTemplate"></a>3.Spring的RestTemplate</h2><p>Spring提供了一个RestTemplate模板工具类，对基于Http的客户端进行了封装，并且实现了对象与json的序列化和反序列化，非常方便。RestTemplate并没有限定Http的客户端类型，而是进行了抽象，目前常用的3种都有支持：</p>
<ul>
<li>HttpClient</li>
<li>OkHttp</li>
<li>JDK原生的URLConnection（默认的）</li>
</ul>
<p>RestTemplate简单使用</p>
<p>首先在项目中注册一个<code>RestTemplate</code>对象，可以在启动类位置注册：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpDemoApplication</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		SpringApplication.run(HttpDemoApplication.class, args);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Bean</span></div><div class="line">	<span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</div><div class="line">   </div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在测试类中直接<code>@Autowired</code>注入：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span>(classes = HttpDemoApplication.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpDemoApplicationTests</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> RestTemplate restTemplate;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">httpGet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 调用springboot案例中的rest接口</span></div><div class="line">		User user = <span class="keyword">this</span>.restTemplate.getForObject(<span class="string">"http://localhost/user/1"</span>, User.class);</div><div class="line">		System.out.println(user);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>通过RestTemplate的getForObject()方法，传递url地址及实体类的字节码，RestTemplate会自动发起请求，接收响应，并且帮我们对响应结果进行反序列化。</li>
</ul>
<p><img src="/2019/05/01/SpringCloud个人总结/1525573702492.png" alt="1525573702492"></p>
<p>学习完了Http客户端工具，接下来就可以正式学习微服务了。</p>
<h1 id="四、初识SpringCloud"><a href="#四、初识SpringCloud" class="headerlink" title="四、初识SpringCloud"></a>四、初识SpringCloud</h1><p>微服务是一种架构方式，最终肯定需要技术架构去实施。</p>
<p>微服务的实现方式很多，但是最火的莫过于Spring Cloud了。为什么？</p>
<ul>
<li>后台硬：作为Spring家族的一员，有整个Spring全家桶靠山，背景十分强大。</li>
<li>技术强：Spring作为Java领域的前辈，可以说是功力深厚。有强力的技术团队支撑，一般人还真比不了</li>
<li>群众基础好：可以说大多数程序员的成长都伴随着Spring框架，试问：现在有几家公司开发不用Spring？SpringCloud与Spring的各个框架无缝整合，对大家来说一切都是熟悉的配方，熟悉的味道。</li>
<li>使用方便：相信大家都体会到了SpringBoot给我们开发带来的便利，而SpringCloud完全支持SpringBoot的开发，用很少的配置就能完成微服务框架的搭建</li>
</ul>
<h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p>SpringCloud是Spring旗下的项目之一，<a href="http://projects.spring.io/spring-cloud/" target="_blank" rel="external">官网地址：http://projects.spring.io/spring-cloud/</a></p>
<p>官网介绍:<a href="https://spring.io/" target="_blank" rel="external">https://spring.io/</a></p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-08-43.png" alt=""></p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-09-14.png" alt=""></p>
<p>SpringCloud,基于springboot提供了一套为服务解决方案.</p>
<p>Spring最擅长的就是集成，把世界上最好的框架拿过来，集成到自己的项目中。</p>
<p>SpringCloud也是一样，它将现在非常流行的一些技术整合到一起，实现了诸如：配置管理，服务发现，智能路由，负载均衡，熔断器，控制总线，集群状态等等功能。其主要涉及的组件包括：</p>
<ul>
<li>Eureka：服务治理组件，包含服务注册中心，服务注册与发现机制的实现。（服务治理，服务注册/发现） </li>
<li>Zuul：网关组件，提供智能路由，访问过滤功能 </li>
<li>Ribbon：客户端负载均衡的服务调用组件（客户端负载） </li>
<li>Feign：服务调用，给予Ribbon和Hystrix的声明式服务调用组件 （声明式服务调用） </li>
<li>Hystrix：容错管理组件，实现断路器模式，帮助服务依赖中出现的延迟和为故障提供强大的容错能力。(熔断、断路器，容错) </li>
</ul>
<p>架构图：</p>
<p> <img src="/SpringCloud个人总结/1525575656796.png" alt="1525575656796"></p>
<p>以上只是其中一部分。</p>
<blockquote>
<p>SpringCloud,基于springboot提供了一套为服务解决方案,包括服务注册与发现,配置中心,全链路监控,服务网关,负载均衡,熔断器等组件,除了基于NetFlix的开源组件做高度抽象封装之外,还有一些选型中立的开源组件.</p>
<p>SpringCloud利用springboot的开发便利性巧妙地简化了分布式系统基础设施的开发,SpringCloud为开发人员提供了快速构建分布式系统的一些工具,包括配置管理、服务发现、断路器、路由、微代理、事件总线、全局锁、决策竞选、分布式会话等等,它们都可以利用Springboot的开发风格做到一键启动和部署.</p>
<p>SpringBoot并没有重复制造轮子,它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来,通过Springboot风格进行再封装屏蔽掉了复杂的配置和实现原理,最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包.</p>
</blockquote>
<h2 id="2-SpringCloud和springboot是什么关系"><a href="#2-SpringCloud和springboot是什么关系" class="headerlink" title="2.SpringCloud和springboot是什么关系"></a>2.SpringCloud和springboot是什么关系</h2><p><strong>Springboot专注于快速方便的开发单个个体微服务.</strong></p>
<p>SpringCloud是<strong>关注全局的微服务协调整理治理框架</strong>,它将Springboot开发的一个个单体微服务整合并管理起来,为各个微服务质检提供,配置管理、服务发现、断路器、路由、微代理、事件总线、全局锁、决策竞选、分布式会话等等集成服务</p>
<p><strong>Springboot可以离开SpringCloud独立使用开发项目,但是SpringCloud离不开Springboot,属于依赖的关系.</strong><br><strong>Springboot专注于快速、方便的开发单个微服务个体,SpringCloud关注全局的服务治理框架.</strong></p>
<h2 id="3-springcloud的版本"><a href="#3-springcloud的版本" class="headerlink" title="3.springcloud的版本"></a>3.springcloud的版本</h2><p>因为Spring Cloud不同其他独立项目，它拥有很多子项目的大项目。所以它的版本是版本名+版本号 （如Angel.SR6）。  </p>
<p>版本名：是伦敦的地铁名  </p>
<p>版本号：SR（Service Releases）是固定的 ,大概意思是稳定版本。后面会有一个递增的数字。 </p>
<p>所以 Edgware.SR3就是Edgware的第3个Release版本。  </p>
<p> <img src="/2019/05/01/SpringCloud个人总结/1528263985902.png" alt="1528263985902"></p>
<p>我们在项目中，会是以Finchley的版本。</p>
<p>其中包含的组件，也都有各自的版本，如下表：</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Edgware.SR3</th>
<th>Finchley.RC1</th>
<th>Finchley.BUILD-SNAPSHOT</th>
</tr>
</thead>
<tbody>
<tr>
<td>spring-cloud-aws</td>
<td>1.2.2.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-bus</td>
<td>1.3.2.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-cli</td>
<td>1.4.1.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-commons</td>
<td>1.3.3.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-contract</td>
<td>1.2.4.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-config</td>
<td>1.4.3.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-netflix</td>
<td>1.4.4.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-security</td>
<td>1.2.2.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-cloudfoundry</td>
<td>1.1.1.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-consul</td>
<td>1.3.3.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-sleuth</td>
<td>1.3.3.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-stream</td>
<td>Ditmars.SR3</td>
<td>Elmhurst.RELEASE</td>
<td>Elmhurst.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-zookeeper</td>
<td>1.2.1.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-boot</td>
<td>1.5.10.RELEASE</td>
<td>2.0.1.RELEASE</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-task</td>
<td>1.2.2.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.RELEASE</td>
</tr>
<tr>
<td>spring-cloud-vault</td>
<td>1.1.0.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-gateway</td>
<td>1.0.1.RELEASE</td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>spring-cloud-openfeign</td>
<td></td>
<td>2.0.0.RC1</td>
<td>2.0.0.BUILD-SNAPSHOT</td>
</tr>
</tbody>
</table>
<p><img src="/2019/05/01/SpringCloud个人总结/1528263942152.png" alt="1528263942152"></p>
<h2 id="4-SpringCloud的参考资料"><a href="#4-SpringCloud的参考资料" class="headerlink" title="4.SpringCloud的参考资料"></a>4.SpringCloud的参考资料</h2><h1 id="五、springcloud的实现准备"><a href="#五、springcloud的实现准备" class="headerlink" title="五、springcloud的实现准备"></a>五、springcloud的实现准备</h1><p>为了下面使用springcloud微服务架构各个优秀的组件，我们先搭建一个基本的分布式项目工程。</p>
<p>案例使用的springcloud和springboot版本分别是：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;Dalston.SR1&lt;/version&gt;</div><div class="line">    &lt;type&gt;pom&lt;/type&gt;</div><div class="line">    &lt;scope&gt;import&lt;/scope&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;</div><div class="line">    &lt;type&gt;pom&lt;/type&gt;</div><div class="line">    &lt;scope&gt;import&lt;/scope&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h2 id="1-新建父工程-microservicecloud"><a href="#1-新建父工程-microservicecloud" class="headerlink" title="1 新建父工程-microservicecloud"></a>1 新建父工程-microservicecloud</h2><p>microservicecloud</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-16_16-24-07.png" alt=""></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image003.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image005.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image007.jpg" alt="img"></p>
<p><strong>打包方式设置为pom</strong></p>
<p> 设置pom.xml文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</div><div class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div class="line"></div><div class="line">    &lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</div><div class="line">    &lt;properties&gt;</div><div class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</div><div class="line">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</div><div class="line">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</div><div class="line">        &lt;junit.version&gt;4.12&lt;/junit.version&gt;</div><div class="line">        &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt;</div><div class="line">        &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt;</div><div class="line">    &lt;/properties&gt;</div><div class="line"></div><div class="line">    &lt;dependencyManagement&gt;</div><div class="line">        &lt;dependencies&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;Dalston.SR1&lt;/version&gt;</div><div class="line">                &lt;type&gt;pom&lt;/type&gt;</div><div class="line">                &lt;scope&gt;import&lt;/scope&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;</div><div class="line">                &lt;type&gt;pom&lt;/type&gt;</div><div class="line">                &lt;scope&gt;import&lt;/scope&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;5.0.4&lt;/version&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;1.0.31&lt;/version&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;1.3.0&lt;/version&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;1.2.3&lt;/version&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;$&#123;junit.version&#125;&lt;/version&gt;</div><div class="line">                &lt;scope&gt;test&lt;/scope&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">            &lt;dependency&gt;</div><div class="line">                &lt;groupId&gt;log4j&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;log4j&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt;</div><div class="line">            &lt;/dependency&gt;</div><div class="line">        &lt;/dependencies&gt;</div><div class="line">    &lt;/dependencyManagement&gt;</div><div class="line"></div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
<p>查看项目</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image008.png" alt="img"></p>
<p>新建父工程目的：定义pom文件，统一各个子模块的jar依赖版本，方面管理，避免每个子模块使用相同组件不同版本，造成项目测试运行出现问题。</p>
<h2 id="2-根据父工程，新建api公共模块-microservicecloud-api"><a href="#2-根据父工程，新建api公共模块-microservicecloud-api" class="headerlink" title="2 根据父工程，新建api公共模块-microservicecloud-api"></a>2 根据父工程，新建api公共模块-microservicecloud-api</h2><p>目的：抽取出所有子项目公共的bean或者方法。例如在下面的创建的服务提供者和服务消费者都是用到了Person这个javabean，那么我们就需要把这个bean放在这里。然后服务提供者和消费者就可以依赖这个api公共模块，从而实用Person实体类。</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image010.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image012.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image014.jpg" alt="img"></p>
<p>创建完毕</p>
<h3 id="2-1-查看父工程pom"><a href="#2-1-查看父工程pom" class="headerlink" title="2.1 查看父工程pom"></a>2.1 查看父工程pom</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image015.png" alt="img"></p>
<p>发现多了这一行，因为我们是在父工程microserviceproject下新建的，表示microservicecloud-api工程为父工程子模块。</p>
<h3 id="2-2-修改microservicecloud-api的pom文件"><a href="#2-2-修改microservicecloud-api的pom文件" class="headerlink" title="2.2 修改microservicecloud-api的pom文件"></a>2.2 修改microservicecloud-api的pom文件</h3><p>修改内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</div><div class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div class="line">    &lt;parent&gt;</div><div class="line">        &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div class="line">        &lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div class="line">    &lt;/parent&gt;</div><div class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</div><div class="line"></div><div class="line">    &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div class="line">    &lt;dependencies&gt;&lt;!-- 当前Module需要用到的jar包，按自己需求添加，如果父类已经包含了，可以不用写版本号 --&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;  </div><div class="line">        &lt;/dependency&gt;//这个组件可用可不用</div><div class="line">    &lt;/dependencies&gt;</div><div class="line"></div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
<p>Lombok组件在真实项目中不建议使用，虽然他简化了javabean的开发，但是代码的可读性也产生了严重的影响。</p>
<h3 id="2-3-新建公共bean-Person"><a href="#2-3-新建公共bean-Person" class="headerlink" title="2.3 新建公共bean-Person"></a>2.3 新建公共bean-Person</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image017.jpg" alt="img"></p>
<p>生成get/set方法</p>
<h3 id="2-4-项目结构"><a href="#2-4-项目结构" class="headerlink" title="2.4 项目结构"></a>2.4 项目结构</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image018.png" alt="img"></p>
<h2 id="3-根据父工程，新建微服务提供者-provider"><a href="#3-根据父工程，新建微服务提供者-provider" class="headerlink" title="3 根据父工程，新建微服务提供者-provider"></a>3 根据父工程，新建微服务提供者-provider</h2><p>microservicecloud-provider-person-8001 –&gt; 8001表示服务暴露的端口号</p>
<p>新建方法同新建-microservicecloud-api 模块</p>
<h3 id="3-1-修改pom文件"><a href="#3-1-修改pom文件" class="headerlink" title="3.1 修改pom文件"></a>3.1 修改pom文件</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</div><div class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div class="line">    &lt;parent&gt;</div><div class="line">        &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div class="line">        &lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div class="line">    &lt;/parent&gt;</div><div class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div class="line"></div><div class="line">    &lt;artifactId&gt;microservicecloud-provider-person-8001&lt;/artifactId&gt;</div><div class="line"></div><div class="line">    &lt;dependencies&gt;</div><div class="line">        &lt;!-- 引入自己定义的api通用包，可以使用Person用户Entity --&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">       </div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;!-- 修改后立即生效，热部署 --&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">    &lt;/dependencies&gt;</div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
<h3 id="3-2-新建application-yml文件"><a href="#3-2-新建application-yml文件" class="headerlink" title="3.2 新建application.yml文件"></a>3.2 新建application.yml文件</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image019.png" alt="img"></p>
<p>内容是：详细的参见代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 8001</div><div class="line"></div><div class="line">mybatis:</div><div class="line">  config-location: classpath:mybatis/mybatis.cfg.xml        # mybatis配置文件所在路径</div><div class="line">  type-aliases-package: com.kingge.entity    # 所有Entity别名类所在包</div><div class="line">  mapper-locations:</div><div class="line">  - classpath:mybatis/mapper/**/*.xml                       # mapper映射文件</div><div class="line"></div><div class="line"></div><div class="line">spring:</div><div class="line">   application:</div><div class="line">    name: microservicecloud-person                          #很重要，对外暴露的微服务的名称</div><div class="line">   datasource:</div><div class="line">    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型</div><div class="line">    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包</div><div class="line">    url: jdbc:mysql://127.0.0.1:3306/test              # 数据库名称</div><div class="line">    username: root</div><div class="line">    password: 123</div><div class="line">    dbcp2:</div><div class="line">      min-idle: 5                                           # 数据库连接池的最小维持连接数</div><div class="line">      initial-size: 5                                       # 初始化连接数</div><div class="line">      max-total: 5                                          # 最大连接数</div><div class="line">      max-wait-millis: 200</div></pre></td></tr></table></figure>
<p><strong>注意每个属性后面必须是有空格-yml文件的格式</strong></p>
<h3 id="3-3-新建person数据表"><a href="#3-3-新建person数据表" class="headerlink" title="3.3 新建person数据表"></a>3.3 新建person数据表</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DROP TABLE IF EXISTS `person`;</div><div class="line">CREATE TABLE `person` (</div><div class="line">  `deptno` int(255) NOT NULL AUTO_INCREMENT,</div><div class="line">  `dname` varchar(255) DEFAULT NULL,</div><div class="line">  `db_source` varchar(255) DEFAULT NULL, //这和字段标识当前数据来源于那个数据库，后面讲解Eureka集群时会使用到</div><div class="line">  PRIMARY KEY (`deptno`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">-- ----------------------------</div><div class="line">-- Records of person</div><div class="line">-- ----------------------------</div><div class="line">INSERT INTO `person` VALUES (&apos;1&apos;, &apos;开发部&apos;, &apos;test&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;2&apos;, &apos;人事部&apos;, &apos;test&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;3&apos;, &apos;集成部&apos;, &apos;test&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;4&apos;, &apos;市场部&apos;, &apos;test&apos;);</div></pre></td></tr></table></figure>
<h3 id="3-4-新建dao和mapper"><a href="#3-4-新建dao和mapper" class="headerlink" title="3.4 新建dao和mapper"></a>3.4 新建dao和mapper</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image020.png" alt="img"></p>
<p>内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import com.kingge.entity.Person;</div><div class="line">import org.apache.ibatis.annotations.Mapper;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">@Mapper</div><div class="line">public interface PersonDao &#123;</div><div class="line">    public boolean addDept(Person dept);</div><div class="line"></div><div class="line">    public Person findById(Long id);</div><div class="line"></div><div class="line">    public List&lt;Person&gt; findAll();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-4-1-新建mybatis-cfg-xml"><a href="#3-4-1-新建mybatis-cfg-xml" class="headerlink" title="3.4.1 新建mybatis.cfg.xml"></a>3.4.1 新建mybatis.cfg.xml</h3><p>实际上我们不需要这个xml文件，因为我们的配置一般都是已经放置在了application.yml文件中，但是为了整体架构的扩展性，这里也新建了改文件</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image021.png" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image023.jpg" alt="img"></p>
<h3 id="3-5-新建PersonMapper-xml"><a href="#3-5-新建PersonMapper-xml" class="headerlink" title="3.5 新建PersonMapper.xml"></a>3.5 新建PersonMapper.xml</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image024.png" alt="img"></p>
<p>存放mapper.xml文件的位置我们在上面application.yml中已经声明</p>
<p>内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</div><div class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</div><div class="line">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</div><div class="line"></div><div class="line">&lt;mapper namespace=&quot;com.kingge.dao.PersonDao&quot;&gt;</div><div class="line"></div><div class="line">	&lt;select id=&quot;findById&quot; resultType=&quot;Person&quot; parameterType=&quot;Long&quot;&gt;</div><div class="line">		select deptno,dname,db_source from person where deptno=#&#123;deptno&#125;;</div><div class="line">	&lt;/select&gt;</div><div class="line">	&lt;select id=&quot;findAll&quot; resultType=&quot;Person &quot;&gt;</div><div class="line">		select deptno,dname,db_source from person;</div><div class="line">	&lt;/select&gt;</div><div class="line">	&lt;insert id=&quot;addDept&quot; parameterType=&quot;Person &quot;&gt;</div><div class="line">		INSERT INTO person(dname,db_source) VALUES(#&#123;dname&#125;,DATABASE());</div><div class="line">	&lt;/insert&gt;</div><div class="line"></div><div class="line">&lt;/mapper&gt;</div></pre></td></tr></table></figure>
<h3 id="3-6-新建PersonService接口和接口实现类impl"><a href="#3-6-新建PersonService接口和接口实现类impl" class="headerlink" title="3.6 新建PersonService接口和接口实现类impl"></a>3.6 新建PersonService接口和接口实现类impl</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image025.png" alt="img"></p>
<p>PersonService 接口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public interface PersonService&#123;</div><div class="line">       publicboolean add(Person dept);</div><div class="line">       public Personget(Long id);</div><div class="line">       publicList&lt;Person&gt; list();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>PersonServiceImpl 实现类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Service</div><div class="line">public class PersonServiceImpl implements PersonService&#123;</div><div class="line">	@Autowired</div><div class="line">	private PersonDao dao;</div><div class="line">	</div><div class="line">	@Override</div><div class="line">	public boolean add(Person person)&#123;</div><div class="line">		return dao.addDept(person);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public Person get(Long id)&#123;</div><div class="line">		return dao.findById(id);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public List&lt;Person&gt; list()&#123;</div><div class="line">		return dao.findAll();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-7-controller控制层-PersonController"><a href="#3-7-controller控制层-PersonController" class="headerlink" title="3.7 controller控制层-PersonController"></a>3.7 controller控制层-PersonController</h3><p>代码实现：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">@RestController</div><div class="line">public class PersonController</div><div class="line">&#123;</div><div class="line">	@Autowired</div><div class="line">	private PersonService service;</div><div class="line">//全部使用restful风格，返回json字符串</div><div class="line">	@RequestMapping(value = &quot;/person/add&quot;, method = RequestMethod.POST)</div><div class="line">	public boolean add(@RequestBody Person person)</div><div class="line">	&#123;</div><div class="line">		return service.add(person);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@RequestMapping(value = &quot;/person/get/&#123;id&#125;&quot;, method = RequestMethod.GET)</div><div class="line">	public Person get(@PathVariable(&quot;id&quot;) Long id)</div><div class="line">	&#123;</div><div class="line">		return service.get(id);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@RequestMapping(value = &quot;/person/list&quot;, method = RequestMethod.GET)</div><div class="line">	public List&lt;Person&gt; list()</div><div class="line">	&#123;</div><div class="line">		return service.list();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-8-springboot启动类"><a href="#3-8-springboot启动类" class="headerlink" title="3.8 springboot启动类"></a>3.8 springboot启动类</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">public class ApplicationBootStart &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line">        SpringApplication.run(ApplicationBootStart.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>启动服务并测试访问。</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image027.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image029.jpg" alt="img"></p>
<h3 id="3-9-项目整体结构"><a href="#3-9-项目整体结构" class="headerlink" title="3.9 项目整体结构"></a>3.9 项目整体结构</h3><p><img src="/2019/05/01/SpringCloud个人总结/clip_image030.png" alt="img"></p>
<h2 id="4-根据父工程，新建微服务消费者-consumer"><a href="#4-根据父工程，新建微服务消费者-consumer" class="headerlink" title="4 根据父工程，新建微服务消费者-consumer"></a>4 根据父工程，新建微服务消费者-consumer</h2><p>microservicecloud-consumer-person-80 方法同上</p>
<h3 id="4-1-修改pom文件"><a href="#4-1-修改pom文件" class="headerlink" title="4.1 修改pom文件"></a>4.1 修改pom文件</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependencies&gt;</div><div class="line">	&lt;dependency&gt;&lt;!-- 自己定义的api --&gt;</div><div class="line">		&lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">		&lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div class="line">		&lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;</div><div class="line">	&lt;/dependency&gt;</div><div class="line">	        &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line"></div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line">           &lt;version&gt;2.1.7.RELEASE&lt;/version&gt;</div><div class="line">           &lt;scope&gt;test&lt;/scope&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line">	&lt;!-- 修改后立即生效，热部署 --&gt;</div><div class="line">	&lt;dependency&gt;</div><div class="line">		&lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">		&lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div class="line">	&lt;/dependency&gt;</div><div class="line">	&lt;dependency&gt;</div><div class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">		&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div class="line">	&lt;/dependency&gt;</div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure>
<h3 id="4-2-添加application-yml文件"><a href="#4-2-添加application-yml文件" class="headerlink" title="4.2 添加application.yml文件"></a>4.2 添加application.yml文件</h3><p>添加端口配置</p>
<p>server:</p>
<p>  port: 80</p>
<h3 id="4-3-新建-Configuration注解的配置类"><a href="#4-3-新建-Configuration注解的配置类" class="headerlink" title="4.3 新建@Configuration注解的配置类"></a>4.3 新建@Configuration注解的配置类</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class ConfigBean</div><div class="line">&#123; </div><div class="line">	@Bean</div><div class="line">	public RestTemplate getRestTemplate()</div><div class="line">	&#123;</div><div class="line">		return new RestTemplate();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>它的作用就是我们整合SSM的时候，对应的applicationContext.xml</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image032.jpg" alt="img"></p>
<h3 id="4-4-新建消费者控制器，访问服务提供者获取数据"><a href="#4-4-新建消费者控制器，访问服务提供者获取数据" class="headerlink" title="4.4 新建消费者控制器，访问服务提供者获取数据"></a>4.4 新建消费者控制器，访问服务提供者获取数据</h3><p>通过RestTemplate获取消息提供者暴露的服务信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@RestController</div><div class="line">public class ConsumerController &#123;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private RestTemplate restTemplate;</div><div class="line"></div><div class="line">    private static final String REST_URL_PREFIX = &quot;http://localhost:8001&quot;;//这里通过书写固定的服务提供者的地址，后面我们学习到了Eureka服务注册中心，那么注重修改这里</div><div class="line"></div><div class="line">    @RequestMapping(value = &quot;/consumer/person/add&quot;)</div><div class="line">    public boolean add(Person person)</div><div class="line">    &#123;</div><div class="line">        return restTemplate.postForObject(REST_URL_PREFIX + &quot;/person/add&quot;, person, Boolean.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @RequestMapping(value = &quot;/consumer/person/get/&#123;id&#125;&quot;)</div><div class="line">    public Person get(@PathVariable(&quot;id&quot;) Long id)</div><div class="line">    &#123;</div><div class="line">        return restTemplate.getForObject(REST_URL_PREFIX + &quot;/person/get/&quot; + id, Person.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @SuppressWarnings(&quot;unchecked&quot;)</div><div class="line">    @RequestMapping(value = &quot;/consumer/person/list&quot;)</div><div class="line">    public List&lt;Person&gt; list()</div><div class="line">    &#123;</div><div class="line">        return restTemplate.getForObject(REST_URL_PREFIX + &quot;/person/list&quot;, List.class);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-5-新建启动类"><a href="#4-5-新建启动类" class="headerlink" title="4.5 新建启动类"></a>4.5 新建启动类</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">public class ApplicationBootStart &#123;</div><div class="line">    public static void main(String[] args)&#123;</div><div class="line">        SpringApplication.run(ApplicationBootStart.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-6-完整项目结构"><a href="#4-6-完整项目结构" class="headerlink" title="4.6 完整项目结构"></a>4.6 完整项目结构</h3><p><img src="/2019/05/01/SpringCloud个人总结/C1565962178357.png" alt="1565962178357"></p>
<h2 id="5-同时启动服务提供者和服务消费者"><a href="#5-同时启动服务提供者和服务消费者" class="headerlink" title="5 同时启动服务提供者和服务消费者"></a>5 同时启动服务提供者和服务消费者</h2><p>也就是运行ApplicationBootStart8001和ApplicationBootStart80启动类即可</p>
<p>测试服务是否可以消费，访问消费者</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image034.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image036.jpg" alt="img"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image038.jpg" alt="img"></p>
<p>测试成功,以上就是成功的搭建了一个简单的微服务架构，下面我们会逐步的加入springcloud的其他组件，完善这个架构</p>
<h2 id="5-上面的项目存在什么问题"><a href="#5-上面的项目存在什么问题" class="headerlink" title="5.上面的项目存在什么问题"></a>5.上面的项目存在什么问题</h2><p>存在什么问题？</p>
<ul>
<li>在consumer中，我们把url地址硬编码到了代码中，不方便后期维护</li>
<li>consumer需要记忆provider的地址，如果出现变更，可能得不到通知，地址将失效</li>
<li>consumer不清楚provider的状态，服务宕机也不知道</li>
<li>provider只有1台服务，不具备高可用性</li>
<li>即便provider形成集群，consumer还需自己实现负载均衡</li>
</ul>
<p>其实上面说的问题，概括一下就是分布式服务必然要面临的问题：</p>
<ul>
<li>服务管理<ul>
<li>如何自动注册和发现</li>
<li>如何实现状态监管</li>
<li>如何实现动态路由</li>
</ul>
</li>
<li>服务如何实现负载均衡</li>
<li>服务如何解决容灾问题</li>
<li>服务如何实现统一配置</li>
</ul>
<p>以上的问题，我们都将在SpringCloud中得到答案。</p>
<h1 id="六、Eureka注册中心"><a href="#六、Eureka注册中心" class="headerlink" title="六、Eureka注册中心"></a>六、Eureka注册中心</h1><pre><code>**首先我们来解决第一问题，服务的管理 - 利用Eureka解决服务治理问题**
</code></pre><h2 id="1-Eureka概念"><a href="#1-Eureka概念" class="headerlink" title="1.Eureka概念"></a>1.Eureka概念</h2><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-17_11-15-12.png" alt=""></p>
<pre><code>Eureka是Netflix的一个子模块，也是核心模块之一。Eureka是一个基于REST的服务，用于定位服务，以实现云端中间层服务发现和故障转移。**服务注册与发现对于微服务架构来说是非常重要的，有了服务发现与注册，只需要使用服务的标识符，就可以访问到服务(解决上诉案例在consumer中，我们把服务提供者的url地址硬编码到了代码中)**，而不需要修改服务调用的配置文件了。功能类似于dubbo的注册中心，比如Zookeeper。



Netflix在设计Eureka时遵守的就是CAP规则中的AP原则。
</code></pre><blockquote>
<p>CAP原则又称CAP定理，指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可兼得</p>
</blockquote>
<p>特别提示：同样作为dubbo服务注册中心的zookeeper遵守的是CP原则。</p>
<h2 id="2-Eureka架构和原理"><a href="#2-Eureka架构和原理" class="headerlink" title="2.Eureka架构和原理"></a>2.Eureka架构和原理</h2><p>Spring Cloud 封装了 Netflix 公司开发的 Eureka 模块来实现服务注册和发现(请对比Zookeeper)。</p>
<p><strong>Eureka 采用了 C-S 的设计架构。Eureka Server 作为服务注册功能的服务器，它是服务注册中心</strong>。</p>
<p>而系统中的其他微服务，使用 <strong>Eureka 的客户端（上诉案例中的，服务提供者和服务消费者相对于EurekaServer都是属于客户端，前者是向EurekaServer注册服务，后者是向EurekaServer获取服务）</strong>连接到 Eureka Server并维持心跳连接。这样系统的维护人员就可以通过 Eureka Server 来监控系统中各个微服务是否正常运行。SpringCloud 的一些其他模块（比如Zuul）就可以通过 Eureka Server 来发现系统中的其他微服务，并执行相关的逻辑。</p>
<blockquote>
<p>基本架构：</p>
</blockquote>
<p><img src="/SpringCloud个人总结/1525597885059.png" alt="1525597885059"></p>
<p>Eureka包含两个组件：Eureka Server和Eureka Client</p>
<blockquote>
<p>Eureka Server提供服务注册服务<br>各个节点启动后，会在EurekaServer中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观的看到</p>
<p>EurekaClient是一个Java客户端，用于简化Eureka Server的交互，客户端同时也具备一个内置的、使用轮询(round-robin)负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳(默认周期为30秒)。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，EurekaServer将会从服务注册表中把这个服务节点移除（默认90秒）         </p>
</blockquote>
<ul>
<li>Eureka：就是服务注册中心（可以是一个集群），对外暴露自己的地址</li>
<li>提供者：启动后向Eureka注册自己信息（地址，提供什么服务）</li>
<li>消费者：向Eureka订阅服务，Eureka会将对应服务的所有提供者地址列表发送给消费者，并且定期更新</li>
<li>心跳(续约)：提供者定期通过http方式向Eureka刷新自己的状态</li>
</ul>
<h2 id="3-实现EurekaServer"><a href="#3-实现EurekaServer" class="headerlink" title="3. 实现EurekaServer"></a>3. 实现EurekaServer</h2><p>接下来我们通过加入springcloud的Eureka服务治理组件，改造之前的例子，解决动态路由（上个例子中我们是把服务提供者的url硬编码到消费者中）、注册发现，动态监管的问题</p>
<h3 id="3-1-根据父工程实现单节点Eureka服务注册中心"><a href="#3-1-根据父工程实现单节点Eureka服务注册中心" class="headerlink" title="3.1 根据父工程实现单节点Eureka服务注册中心"></a>3.1 根据父工程实现单节点Eureka服务注册中心</h3><p>根据父工程microservicecloud  创建 microservicecloud-eureka-7001模块</p>
<h4 id="3-1-1-修改pom文件导入EurekaServer依赖"><a href="#3-1-1-修改pom文件导入EurekaServer依赖" class="headerlink" title="3.1.1 修改pom文件导入EurekaServer依赖"></a>3.1.1 修改pom文件导入EurekaServer依赖</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependencies&gt;</div><div class="line">       &lt;!--eureka-server服务端 --&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line">       &lt;!-- 修改后立即生效，热部署 --&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line">   &lt;/dependencies</div></pre></td></tr></table></figure>
<h4 id="3-1-2-修改application-yml配置文件"><a href="#3-1-2-修改application-yml配置文件" class="headerlink" title="3.1.2 修改application.yml配置文件"></a>3.1.2 修改application.yml配置文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 7001</div><div class="line"></div><div class="line">eureka:</div><div class="line">  instance:</div><div class="line">    hostname: localhost #eureka服务端的实例名称</div><div class="line">  client:</div><div class="line">    register-with-eureka: false     #false表示不向注册中心注册自己。</div><div class="line">    fetch-registry: false     #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</div><div class="line">    service-url:</div><div class="line">       defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</div><div class="line">       # #设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。</div><div class="line">       #等同于 http://localhost:7001/eureka/</div></pre></td></tr></table></figure>
<h4 id="3-1-3-创建启动类并添加-EnableEurekaServer注解"><a href="#3-1-3-创建启动类并添加-EnableEurekaServer注解" class="headerlink" title="3.1.3 创建启动类并添加@EnableEurekaServer注解"></a>3.1.3 创建启动类并添加@EnableEurekaServer注解</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">package com.kingge.entity;</div><div class="line"></div><div class="line">import org.springframework.boot.SpringApplication;</div><div class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line">import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</div><div class="line"></div><div class="line"></div><div class="line">@SpringBootApplication</div><div class="line">@EnableEurekaServer ////EurekaServer服务器端启动类,接受其它微服务注册进来</div><div class="line">public class ApplicationBootStart7001 &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart7001.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-1-4-完整项目结构"><a href="#3-1-4-完整项目结构" class="headerlink" title="3.1.4 完整项目结构"></a>3.1.4 完整项目结构</h4><p><img src="/2019/05/01/SpringCloud个人总结/5C1565961802586.png" alt="1565961802586"></p>
<h4 id="3-1-5-运行启动类，启动EurekaServer"><a href="#3-1-5-运行启动类，启动EurekaServer" class="headerlink" title="3.1.5 运行启动类，启动EurekaServer"></a>3.1.5 运行启动类，启动EurekaServer</h4><p>访问网址：<strong><a href="http://localhost:7001/" target="_blank" rel="external">http://localhost:7001/</a></strong></p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-17_11-16-35.png" alt=""></p>
<p><strong>No application available 没有服务被发现 —- 因为没有注册服务进来当然不可能有服务被发现</strong></p>
<p>接下来我门把8001模块服务注册进来</p>
<h3 id="3-2-修改-服务提供者"><a href="#3-2-修改-服务提供者" class="headerlink" title="3.2 修改 服务提供者"></a>3.2 修改 服务提供者</h3><p>也就是修改上面我们实现的：microservicecloud-provider-person-8001 模块，将人员服务注册进EurekaServer中</p>
<h4 id="3-2-1-修改pom文件"><a href="#3-2-1-修改pom文件" class="headerlink" title="3.2.1 修改pom文件"></a>3.2.1 修改pom文件</h4><p>修改内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- 将微服务provider端注册进eureka --&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h4 id="3-2-2-修改application-yml配置文件"><a href="#3-2-2-修改application-yml配置文件" class="headerlink" title="3.2.2 修改application.yml配置文件"></a>3.2.2 修改application.yml配置文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">eureka:</div><div class="line">  client: #客户端注册进eureka服务列表内</div><div class="line">    service-url: </div><div class="line">      defaultZone: http://localhost:7001/eureka #这个地址就是我们在3.1.2定义的EurekaServer对外暴露的连接地址。</div></pre></td></tr></table></figure>
<h4 id="3-2-3-修改启动类添加-EnableEurekaClient注解"><a href="#3-2-3-修改启动类添加-EnableEurekaClient注解" class="headerlink" title="3.2.3 修改启动类添加@EnableEurekaClient注解"></a>3.2.3 修改启动类添加@EnableEurekaClient注解</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableEurekaClient////本服务启动后会自动注册进 eureka服务中</div><div class="line">public class ApplicationBootStart8001 &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart8001.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-3-修改服务消费者"><a href="#3-3-修改服务消费者" class="headerlink" title="3.3 修改服务消费者"></a>3.3 修改服务消费者</h3><p><strong>通过访问服务名称的方式消费服务，解决硬编码服务提供者url的问题</strong></p>
<p>也就是修改上面我们实现的：microservicecloud-consumer-person-80 模块</p>
<h4 id="3-3-1-修改pom文件"><a href="#3-3-1-修改pom文件" class="headerlink" title="3.3.1 修改pom文件"></a>3.3.1 修改pom文件</h4><p>修改内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- 将微服务provider端注册进eureka --&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">       &lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h4 id="3-3-2-修改application-yml配置文件"><a href="#3-3-2-修改application-yml配置文件" class="headerlink" title="3.3.2 修改application.yml配置文件"></a>3.3.2 修改application.yml配置文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">eureka:</div><div class="line">  client:</div><div class="line">    register-with-eureka: false</div><div class="line">    service-url:</div><div class="line">      defaultZone: http://localhost:7001/eureka/</div></pre></td></tr></table></figure>
<h4 id="3-3-3-修改启动类添加-EnableEurekaClient注解"><a href="#3-3-3-修改启动类添加-EnableEurekaClient注解" class="headerlink" title="3.3.3 修改启动类添加@EnableEurekaClient注解"></a>3.3.3 修改启动类添加@EnableEurekaClient注解</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableEurekaClient//</div><div class="line">public class ApplicationBootStart80 &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart80.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-3-4修改ConsumerController代码"><a href="#3-3-4修改ConsumerController代码" class="headerlink" title="3.3.4修改ConsumerController代码"></a>3.3.4修改ConsumerController代码</h4><p>修改内容如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//    private static final String REST_URL_PREFIX = &quot;http://localhost:8001&quot;;</div><div class="line">    private static final String REST_URL_PREFIX = &quot;http://MICROSERVICECLOUD-PERSON&quot;;</div></pre></td></tr></table></figure>
<p>把url更改为服务名称。</p>
<h3 id="3-4-启动EurekaServer和服务提供者，以及服务消费者"><a href="#3-4-启动EurekaServer和服务提供者，以及服务消费者" class="headerlink" title="3.4 启动EurekaServer和服务提供者，以及服务消费者"></a>3.4 启动EurekaServer和服务提供者，以及服务消费者</h3><p>运行ApplicationBootStart7001和ApplicationBootStart8001、ApplicationBootStart80</p>
<p>查看地址：<strong><a href="http://localhost:7001/" target="_blank" rel="external">http://localhost:7001/</a></strong></p>
<p><img src="/2019/05/01/SpringCloud个人总结/65963220408.png" alt="1565963220408"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/966479080.png" alt="1565966479080"></p>
<p>注册成功！！！</p>
<p>服务名称就是我们在服务提供者的application.yml配置文件中配置的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">spring:</div><div class="line">   application:</div><div class="line">    name: microservicecloud-person                          #很重要，对外暴露的微服务的名称</div></pre></td></tr></table></figure>
<p>我们发现生成的实例名称是没有任何意义的，而且实例的介绍地址不是ip的形式</p>
<p><img src="/2019/05/01/SpringCloud个人总结/963618268.png" alt="1565963618268"></p>
<p>下面就讲解修改这些小细节</p>
<h2 id="4-actuator与注册微服务信息完善"><a href="#4-actuator与注册微服务信息完善" class="headerlink" title="4.actuator与注册微服务信息完善"></a>4.<strong>actuator与注册微服务信息完善</strong></h2><h3 id="4-1-修改服务实例名和实例名访问路径显示ip"><a href="#4-1-修改服务实例名和实例名访问路径显示ip" class="headerlink" title="4.1 修改服务实例名和实例名访问路径显示ip"></a>4.1 修改服务实例名和实例名访问路径显示ip</h3><p>修改microservicecloud-provider-person-8001 模块的配置文件，添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">instance:</div><div class="line">  instance-id: microservicecloud-person8001</div><div class="line">  prefer-ip-address: true     #访问路径可以显示IP地址</div></pre></td></tr></table></figure>
<p>注意instance属性是eureka的子属性</p>
<p><img src="/2019/05/01/SpringCloud个人总结/565964019636.png" alt="1565964019636"></p>
<p>重启服务提供者ApplicationBootStart8001</p>
<p>查看EurekaServer</p>
<p><img src="/2019/05/01/SpringCloud个人总结/565964513626.png" alt="1565964513626"></p>
<p>这里涉及到了Eureka 的自我保护机制，下一章节我们会讲到。</p>
<h3 id="4-2-修改服务实例的详情页info"><a href="#4-2-修改服务实例的详情页info" class="headerlink" title="4.2 修改服务实例的详情页info"></a>4.2 修改服务实例的详情页info</h3><p>默认我么你点击服务实例名，跳转到的界面是：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/64617801.png" alt="1565964617801"></p>
<p>接下来我们要定制一下这界面，显示一下当前服务实例的一些说明信息。</p>
<p>（1）修改microservicecloud-provider-person-8001 模块的pom文件，添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- actuator监控信息完善 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>（2）修改microservicecloud-provider-person-8001 模块的配置文件，添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">info:</div><div class="line">  app.name: $&#123;spring.application.name&#125;</div><div class="line">  company.name: kingge.top</div><div class="line">  build.artifactId: $&#123;project.artifactId&#125;</div><div class="line">  build.version: $&#123;project.version&#125;</div><div class="line">  app.desc: 这是一个提供查询部门人员信息的服务</div></pre></td></tr></table></figure>
<p>（3）修改父工程的pom文件，添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;build&gt;</div><div class="line">        &lt;finalName&gt;microservicecloud&lt;/finalName&gt;</div><div class="line">        &lt;resources&gt;</div><div class="line">            &lt;resource&gt;</div><div class="line">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</div><div class="line">                &lt;filtering&gt;true&lt;/filtering&gt;</div><div class="line">            &lt;/resource&gt;</div><div class="line">        &lt;/resources&gt;</div><div class="line">        &lt;plugins&gt;</div><div class="line">            &lt;plugin&gt;</div><div class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</div><div class="line">                &lt;configuration&gt;</div><div class="line">                    &lt;delimiters&gt;</div><div class="line">                        &lt;delimit&gt;$&lt;/delimit&gt;</div><div class="line">                    &lt;/delimiters&gt;</div><div class="line">                &lt;/configuration&gt;</div><div class="line">            &lt;/plugin&gt;</div><div class="line">        &lt;/plugins&gt;</div><div class="line">    &lt;/build&gt;</div></pre></td></tr></table></figure>
<p>如果不添加那么就无法解析像这样的动态赋值${spring.application.name}</p>
<p>重启EurekaServer和服务提供者</p>
<p>再次查看服务实例名的info界面</p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1565965118437.png" alt="1565965118437"></p>
<h2 id="5-Eureka详解"><a href="#5-Eureka详解" class="headerlink" title="5.Eureka详解"></a>5.Eureka详解</h2><h3 id="5-1-基础架构"><a href="#5-1-基础架构" class="headerlink" title="5.1.基础架构"></a>5.1.基础架构</h3><p>Eureka架构中的三个核心角色：</p>
<ul>
<li><p>服务注册中心</p>
<p>Eureka的服务端应用，提供服务注册和发现功能，就是刚刚我们建立的7001模块。</p>
</li>
<li><p>服务提供者</p>
<p>提供服务的应用，可以是SpringBoot应用，也可以是其它任意技术实现，只要对外提供的是Rest风格服务即可。本例中就是我们实现的8001模块。</p>
</li>
<li><p>服务消费者</p>
<p>消费应用从注册中心获取服务列表，从而得知每个服务方的信息，知道去哪里调用服务方。本例中就是我们实现的80模块。</p>
</li>
</ul>
<p><strong>服务提供和服务消费者相对于服务注册中心，他们都是客户端。所以他们访问EurekaServer导入的依赖是相同的都是spring-cloud-starter-netflix-eureka-client</strong></p>
<h3 id="5-2-服务提供者"><a href="#5-2-服务提供者" class="headerlink" title="5.2.服务提供者"></a>5.2.服务提供者</h3><p>服务提供者要向EurekaServer注册服务，并且完成服务续约等工作。</p>
<blockquote>
<p>服务注册</p>
</blockquote>
<p>服务提供者在启动时，会检测配置属性中的：<code>eureka.client.register-with-eureka=true</code>参数是否正确，事实上默认就是true。如果值确实为true，则会向EurekaServer发起一个Rest请求，并携带自己的元数据信息，Eureka Server会把这些信息保存到一个双层Map结构中。</p>
<ul>
<li>第一层Map的Key就是服务id，一般是配置中的<code>spring.application.name</code>属性</li>
<li>第二层Map的key是服务的实例id。一般host+ serviceId + port，例如：<code>locahost:service-provider:8081</code></li>
<li>值则是服务的实例对象，也就是说一个服务，可以同时启动多个不同实例，形成集群。</li>
</ul>
<blockquote>
<p>服务续约</p>
</blockquote>
<p>在注册服务完成以后，服务提供者会维持一个心跳（定时向EurekaServer发起Rest请求），告诉EurekaServer：“我还活着”。这个我们称为服务的续约（renew）；</p>
<p>有两个重要参数可以修改服务续约的行为：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">eureka:</span></div><div class="line"><span class="attr">  instance:</span></div><div class="line"><span class="attr">    lease-expiration-duration-in-seconds:</span> <span class="number">90</span></div><div class="line"><span class="attr">    lease-renewal-interval-in-seconds:</span> <span class="number">30</span></div></pre></td></tr></table></figure>
<ul>
<li>lease-renewal-interval-in-seconds：服务续约(renew)的间隔，默认为30秒</li>
<li>lease-expiration-duration-in-seconds：服务失效时间，默认值90秒</li>
</ul>
<p>也就是说，默认情况下每个30秒服务会向注册中心发送一次心跳，证明自己还活着。如果超过90秒没有发送心跳，EurekaServer就会认为该服务宕机，会从服务列表中移除，这两个值在生产环境不要修改，默认即可。</p>
<p>但是在开发时，这个值有点太长了，经常我们关掉一个服务，会发现Eureka依然认为服务在活着。所以我们在开发阶段可以适当调小。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">eureka:</span></div><div class="line"><span class="attr">  instance:</span></div><div class="line"><span class="attr">    lease-expiration-duration-in-seconds:</span> <span class="number">10</span> <span class="comment"># 10秒即过期</span></div><div class="line"><span class="attr">    lease-renewal-interval-in-seconds:</span> <span class="number">5</span> <span class="comment"># 5秒一次心跳</span></div></pre></td></tr></table></figure>
<h3 id="5-3-服务消费者"><a href="#5-3-服务消费者" class="headerlink" title="5.3.服务消费者"></a>5.3.服务消费者</h3><blockquote>
<p>获取服务列表</p>
</blockquote>
<p>当服务消费者启动时，会检测<code>eureka.client.fetch-registry=true</code>参数的值，如果为true，则会拉取Eureka Server服务的列表只读备份，然后缓存在本地。并且<code>每隔30秒</code>会重新获取并更新数据。我们可以通过下面的参数来修改：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">eureka:</span></div><div class="line"><span class="attr">  client:</span></div><div class="line"><span class="attr">    registry-fetch-interval-seconds:</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<p>生产环境中，我们不需要修改这个值。</p>
<p>但是为了开发环境下，能够快速得到服务的最新状态，我们可以将其设置小一点。</p>
<h3 id="5-4-失效剔除和自我保护"><a href="#5-4-失效剔除和自我保护" class="headerlink" title="5.4.失效剔除和自我保护"></a>5.4.失效剔除和自我保护</h3><blockquote>
<p>服务下线</p>
</blockquote>
<p>当服务进行正常关闭操作时，它会触发一个服务下线的REST请求给Eureka Server，告诉服务注册中心：“我要下线了”。服务中心接受到请求之后，将该服务置为下线状态。</p>
<blockquote>
<p>失效剔除</p>
</blockquote>
<p>有些时候，我们的服务提供方并不一定会正常下线，可能因为内存溢出、网络故障等原因导致服务无法正常工作。Eureka Server需要将这样的服务剔除出服务列表。因此它会开启一个定时任务，每隔60秒对所有失效的服务（超过90秒未响应）进行剔除。</p>
<p>可以通过<code>eureka.server.eviction-interval-timer-in-ms</code>参数对其进行修改，单位是毫秒，生产环境不要修改。</p>
<p>这个会对我们开发带来极大的不变，你对服务重启，隔了60秒Eureka才反应过来。开发阶段可以适当调整，比如：10秒</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1528696142799.png" alt="1528696142799"></p>
<blockquote>
<p>自我保护</p>
</blockquote>
<p>我们关停一个服务，就会在Eureka面板看到一条警告：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1525618396076.png" alt="1525618396076"></p>
<p>这是触发了Eureka的自我保护机制。当一个服务未按时进行心跳续约时，Eureka会统计最近15分钟心跳失败的服务实例的比例是否超过了85%。在生产环境下，因为网络延迟等原因，心跳失败实例的比例很有可能超标，但是此时就把服务剔除列表并不妥当，因为服务可能没有宕机。Eureka就会把当前实例的注册信息保护起来，不予剔除。生产环境下这很有效，保证了大多数服务依然可用。</p>
<p><strong>也就是好死不如赖活着，这个就是用EurekaServer的AP原则，保证可用性</strong></p>
<p>但是这给我们的开发带来了麻烦， 因此开发阶段我们都会关闭自我保护模式：（itcast-eureka）</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">eureka:</span></div><div class="line"><span class="attr">  server:</span></div><div class="line"><span class="attr">    enable-self-preservation:</span> <span class="literal">false</span> <span class="comment"># 关闭自我保护模式（缺省为打开）</span></div><div class="line"><span class="attr">    eviction-interval-timer-in-ms:</span> <span class="number">1000</span> <span class="comment"># 扫描失效服务的间隔时间（缺省为60*1000ms）</span></div></pre></td></tr></table></figure>
<p><strong>综上，自我保护模式是一种应对网络异常的安全保护措施。它的架构哲学是宁可同时保留所有微服务（健康的微服务和不健康的微服务都会保留），也不盲目注销任何健康的微服务。使用自我保护模式，可以让Eureka集群更加的健壮、稳定。</strong></p>
<p><strong>一句话：某时刻某一个微服务不可用了，eureka不会立刻清理，依旧会对该微服务的信息进行保存</strong></p>
<h2 id="6-消费者获取服务信息"><a href="#6-消费者获取服务信息" class="headerlink" title="6.消费者获取服务信息"></a>6.消费者获取服务信息</h2><p>如果我们想要在消费者端获取服务者提供的服务实例列表，那么应该怎么做？<strong>对于注册进eureka里面的微服务，可以通过服务发现来获得该服务的信息</strong></p>
<p>既然是消费者端想查看服务端暴露的服务信息，那么就需要在服务提供者实现一个查询暴露服务实例的列表的接口</p>
<p>1.修改服务端PersonController</p>
<p>添加如下代码，查询服务名称为MICROSERVICECLOUD-PERSON的服务实例列表信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Autowired</div><div class="line">private DiscoveryClient client;</div><div class="line">@RequestMapping(value = &quot;/person/discovery&quot;, method = RequestMethod.GET)</div><div class="line">public Object discovery()</div><div class="line">&#123;</div><div class="line">	List&lt;String&gt; list = client.getServices();</div><div class="line">	System.out.println(&quot;**********&quot; + list);</div><div class="line"></div><div class="line">	List&lt;ServiceInstance&gt; srvList = client.getInstances(&quot;MICROSERVICECLOUD-PERSON&quot;);</div><div class="line">	for (ServiceInstance element : srvList) &#123;</div><div class="line">		System.out.println(element.getServiceId() + &quot;\t&quot; + element.getHost() + &quot;\t&quot; + element.getPort() + &quot;\t&quot;</div><div class="line">				+ element.getUri());</div><div class="line">	&#125;</div><div class="line">	return this.client;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.服务提供者启动类添加注解@EnableDiscoveryClient （后来测试发现其实这一步是多余的）</p>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1565967990809.png" alt="1565967990809"></p>
<p>因为@EnableEurekaClient注解已经包含了@EnableDiscoveryClient 注解</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1565968096288.png" alt="1565968096288"></p>
<p><strong>也就是说当服务注册中心是Eureka的时候那么官方已经为了包装了一个注解替代了@EnableDiscoveryClient，但是如果注册中心不是Eureka的话，那么建议使用@EnableDiscoveryClient注解实现服务发现，因为这里注册中心是Eureka那么就是用官方推荐的@EnableEurekaClient</strong></p>
<p>3.修改ConsumerController代码，访问服务提供者提供的接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"> <span class="comment">// 测试@EnableDiscoveryClient,消费端可以调用服务发现</span></div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/consumer/person/discovery"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">discovery</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">return</span> restTemplate.getForObject(REST_URL_PREFIX + <span class="string">"/person/discovery"</span>, Object.class);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4.启动服务提供者和服务消费者</p>
<p>消费者访问接口</p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1565968242592.png" alt="1565968242592"></p>
<h2 id="7-EurekaServer集群"><a href="#7-EurekaServer集群" class="headerlink" title="7.EurekaServer集群"></a>7.EurekaServer集群</h2><p>单个的EurekaServer很明显是不符合HA，高可用原则，所以下面再加两台EurekaServer-8002和8003构成EurekaServer集群</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1565970421791.png" alt="1565970421791"></p>
<p>基本原理</p>
<blockquote>
<p> 上图是来自eureka的官方架构图，这是基于集群配置的eureka； </p>
<p> - 处于不同节点的eureka通过Replicate进行数据同步 </p>
<p> - Application Service为服务提供者 </p>
<p> - Application Client为服务消费者 </p>
<p> - Make Remote Call完成一次服务调用</p>
<p> 服务启动后向Eureka注册，Eureka Server会将注册信息向其他Eureka Server进行同步，当服务消费者要调用服务提供者，则向服务注册中心获取服务提供者地址，然后会将服务提供者地址缓存在本地，下次再调用时，则直接从本地缓存中取，完成一次调用。</p>
<p> 当服务注册中心Eureka Server检测到服务提供者因为宕机、网络原因不可用时，则在服务注册中心将服务置为DOWN状态，并把当前服务提供者状态向订阅者发布，订阅过的服务消费者更新本地缓存。</p>
<p> 服务提供者在启动后，周期性（默认30秒）向Eureka Server发送心跳，以证明当前服务是可用状态。Eureka Server在一定的时间（默认90秒）未收到客户端的心跳，则认为服务宕机，注销该实例。</p>
</blockquote>
<h3 id="7-1-根据microservicecloud-eureka-7001创建两个相同的工程"><a href="#7-1-根据microservicecloud-eureka-7001创建两个相同的工程" class="headerlink" title="7.1 根据microservicecloud-eureka-7001创建两个相同的工程"></a>7.1 根据microservicecloud-eureka-7001创建两个相同的工程</h3><p>分别是microservicecloud-eureka-7002和microservicecloud-eureka-7003</p>
<p>按照7001为模板粘贴POM</p>
<p>修改7002和7003的主启动类</p>
<p>完整工程如下</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1565970941327.png" alt="1565970941327"></p>
<h3 id="7-2-修改映射配置-实现唯一的eureka服务端的实例名称"><a href="#7-2-修改映射配置-实现唯一的eureka服务端的实例名称" class="headerlink" title="7.2 修改映射配置-实现唯一的eureka服务端的实例名称"></a>7.2 修改映射配置-实现唯一的eureka服务端的实例名称</h3><p>为了模拟EurekaServer集群，不同的EurekaServer在不同的机器，而且拥有不同的实例名称</p>
<p><strong>找到C:\Windows\System32\drivers\etc路径下的hosts文件</strong></p>
<table>
<thead>
<tr>
<th><strong>修改映射配置添加进hosts文件</strong></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>127.0.0.1  peer1</strong></td>
<td></td>
</tr>
<tr>
<td><strong>127.0.0.1  peer2</strong></td>
<td></td>
</tr>
<tr>
<td><strong>127.0.0.1  peer3</strong></td>
</tr>
</tbody>
</table>
<h3 id="7-3-修改7001-7003三台EurekaServer的配置文件"><a href="#7-3-修改7001-7003三台EurekaServer的配置文件" class="headerlink" title="7.3 修改7001-7003三台EurekaServer的配置文件"></a>7.3 修改7001-7003三台EurekaServer的配置文件</h3><p>7001 修改内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 7001</div><div class="line"></div><div class="line">eureka:</div><div class="line">  instance:</div><div class="line">    hostname: peer1 #peer1 #eureka服务端的实例名称</div><div class="line">  client:</div><div class="line">    register-with-eureka: false     #false表示不向注册中心注册自己。</div><div class="line">    fetch-registry: false     #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</div><div class="line">    service-url:</div><div class="line">       defaultZone: http://peer2:7002/eureka/,http://peer3:7003/eureka/ #注册7002和7003 自己不用声明</div></pre></td></tr></table></figure>
<p>7002 修改内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 7002</div><div class="line"></div><div class="line">eureka:</div><div class="line">  instance:</div><div class="line">    hostname: peer2 #eureka服务端的实例名称</div><div class="line">  client:</div><div class="line">    register-with-eureka: false     #false表示不向注册中心注册自己。</div><div class="line">    fetch-registry: false     #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</div><div class="line">    service-url:</div><div class="line">       defaultZone: http://peer1:7001/eureka/,http://peer3:7003/eureka/ #注册7001和7003 自己不用声明</div><div class="line">       #等同于http://localhost:7001/eureka/</div></pre></td></tr></table></figure>
<p>7003修改内容如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 7003</div><div class="line"></div><div class="line">eureka:</div><div class="line">  instance:</div><div class="line">    hostname: peer3 #eureka服务端的实例名称</div><div class="line">  client:</div><div class="line">    register-with-eureka: false     #false表示不向注册中心注册自己。</div><div class="line">    fetch-registry: false     #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</div><div class="line">    service-url:</div><div class="line">       defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/ #注册7001和7002 自己不用声明</div><div class="line">       #等同于http://localhost:7001/eureka/</div></pre></td></tr></table></figure>
<p>需要注意的是service-url:defaultZone的值，都是包含其他EurekaServer的值，不用书写自己的。</p>
<h3 id="7-4-修改服务提供者的配置文件"><a href="#7-4-修改服务提供者的配置文件" class="headerlink" title="7.4 修改服务提供者的配置文件"></a>7.4 修改服务提供者的配置文件</h3><p>也就是修改microservicecloud-provider-person-8001模块修改内容如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 8001</div><div class="line"></div><div class="line">mybatis:</div><div class="line">  config-location: classpath:mybatis/mybatis.cfg.xml        # mybatis配置文件所在路径</div><div class="line">  type-aliases-package: com.kingge.entity    # 所有Entity别名类所在包</div><div class="line">  mapper-locations:</div><div class="line">  - classpath:mybatis/mapper/**/*.xml                       # mapper映射文件</div><div class="line"></div><div class="line">spring:</div><div class="line">   application:</div><div class="line">    name: microservicecloud-person                          #很重要，对外暴露的微服务的名称</div><div class="line">   datasource:</div><div class="line">    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型</div><div class="line">    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包</div><div class="line">    url: jdbc:mysql://127.0.0.1:3306/test              # 数据库名称</div><div class="line">    username: root</div><div class="line">    password: 123</div><div class="line">    dbcp2:</div><div class="line">      min-idle: 5                                           # 数据库连接池的最小维持连接数</div><div class="line">      initial-size: 5                                       # 初始化连接数</div><div class="line">      max-total: 5                                          # 最大连接数</div><div class="line">      max-wait-millis: 200                                  # 等待连接获取的最大超时时间</div><div class="line">#</div><div class="line">eureka:</div><div class="line">  client: #客户端注册进eureka服务列表内</div><div class="line">    service-url:</div><div class="line">      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">#      http://localhost:7001/eureka #单机版本使用</div><div class="line">#      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">  instance:</div><div class="line">    instance-id: microservicecloud-person8001 #自定义服务实例名</div><div class="line">    prefer-ip-address: true     #访问路径可以显示IP地址</div><div class="line">#</div><div class="line">info:</div><div class="line">  app.name: $&#123;spring.application.name&#125;</div><div class="line">  company.name: kingge.top</div><div class="line">  build.artifactId: $&#123;project.artifactId&#125;</div><div class="line">  build.version: $&#123;project.version&#125;</div><div class="line">  app.desc: 这是一个提供查询部门人员信息的服务</div></pre></td></tr></table></figure>
<p>实际上就是修改了service-url:defaultZone的值，修改为了EurekaServer集群的地址，其他配置没有改变</p>
<h3 id="7-5重启7001-7003服务器"><a href="#7-5重启7001-7003服务器" class="headerlink" title="7.5重启7001-7003服务器"></a>7.5重启7001-7003服务器</h3><p>也就是分别运行ApplicationBootStart7001、ApplicationBootStart7002、ApplicationBootStart7003</p>
<p>访问查看</p>
<p><img src="/2019/05/01/SpringCloud个人总结/565971841015.png" alt="1565971841015"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/1565972117167.png" alt="1565972117167"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/963618212368.png" alt="1565972150084"></p>
<p>部署成功！！！！！！！</p>
<h2 id="8-Eureka和Zookeeper-服务注册中心比较"><a href="#8-Eureka和Zookeeper-服务注册中心比较" class="headerlink" title="8.Eureka和Zookeeper-服务注册中心比较"></a>8.<strong>Eureka和Zookeeper-服务注册中心比较</strong></h2><p>著名的CAP理论指出，一个分布式系统不可能同时满足C(一致性)、A(可用性)和P(分区容错性)。由于分区容错性P在是分布式系统中必须要保证的，因此我们只能在A和C之间进行权衡。</p>
<p>那么分布式系统，必然要求分区容错性，也就是P原则，那么Zookeeper选择了C，Eureka选择了A</p>
<p> 因此Zookeeper保证的是CP,Eureka则是AP。</p>
<h3 id="8-1-Zookeeper保证CP"><a href="#8-1-Zookeeper保证CP" class="headerlink" title="8.1 Zookeeper保证CP"></a>8.1 Zookeeper保证CP</h3><pre><code>当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。
</code></pre><h3 id="8-2-Eureka保证AP"><a href="#8-2-Eureka保证AP" class="headerlink" title="8.2 Eureka保证AP"></a>8.2 Eureka保证AP</h3><pre><code>Eureka看明白了这一点，因此在设计时就优先保证可用性。Eureka各个节点都是平等的 ，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况： 
</code></pre><blockquote>
<pre><code>Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务 

Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)

当网络稳定时，当前实例新的注册信息会被同步到其它节点中
</code></pre><p>因此， Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。</p>
</blockquote>
<p> 那么既然保证了保证了可用性，那么数据的一致性肯定是不能够保证了，所以这个就是自我保护的机制。所以到底是AP还是CP，又或者是AC（数据库），要看业务场景来定。</p>
<h1 id="七、Ribbon负载均衡"><a href="#七、Ribbon负载均衡" class="headerlink" title="七、Ribbon负载均衡"></a>七、<strong>Ribbon负载均衡</strong></h1><p><strong>接下来解决第二个问题，那就是假设在多个服务提供者提供服务的情况下，怎么做到负载均衡，解决需要把服务提供者url硬编码到消费者端的问题。</strong></p>
<h2 id="7-1-Ribbon概念"><a href="#7-1-Ribbon概念" class="headerlink" title="7.1 Ribbon概念"></a>7.1 Ribbon概念</h2><p>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套<strong>客户端 负载均衡的工具</strong> 。</p>
<pre><code>简单的说，Ribbon是Netflix发布的开源项目，主要功能是提供**客户端**的**软件负载**均衡算法，将Netflix的中间层服务连接在一起。Ribbon客户端组件提供一系列完善的配置项如连接超时，重试等。简单的说，就是在配置文件中列出Load Balancer（简称LB）后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询，随机连接等）去连接这些机器。我们也很容易使用Ribbon**实现自定义的负载均衡算法**。
</code></pre><h2 id="7-2-什么叫LB（负载均衡）"><a href="#7-2-什么叫LB（负载均衡）" class="headerlink" title="7.2 什么叫LB（负载均衡）"></a>7.2 什么叫<strong>LB（负载均衡）</strong></h2><p> LB，即负载均衡(Load Balance)，在微服务或分布式集群中经常用的一种应用。</p>
<p>负载均衡简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的HA。</p>
<p>常见的负载均衡有软件Nginx，LVS，硬件 F5等。</p>
<p>相应的在中间件，例如：dubbo和SpringCloud中均给我们提供了负载均衡，SpringCloud的负载均衡算法可以自定义。 </p>
<p> 两种负载均衡：</p>
<ol>
<li>集中式LB：偏硬件，服务的消费方和提供方之间使用独立的LB设施，由该设施负责把访问请求以某种策略转发至服务的提供方。</li>
<li><p>进程内LB：偏软件， 将LB逻辑集成到消费方，消费方从服务注册中心指导哪些地址可用，再自己选择一个合适的服务器。</p>
<p><strong>Ribbon就属于进程内LB，它只是一个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址。</strong></p>
</li>
</ol>
<h2 id="7-3-Ribbon负载均衡实现"><a href="#7-3-Ribbon负载均衡实现" class="headerlink" title="7.3 Ribbon负载均衡实现"></a>7.3 Ribbon负载均衡实现</h2><p>因为在上面的例子中只存在一个8001模块在提供服务，那么为了能够演示负载均衡的例子，这里需要再增加两个服务提供者8002和8003</p>
<h3 id="7-3-1-根据8001模块复制新建两份分别命名为8002和8003"><a href="#7-3-1-根据8001模块复制新建两份分别命名为8002和8003" class="headerlink" title="7.3.1 根据8001模块复制新建两份分别命名为8002和8003"></a>7.3.1 根据8001模块复制新建两份分别命名为8002和8003</h3><p>请看完整项目结构图</p>
<p>8002模块</p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1566008410173.png" alt="1566008410173"></p>
<p>8003模块</p>
<p><img src="/2019/05/01/SpringCloud个人总结/566008463016.png" alt="1566008463016"></p>
<h3 id="7-3-2-新建数据库test2、test3，让各自微服务分别连各自的数据库"><a href="#7-3-2-新建数据库test2、test3，让各自微服务分别连各自的数据库" class="headerlink" title="7.3.2 新建数据库test2、test3，让各自微服务分别连各自的数据库"></a>7.3.2 新建数据库test2、test3，<strong>让各自微服务分别连各自的数据库</strong></h3><p>我们知道一个微服务可能是一套完整的系统，那么也就意味着他可能拥有自己的数据库。而且为了方便测试负载均衡，我们让8001-8003这三个服务提供者各自连接自己的数据库，也方便验证负载均衡是否实现。</p>
<p>给test2数据库导入数据：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DROP TABLE IF EXISTS `person`;</div><div class="line">CREATE TABLE `person` (</div><div class="line">  `deptno` int(255) NOT NULL AUTO_INCREMENT,</div><div class="line">  `db_source` varchar(255) DEFAULT NULL,</div><div class="line">  `dname` varchar(255) DEFAULT NULL,</div><div class="line">  PRIMARY KEY (`deptno`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">-- ----------------------------</div><div class="line">-- Records of person</div><div class="line">-- ----------------------------</div><div class="line">INSERT INTO `person` VALUES (&apos;5&apos;, &apos;test2&apos;, &apos;开发部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;6&apos;, &apos;test2&apos;, &apos;人事部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;7&apos;, &apos;test2&apos;, &apos;集成部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;8&apos;, &apos;test2&apos;, &apos;市场部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;9&apos;, &apos;test2&apos;, &apos;hr&apos;);</div></pre></td></tr></table></figure>
<p>db_source字段标识，数据来源那个数据库</p>
<p>给test3数据库导入数据：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DROP TABLE IF EXISTS `person`;</div><div class="line">CREATE TABLE `person` (</div><div class="line">  `deptno` int(255) NOT NULL AUTO_INCREMENT,</div><div class="line">  `db_source` varchar(255) DEFAULT NULL,</div><div class="line">  `dname` varchar(255) DEFAULT NULL,</div><div class="line">  PRIMARY KEY (`deptno`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">-- ----------------------------</div><div class="line">-- Records of person</div><div class="line">-- ----------------------------</div><div class="line">INSERT INTO `person` VALUES (&apos;5&apos;, &apos;test3&apos;, &apos;开发部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;6&apos;, &apos;test3&apos;, &apos;人事部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;7&apos;, &apos;test3&apos;, &apos;集成部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;8&apos;, &apos;test3&apos;, &apos;市场部&apos;);</div><div class="line">INSERT INTO `person` VALUES (&apos;9&apos;, &apos;test3&apos;, &apos;hr&apos;);</div></pre></td></tr></table></figure>
<p><img src="/2019/05/01/SpringCloud个人总结/6009325282.png" alt="1566009325282"></p>
<h3 id="7-3-3-修改8002-8003各自application-yml配置文件"><a href="#7-3-3-修改8002-8003各自application-yml配置文件" class="headerlink" title="7.3.3 修改8002/8003各自application.yml配置文件"></a>7.3.3 <strong>修改8002/8003各自application.yml配置文件</strong></h3><p>实际上只需要修改三个地方：服务暴露的端口号，服务连接的数据库，服务的实例名</p>
<p><strong>注意：服务名称不能够修改</strong></p>
<p><img src="/2019/05/01/SpringCloud个人总结/566008980542.png" alt="1566008980542"></p>
<p><strong><em>因为这三个服务都是提供同样的业务，那么就不会归属到一个服务组下，也就是说我们想要的是：microservicecloud-person 这个服务名称（服务组）下面有三个服务实例（8001-8003）提供服务，这样负载均衡才能够演示</em></strong></p>
<blockquote>
<p>8002模块修改如下</p>
</blockquote>
<p><img src="/2019/05/01/SpringCloud个人总结/66009196970.png" alt="1566009196970"></p>
<blockquote>
<p>8003模块修改如下</p>
</blockquote>
<p><img src="/2019/05/01/SpringCloud个人总结/1566009240467.png" alt="1566009240467"></p>
<h3 id="7-3-4-启动EurekaServer集群和8001-8003服务模块"><a href="#7-3-4-启动EurekaServer集群和8001-8003服务模块" class="headerlink" title="7.3.4 启动EurekaServer集群和8001-8003服务模块"></a>7.3.4 启动EurekaServer集群和8001-8003服务模块</h3><p><img src="/2019/05/01/SpringCloud个人总结/6009501569.png" alt="1566009501569"></p>
<p>查看EurekaServer</p>
<p><a href="http://peer1:7001/" target="_blank" rel="external">http://peer1:7001/</a></p>
<p><img src="/2019/05/01/SpringCloud个人总结/6009599956.png" alt="1566009599956"></p>
<p><a href="http://peer2:7002/" target="_blank" rel="external">http://peer2:7002/</a></p>
<p><img src="/2019/05/01/SpringCloud个人总结/566009617535.png" alt="1566009617535"></p>
<p><a href="http://peer3:7003/" target="_blank" rel="external">http://peer3:7003/</a></p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1566009632534.png" alt="1566009632534"></p>
<p>服务提供者集群创建成功</p>
<h3 id="7-3-5-自测启动的服务是否可用"><a href="#7-3-5-自测启动的服务是否可用" class="headerlink" title="7.3.5 自测启动的服务是否可用"></a>7.3.5 自测启动的服务是否可用</h3><p><img src="/2019/05/01/SpringCloud个人总结/1566009826135.png" alt="1566009826135"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/566009838479.png" alt="1566009838479"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566009865015.png" alt="1566009865015"></p>
<h3 id="7-3-6-修改服务消费者-采取负载均衡方式访问服务"><a href="#7-3-6-修改服务消费者-采取负载均衡方式访问服务" class="headerlink" title="7.3.6 修改服务消费者-采取负载均衡方式访问服务"></a>7.3.6 修改服务消费者-采取负载均衡方式访问服务</h3><p>也就是修改microservicecloud-consumer-person-80模块</p>
<p><strong>（1）修改pom文件添加Robbin依赖</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- Ribbon相关 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p><strong>（2）修改application.yml文件</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 80</div><div class="line">  </div><div class="line">#</div><div class="line">eureka:</div><div class="line">  client:</div><div class="line">    register-with-eureka: false</div><div class="line">    service-url:</div><div class="line">      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div></pre></td></tr></table></figure>
<p>也就是修改服务注册中心地址为集群地址</p>
<p><strong>（3）修改ConfigBean配置类添加@LoadBalanced注解，获取rest服务的时候添加ribbon</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class ConfigBean</div><div class="line">&#123; </div><div class="line">	@Bean</div><div class="line">	@LoadBalanced</div><div class="line">	public RestTemplate getRestTemplate()</div><div class="line">	&#123;</div><div class="line">		return new RestTemplate();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>（4）主启动类ApplicationBootStart80添加@EnableEurekaClient</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableEurekaClient//这里建议使用@EnableDiscoveryClient 替换@EnableEurekaClient</div><div class="line">public class ApplicationBootStart80 &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart80.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="7-3-7-修改服务消费者"><a href="#7-3-7-修改服务消费者" class="headerlink" title="7.3.7 修改服务消费者"></a>7.3.7 修改服务消费者</h3><p>修改ConsumerController代码</p>
<p>修改内容如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//    private static final String REST_URL_PREFIX = &quot;http://localhost:8001&quot;;</div><div class="line">    private static final String REST_URL_PREFIX = &quot;http://MICROSERVICECLOUD-PERSON&quot;;</div></pre></td></tr></table></figure>
<p>把url更改为服务名称</p>
<p><strong>Ribbon和Eureka整合后Consumer可以直接调用服务而不用再关心地址和端口号</strong></p>
<h3 id="7-3-8-启动7001-7003-8001-8003，80"><a href="#7-3-8-启动7001-7003-8001-8003，80" class="headerlink" title="7.3.8 启动7001-7003,8001-8003，80"></a>7.3.8 启动7001-7003,8001-8003，80</h3><p><img src="/2019/05/01/SpringCloud个人总结/566010881201.png" alt="1566010881201"></p>
<p>启动完成后测试：</p>
<p>第一次访问</p>
<p><img src="/2019/05/01/SpringCloud个人总结/566011120741.png" alt="1566011120741"></p>
<p>第二次访问：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566011157293.png" alt="1566011157293"></p>
<p>第三次访问：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/6011173416.png" alt="1566011173416"></p>
<p>第四次访问：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/66011196418.png" alt="1566011196418"></p>
<p>我们注意db_source的值是变换的，说明负载均衡成功。但是当我们访问一轮后，发现他又从头开始：</p>
<p>test2-&gt;test3-&gt;test-&gt;test2-&gt;test3-&gt;test  说明Ribbon默认采用的是轮询的负载均衡策略</p>
<h3 id="7-3-9-总结"><a href="#7-3-9-总结" class="headerlink" title="7.3.9 总结"></a>7.3.9 总结</h3><p><img src="/2019/05/01/SpringCloud个人总结/1566011028903.png" alt="1566011028903"></p>
<p>Ribbon在工作时分成两步</p>
<blockquote>
<p>第一步先选择 EurekaServer ,它优先选择在同一个区域内负载较少的server. </p>
<p>第二步再根据用户指定的策略，在从server取到的服务注册列表中选择一个地址。</p>
</blockquote>
<p>其中Ribbon提供了多种策略：比如轮询、随机和根据响应时间加权。</p>
<p><strong>Ribbon其实就是一个软负载均衡的客户端组件， 他可以和其他所需请求的客户端结合使用，和eureka结合只是其中的一个实例。</strong></p>
<h2 id="7-4-Ribbon负载均衡实现核心接口IRule"><a href="#7-4-Ribbon负载均衡实现核心接口IRule" class="headerlink" title="7.4 Ribbon负载均衡实现核心接口IRule"></a>7.4 Ribbon负载均衡实现核心接口IRule</h2><h3 id="7-4-1-源码跟踪"><a href="#7-4-1-源码跟踪" class="headerlink" title="7.4.1.源码跟踪"></a>7.4.1.源码跟踪</h3><p>为什么我们只输入了service名称就可以访问了呢？之前还要获取ip和端口。</p>
<p>显然有人帮我们根据service名称，获取到了服务实例的ip和端口。它就是<code>LoadBalancerInterceptor</code></p>
<p>在consumer的ConsumerController如下代码打断点：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/566012847807.png" alt="1566012847807"></p>
<p>一路源码跟踪：RestTemplate.getForObject –&gt; RestTemplate.execute –&gt; RestTemplate.doExecute：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566013203247.png" alt="1566013203247"></p>
<p>点击进入AbstractClientHttpRequest.execute –&gt; AbstractBufferingClientHttpRequest.executeInternal –&gt; InterceptingClientHttpRequest.executeInternal –&gt; InterceptingClientHttpRequest.execute:</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1528776489965.png" alt="1528776489965"></p>
<p>继续跟入：LoadBalancerInterceptor.intercept方法</p>
<p><img src="/2019/05/01/SpringCloud个人总结/66013476262.png" alt="1566013476262"></p>
<p>获取请求的服务名称，我们发现执行this.loadBalancer.execute()方法的loadBalancer是一个接口LoadBalancerClient，那么很明显执行execute（）方法的只能是LoadBalancerClient的实现类。</p>
<p>继续跟入execute方法发现执行该方法的类是：RibbonLoadBalancerClient负载均衡客户端类：</p>
<p>发现获取了8003端口的服务</p>
<p><img src="/2019/05/01/SpringCloud个人总结/566013958604.png" alt="1566013958604"></p>
<p>我们查看一下获取的负载均衡器的信息：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566014122746.png" alt="1566014122746"></p>
<h3 id="7-4-2-负载均衡策略"><a href="#7-4-2-负载均衡策略" class="headerlink" title="7.4.2.负载均衡策略"></a>7.4.2.负载均衡策略</h3><p>Ribbon默认的负载均衡策略是简单的轮询，我们可以测试一下：</p>
<p>编写测试类，在刚才的源码中我们看到拦截中是使用RibbonLoadBalanceClient来进行负载均衡的，其中有一个choose方法，找到choose方法的接口方法，是这样介绍的：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622320277.png" alt="1525622320277"></p>
<p>现在这个就是负载均衡获取实例的方法。</p>
<p>我们注入这个类的对象，然后对其测试：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/C1566014544201.png" alt="1566014544201"></p>
<p>测试内容：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span>(classes = ApplicationBootStart80.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadBalanceTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> RibbonLoadBalancerClient client;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadBalance</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</div><div class="line">            ServiceInstance instance = <span class="keyword">this</span>.client.choose(<span class="string">"MICROSERVICECLOUD-PERSON"</span>);</div><div class="line">            System.out.println(instance.getHost() + <span class="string">":"</span> +instance.getPort());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1566015460435.png" alt="1566015460435"></p>
<p>符合了我们的预期推测，确实是轮询方式。</p>
<p>我们是否可以修改负载均衡的策略呢？</p>
<p>继续跟踪源码，发现这么一段代码：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622652849.png" alt="1525622652849"></p>
<p>我们看看这个rule是谁：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622699666.png" alt="1525622699666"></p>
<p>这里的rule默认值是一个<code>RoundRobinRule</code>，看类的介绍：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622754316.png" alt="1525622754316"></p>
<p>这不就是轮询的意思嘛。</p>
<p>我们注意到，这个类其实是实现了接口IRule的，查看一下：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1525622817451.png" alt="1525622817451"></p>
<p>定义负载均衡的规则接口。</p>
<p>它有以下实现：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91/Spring%E5%AE%B6%E6%97%8F%E8%A7%86%E9%A2%91/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E8%A7%86%E9%A2%91/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3/SpringCloud个人总结/1528782624098.png" alt="1528782624098"></p>
<h4 id="七大方法"><a href="#七大方法" class="headerlink" title="七大方法"></a>七大方法</h4><p>IRule是一个接口，七大方法是其实现类</p>
<ul>
<li>RoundRobinRule：轮询（默认方法）</li>
<li>RandomRule：随机</li>
<li>AvailabilityFilteringRule：先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，还有并发的连接数量超过阈值的服务，然后对剩余的服务进行轮询</li>
<li>WeightedResponseTimeRule：根据平均响应时间计算服务的权重。统计信息不足时会按照轮询，统计信息足够会按照响应的时间选择服务</li>
<li>RetryRule：正常时按照轮询选择服务，若过程中有服务出现故障，在轮询一定次数后依然故障，则会跳过故障的服务继续轮询。</li>
<li>BestAvailableRule：先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，然后选择一个并发量最小的服务</li>
<li>ZoneAvoidanceRule：默认规则，符合判断server所在的区域的性能和server的可用性选择服务</li>
</ul>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566022083352.png" alt="1566022083352"></p>
<h3 id="7-4-3-负载均衡自定义"><a href="#7-4-3-负载均衡自定义" class="headerlink" title="7.4.3 负载均衡自定义"></a>7.4.3 负载均衡自定义</h3><h4 id="1-修改某个服务的负载均衡策略"><a href="#1-修改某个服务的负载均衡策略" class="headerlink" title="1.修改某个服务的负载均衡策略"></a>1.修改某个服务的负载均衡策略</h4><p>例如我们只想修改 MICROSERVICECLOUD-PERSON服务的负载均衡策略</p>
<p><strong>这里一共有两种方法实现一种是使用yml配置的方式声明-一种是使用注解的方式声明</strong></p>
<h5 id="第一种使用配置方式（建议使用）"><a href="#第一种使用配置方式（建议使用）" class="headerlink" title="第一种使用配置方式（建议使用）"></a>第一种使用配置方式（建议使用）</h5><p>（1）修改消费者端（microservicecloud-consumer-person-80）的application.yml配置文件</p>
<p>修改内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">MICROSERVICECLOUD-PERSON: </div><div class="line">  ribbon:</div><div class="line">    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule</div></pre></td></tr></table></figure>
<p>格式是：<code>{服务名称}.ribbon.NFLoadBalancerRuleClassName</code>，值就是IRule的实现类。</p>
<p>（2）运行上面的LoadBalanceTest</p>
<p><img src="/2019/05/01/SpringCloud个人总结/19186732.png" alt="1566019186732"></p>
<h5 id="第二种使用配置方式"><a href="#第二种使用配置方式" class="headerlink" title="第二种使用配置方式"></a>第二种使用配置方式</h5><p><strong>前提：注释掉第一种方式实现的 配置信息（不注释掉也可以，因为第一种方式跟第二种方式同时存在时，以第二种方式为主）</strong></p>
<p>（1）修改消费者端启动类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">#@EnableEurekaClient</div><div class="line">@EnableDiscoveryClient //服务发现</div><div class="line">@RibbonClient(name = &quot;MICROSERVICECLOUD-PERSON&quot;,configuration = OwnRule.class)</div><div class="line">public class ApplicationBootStart80 &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart80.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>添加一下注解</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@RibbonClient(name = &quot;MICROSERVICECLOUD-PERSON&quot;,configuration = OwnRule.class)</div></pre></td></tr></table></figure>
<p>（2）新建OwnRule自定义侧略类</p>
<p>首先新建包com.myrule</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class OwnRule &#123;</div><div class="line">    @Bean</div><div class="line">    public IRule getIuIRule()&#123;</div><div class="line">        System.out.println(&quot;进入了自定义负载均衡策略&quot;);</div><div class="line">        return new RandomRule();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566019594262.png" alt="1566019594262"></p>
<p><strong>注意：</strong></p>
<blockquote>
<p>官方文档明确给出了警告：</p>
<p>这个自定义配置类不能放在@ComponentScan所扫描的当前包下以及子包下，</p>
<p>否则我们自定义的这个配置类就会被所有的Ribbon客户端所共享，也就是说</p>
<p>我们达不到特殊化定制的目的了。</p>
<p>所以上面的OwnRule类是不在启动类同级包或者子包下的。</p>
</blockquote>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566019672480.png" alt="1566019672480"></p>
<p>所以我们也可以利用这个特性，修改全局的所有服务的获取策略为某个策略</p>
<p>（3）运行上面的LoadBalanceTest</p>
<p><img src="/2019/05/01/SpringCloud个人总结/19186732.png" alt="1566019186732"></p>
<h4 id="2-修改全局的服务访问策略（替换默认的轮询策略）"><a href="#2-修改全局的服务访问策略（替换默认的轮询策略）" class="headerlink" title="2. 修改全局的服务访问策略（替换默认的轮询策略）"></a>2. 修改全局的服务访问策略（替换默认的轮询策略）</h4><p>很简单，直接在IOC容器注入想要替换成的负载均衡策略即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class ConfigBean</div><div class="line">applicationContext.xml</div><div class="line">&#123; </div><div class="line">	@Bean</div><div class="line">	@LoadBalanced</div><div class="line">	public RestTemplate getRestTemplate()</div><div class="line">	&#123;</div><div class="line">		return new RestTemplate();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Bean</div><div class="line">	public IRule getIuIRule()&#123;</div><div class="line">		return new RandomRule();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-自定义负载均衡策略"><a href="#3-自定义负载均衡策略" class="headerlink" title="3.自定义负载均衡策略"></a>3.自定义负载均衡策略</h4><p>上上面的两个章节实际上使用的都是Ribbon提供的负载均衡策略，所以接下来我们要实现一个负载均衡策略</p>
<blockquote>
<p>提出需求：</p>
</blockquote>
<p><strong>问题：修改MICROSERVICECLOUD-PERSON服务的负载均衡策略：依旧使用轮询策略，但是加上新需求，每个服务器（现在有三台8001-8003）要求被调用5次。也即 以前是每台机器一次，现在是每台机器5次</strong></p>
<p>在实现之前拜读一下官方的RandomRule 源代码，然后再修改出符合我们需求的策略类</p>
<p><a href="https://github.com/Netflix/ribbon/blob/master/ribbon-loadbalancer/src/main/java/com/netflix/loadbalancer/RandomRule.java" target="_blank" rel="external">https://github.com/Netflix/ribbon/blob/master/ribbon-loadbalancer/src/main/java/com/netflix/loadbalancer/RandomRule.java</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public class RandomRule extends AbstractLoadBalancerRule &#123;</div><div class="line"></div><div class="line">    /**</div><div class="line"></div><div class="line">     * Randomly choose from all living servers</div><div class="line"></div><div class="line">     */</div><div class="line"></div><div class="line">    @edu.umd.cs.findbugs.annotations.SuppressWarnings(value = &quot;RCN_REDUNDANT_NULLCHECK_OF_NULL_VALUE&quot;)</div><div class="line"></div><div class="line">    public Server choose(ILoadBalancer lb, Object key) &#123;</div><div class="line">        if (lb == null) &#123;</div><div class="line">            return null;</div><div class="line">        &#125;</div><div class="line">        Server server = null;//需要返回的服务</div><div class="line"></div><div class="line">        while (server == null) &#123;//使用while循环知道获取服务</div><div class="line"></div><div class="line">            if (Thread.interrupted()) &#123;//如果当前线程已经中断，那么直接返回null</div><div class="line"></div><div class="line">                return null;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            List&lt;Server&gt; upList = lb.getReachableServers();//获取所有可达的服务列表</div><div class="line">            List&lt;Server&gt; allList = lb.getAllServers();//获取所有服务列表</div><div class="line"></div><div class="line">            int serverCount = allList.size();//得到服务列表里服务实例的数量</div><div class="line"></div><div class="line">            if (serverCount == 0) &#123;</div><div class="line"></div><div class="line">                /*</div><div class="line"></div><div class="line">                 * No servers. End regardless of pass, because subsequent passes</div><div class="line"></div><div class="line">                 * only get more restrictive.</div><div class="line"></div><div class="line">                 */</div><div class="line"></div><div class="line">                return null;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            int index = chooseRandomInt(serverCount);//根据服务数量所及获取服务下标</div><div class="line">           等同于Random.rand.nextInt(serverCount);</div><div class="line"></div><div class="line">            server = upList.get(index);//根据随机获取到的下标，从可用服务列表实例中获取服务</div><div class="line">            if (server == null) &#123;//获取不到时，暂停当前正在执行的线程对象(及放弃当前拥有的cup资源),并执行其他线程</div><div class="line">            //然后继续while循环获取</div><div class="line"></div><div class="line">                /*</div><div class="line"></div><div class="line">                 * The only time this should happen is if the server list were</div><div class="line"></div><div class="line">                 * somehow trimmed. This is a transient condition. Retry after</div><div class="line"></div><div class="line">                 * yielding.</div><div class="line"></div><div class="line">                 */</div><div class="line"></div><div class="line">                Thread.yield();</div><div class="line"></div><div class="line">                continue;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (server.isAlive()) &#123;</div><div class="line"></div><div class="line">                return (server);</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            // Shouldn&apos;t actually happen.. but must be transient or a bug.</div><div class="line"></div><div class="line">            server = null;</div><div class="line">            Thread.yield();</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return server;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    protected int chooseRandomInt(int serverCount) &#123;</div><div class="line"></div><div class="line">        return ThreadLocalRandom.current().nextInt(serverCount);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">	@Override</div><div class="line"></div><div class="line">	public Server choose(Object key) &#123;</div><div class="line"></div><div class="line">		return choose(getLoadBalancer(), key);</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码其实很简单</p>
<h5 id="（1）新建RandomRuleModify类"><a href="#（1）新建RandomRuleModify类" class="headerlink" title="（1）新建RandomRuleModify类"></a>（1）新建RandomRuleModify类</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">package com.myrule;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">        import com.netflix.client.config.IClientConfig;</div><div class="line">        import com.netflix.loadbalancer.AbstractLoadBalancerRule;</div><div class="line">        import com.netflix.loadbalancer.ILoadBalancer;</div><div class="line">        import com.netflix.loadbalancer.Server;</div><div class="line"></div><div class="line">public class RandomRuleModify extends AbstractLoadBalancerRule</div><div class="line">&#123;</div><div class="line"></div><div class="line">    // total = 0 // 当total==5以后，我们指针才能往下走，</div><div class="line">    // index = 0 // 当前对外提供服务的服务器地址，</div><div class="line">    // total需要重新置为零，但是已经达到过一个5次，我们的index = 1</div><div class="line">    // 分析：我们5次，但是微服务只有8001 8002 8003 三台，OK？</div><div class="line">    //</div><div class="line"></div><div class="line"></div><div class="line">    private int total = 0; 			// 总共被调用的次数，目前要求每台被调用5次</div><div class="line">    private int currentIndex = 0;	// 当前提供服务的机器号</div><div class="line"></div><div class="line">    public Server choose(ILoadBalancer lb, Object key)</div><div class="line">    &#123;</div><div class="line">        if (lb == null) &#123;</div><div class="line">            return null;</div><div class="line">        &#125;</div><div class="line">        Server server = null;</div><div class="line"></div><div class="line">        while (server == null) &#123;</div><div class="line">            if (Thread.interrupted()) &#123;</div><div class="line">                return null;</div><div class="line">            &#125;</div><div class="line">            List&lt;Server&gt; upList = lb.getReachableServers();</div><div class="line">            List&lt;Server&gt; allList = lb.getAllServers();</div><div class="line"></div><div class="line">            int serverCount = allList.size();</div><div class="line">            if (serverCount == 0) &#123;</div><div class="line">                return null;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if(total &lt; 5)</div><div class="line">            &#123;</div><div class="line">                server = upList.get(currentIndex);</div><div class="line">                total++;</div><div class="line">            &#125;else &#123;</div><div class="line">                total = 0;</div><div class="line">                currentIndex++;</div><div class="line">                if(currentIndex &gt;= upList.size())</div><div class="line">                &#123;</div><div class="line">                    currentIndex = 0;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (server == null) &#123;</div><div class="line">                Thread.yield();</div><div class="line">                continue;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (server.isAlive()) &#123;</div><div class="line">                return (server);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            // Shouldn&apos;t actually happen.. but must be transient or a bug.</div><div class="line">            server = null;</div><div class="line">            Thread.yield();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return server;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Server choose(Object key)</div><div class="line">    &#123;</div><div class="line">        return choose(getLoadBalancer(), key);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void initWithNiwsConfig(IClientConfig clientConfig)</div><div class="line">    &#123;</div><div class="line">        // TODO Auto-generated method stub</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>这个类不能够放在启动类的同级或者子包下，否则将被设置为全局的负载均衡策略，起不到为MICROSERVICECLOUD-PERSON服务定制策略的作用</strong></p>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566021323120.png" alt="1566021323120"></p>
<h5 id="（2）OwnRule返回我们实现的RandomRuleModify"><a href="#（2）OwnRule返回我们实现的RandomRuleModify" class="headerlink" title="（2）OwnRule返回我们实现的RandomRuleModify"></a>（2）OwnRule返回我们实现的RandomRuleModify</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class OwnRule &#123;</div><div class="line">    @Bean</div><div class="line">    public IRule getIuIRule()&#123;</div><div class="line">        System.out.println(&quot;进入了自定义负载均衡策略&quot;);</div><div class="line">        return new RandomRuleModify();//RandomRule();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="（3）修改启动类"><a href="#（3）修改启动类" class="headerlink" title="（3）修改启动类"></a>（3）修改启动类</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">//@EnableEurekaClient</div><div class="line">@EnableDiscoveryClient //服务发现</div><div class="line">@RibbonClient(name = &quot;MICROSERVICECLOUD-PERSON&quot;,configuration = OwnRule.class)</div><div class="line">public class ApplicationBootStart80 &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart80.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="（4）运行测试类LoadBalanceTest"><a href="#（4）运行测试类LoadBalanceTest" class="headerlink" title="（4）运行测试类LoadBalanceTest"></a>（4）运行测试类LoadBalanceTest</h5><p><img src="/2019/05/01/SpringCloud个人总结/5C1566021621272.png" alt="1566021621272"></p>
<p>轮询的同时每个服务器调用五次！！！</p>
<h5 id="（5）总结"><a href="#（5）总结" class="headerlink" title="（5）总结"></a>（5）总结</h5><p>我们也可以使用配置类的方式为某个服务配置特定的负载均衡策略实现类（参考7.4.3.1 章节的第一种配置方式），这样就可以省略上面的第二和第三步骤</p>
<p>通过配置的方式更加，灵活</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566021993675.png" alt="1566021993675"></p>
<p>然后运行测试类LoadBalanceTest，结果一模一样。</p>
<h1 id="八、-Feign负载均衡"><a href="#八、-Feign负载均衡" class="headerlink" title="八、 Feign负载均衡"></a>八、 <strong>Feign负载均衡</strong></h1><h2 id="8-1-简介"><a href="#8-1-简介" class="headerlink" title="8.1.简介"></a>8.1.简介</h2><p>Feign出现的原因是什么，既然他也是提供负载均衡的功能，那么他跟Ribbon有什么区别？</p>
<blockquote>
<p>项目主页：</p>
</blockquote>
<p><a href="https://github.com/OpenFeign/feign" target="_blank" rel="external">https://github.com/OpenFeign/feign</a></p>
<blockquote>
<p>官网解释：</p>
</blockquote>
<p><a href="http://projects.spring.io/spring-cloud/spring-cloud.html#spring-cloud-feign" target="_blank" rel="external">http://projects.spring.io/spring-cloud/spring-cloud.html#spring-cloud-feign</a></p>
<blockquote>
<p> Feign是一个声明式WebService客户端。使用Feign能让编写Web Service客户端更加简单, <strong>它的使用方法是定义一个接口，然后在上面添加注解</strong>，同时也支持JAX-RS标准的注解。Feign也支持可拔插式的编码器和解码器。Spring Cloud对Feign进行了封装，使其支持了Spring MVC标准注解和HttpMessageConverters。Feign<strong>可以与Eureka和Ribbon组合使用以支持负载均衡</strong>。</p>
</blockquote>
<p> <img src="/2019/05/01/SpringCloud个人总结/566106445678.png" alt="1566106445678"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566106480369.png" alt="1566106480369"></p>
<p>Feign的出现的目的是：为了迎合我们平时面向接口编程和调用的习惯。例如我们在Controller通过注入Service层的接口调用相关的业务。但是在上面的Ribbon例子中我们是通过RestTemplate和URL的方式调用某个服务：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/566106719992.png" alt="1566106719992"></p>
<p>Feign的实现其实也很简单：<strong>只需要创建一个接口，然后在上面添加注解即可。</strong></p>
<p>有道词典的英文解释：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image0ee02.png" alt="img"></p>
<p>为什么叫伪装？</p>
<p><strong>Feign可以把Rest的请求进行隐藏，伪装成类似SpringMVC的Controller一样。你不用再自己拼接url，拼接参数等等操作，一切都交给Feign去做。</strong></p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image0ee04.png" alt="img"></p>
<p><strong>总的来说：Feign通过封装Ribbon实现了我们常用的面向接口编程</strong></p>
<h2 id="8-2-实现Feign"><a href="#8-2-实现Feign" class="headerlink" title="8.2 实现Feign"></a>8.2 实现Feign</h2><p>其实就是复制microservicecloud-consumer-person-80工程代码，在做一些修改。</p>
<h3 id="（1）根据父工程新建microservicecloud-consumer-person-80-feign模块"><a href="#（1）根据父工程新建microservicecloud-consumer-person-80-feign模块" class="headerlink" title="（1）根据父工程新建microservicecloud-consumer-person-80-feign模块"></a>（1）根据父工程新建microservicecloud-consumer-person-80-feign模块</h3><h3 id="（2）复制80模块代码到80-feign模块"><a href="#（2）复制80模块代码到80-feign模块" class="headerlink" title="（2）复制80模块代码到80-feign模块"></a>（2）复制80模块代码到80-feign模块</h3><p><img src="/2019/05/01/SpringCloud个人总结/C1566107268418.png" alt="1566107268418"></p>
<p>修改启动类的名字。</p>
<h3 id="（3）修改80-feign模块的pom文件，添加Feign依赖"><a href="#（3）修改80-feign模块的pom文件，添加Feign依赖" class="headerlink" title="（3）修改80-feign模块的pom文件，添加Feign依赖"></a>（3）修改80-feign模块的pom文件，添加Feign依赖</h3><p>添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">       &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">       &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</div><div class="line">   &lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h3 id="（4）修改api公共模块"><a href="#（4）修改api公共模块" class="headerlink" title="（4）修改api公共模块"></a>（4）修改api公共模块</h3><p><strong>也就是修改microservicecloud-api，因为我们知道我们抽象出来的服务，有可能其他模块也会调用，不仅仅是80-feign模块。所以公共的东西我们都放在api模块</strong></p>
<p><strong>1.修改pom文件，添加feign依赖</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">     &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">     &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>2.<strong>新建PersonClientService接口并新增注解@FeignClient</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@FeignClient(value = &quot;MICROSERVICECLOUD-PERSON&quot;)</div><div class="line">public interface PersonClientService</div><div class="line">&#123;</div><div class="line">   @RequestMapping(value = &quot;/person/get/&#123;id&#125;&quot;, method = RequestMethod.GET)</div><div class="line">   public Person get(@PathVariable(&quot;id&quot;) long id);</div><div class="line"></div><div class="line">   @RequestMapping(value = &quot;/person/list&quot;, method = RequestMethod.GET)</div><div class="line">   public List&lt;Person&gt; list();</div><div class="line"></div><div class="line">   @RequestMapping(value = &quot;/person/add&quot;, method = RequestMethod.POST)</div><div class="line">   public boolean add(Person person);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>•               首先这是一个接口，Feign会通过动态代理，帮我们生成实现类。这点跟mybatis的mapper很像</strong></p>
<p><strong>•               @FeignClient，声明这是一个Feign客户端，类似@Mapper注解。同时通过value属性指定服务名称</strong></p>
<p><strong>•               接口中的定义方法，完全采用SpringMVC的注解，Feign会根据注解帮我们生成URL，并访问获取结果</strong></p>
</blockquote>
<h3 id="（5）feign工程修改Controller，添加上一步新建的PersonClientService接口"><a href="#（5）feign工程修改Controller，添加上一步新建的PersonClientService接口" class="headerlink" title="（5）feign工程修改Controller，添加上一步新建的PersonClientService接口"></a>（5）<strong>feign工程修改Controller，添加上一步新建的PersonClientService接口</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@RestController</div><div class="line">public class ConsumerController &#123;</div><div class="line"></div><div class="line">//    @Autowired</div><div class="line">//    private RestTemplate restTemplate;</div><div class="line"></div><div class="line">//    private static final String REST_URL_PREFIX = &quot;http://localhost:8001&quot;;</div><div class="line">//    private static final String REST_URL_PREFIX = &quot;http://MICROSERVICECLOUD-PERSON&quot;;</div><div class="line">@Autowired</div><div class="line">private PersonClientService personClientService;</div><div class="line">    @RequestMapping(value = &quot;/consumer/person/add&quot;)</div><div class="line">    public boolean add(Person person)</div><div class="line">    &#123;</div><div class="line">//        return restTemplate.postForObject(REST_URL_PREFIX + &quot;/person/add&quot;, person, Boolean.class);</div><div class="line">        return personClientService.add(person);</div><div class="line">    &#125;</div><div class="line">    @RequestMapping(value = &quot;/consumer/person/list&quot;)</div><div class="line">    public List&lt;Person&gt; list()</div><div class="line">    &#123;</div><div class="line">//        return restTemplate.getForObject(REST_URL_PREFIX + &quot;/person/list&quot;, List.class);</div><div class="line">        return personClientService.list();</div><div class="line">    &#125;</div><div class="line">        @RequestMapping(value = &quot;/consumer/person/get/&#123;id&#125;&quot;)</div><div class="line">    public Person get(@PathVariable(&quot;id&quot;) Long id)</div><div class="line">    &#123;</div><div class="line">        return this.personClientService.get(id);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到我们注释掉了以往的RestTemplate+URL请求服务的方式，通过注入接口调用的方式，实现了面向借口编程。</p>
<h3 id="（6）feign工程修改主启动类"><a href="#（6）feign工程修改主启动类" class="headerlink" title="（6）feign工程修改主启动类"></a>（6）<strong>feign工程修改主启动类</strong></h3><p>添加@EnableFeignClients // 开启feign客户端</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableDiscoveryClient //服务发现</div><div class="line">@EnableFeignClients // 开启feign客户端</div><div class="line">public class ApplicationBootStart80feign &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart80feign.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="（7）启动EurekaServer7001-7003和服务提供集群8001-8003，启动feign工程进行测试"><a href="#（7）启动EurekaServer7001-7003和服务提供集群8001-8003，启动feign工程进行测试" class="headerlink" title="（7）启动EurekaServer7001-7003和服务提供集群8001-8003，启动feign工程进行测试"></a><strong>（7）启动EurekaServer7001-7003和服务提供集群8001-8003，启动feign工程进行测试</strong></h3><p><img src="/2019/05/01/SpringCloud个人总结/566108827974.png" alt="1566108827974"></p>
<p>请求</p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1566108849361.png" alt="1566108849361"></p>
<p><strong>默认使用轮询的负载均衡方式</strong></p>
<h2 id="8-3-总结"><a href="#8-3-总结" class="headerlink" title="8.3 总结"></a>8.3 总结</h2><p> Feign通过接口的方法调用Rest服务（之前是Ribbon+RestTemplate） ，</p>
<p>该请求发送给Eureka服务器（<a href="http://MICROSERVICECLOUD-PERSON/person/list）" target="_blank" rel="external">http://MICROSERVICECLOUD-PERSON/person/list）</a>,</p>
<p>通过Feign直接找到服务接口，由于在进行服务调用的时候融合了Ribbon技术，所以也支持负载均衡作用。</p>
<p>也就是说Feign只是封装了Ribbon，改造成了我们习惯的面向接口编程的方式。</p>
<p><strong>自定义负载均衡的方式跟之前使用Ribbon 的一样，也就是支持注解和配置两种方式实现某个服务或者全局服务的负载均衡策略自定义</strong></p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableDiscoveryClient //服务发现</div><div class="line">@EnableFeignClients // 开启feign客户端</div><div class="line">@RibbonClient(name = &quot;MICROSERVICECLOUD-PERSON&quot;,configuration = OwnRule.class)</div><div class="line">public class ApplicationBootStart80feign &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart80feign.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="8-4-请求压缩-了解"><a href="#8-4-请求压缩-了解" class="headerlink" title="8.4.请求压缩(了解)"></a>8.4.请求压缩(了解)</h2><p>Spring Cloud Feign 支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗。通过下面的参数即可开启请求与响应的压缩功能：</p>
<p>feign:<br>   compression:<br>     request:<br>       enabled: true # 开启请求压缩<br>     response:<br>       enabled: true # 开启响应压缩</p>
<p>同时，我们也可以对请求的数据类型，以及触发压缩的大小下限进行设置：</p>
<p>feign:<br>   compression:<br>     request:<br>       enabled: true # 开启请求压缩<br>       mime-types: text/html,application/xml,application/json # 设置压缩的数据类型<br>       min-request-size: 2048 # 设置触发压缩的大小下限</p>
<p>注：上面的数据类型、压缩大小下限均为默认值。</p>
<h2 id="8-5-日志级别-了解"><a href="#8-5-日志级别-了解" class="headerlink" title="8.5.日志级别(了解)"></a>8.5.日志级别(了解)</h2><p>前面讲过，通过logging.level.xx=debug来设置日志级别。然而这个对Fegin客户端而言不会产生效果。因为@FeignClient注解修改的客户端在被代理时，都会创建一个新的Fegin.Logger实例。我们需要额外指定这个日志的级别才可以。</p>
<p>1）设置com.kingge包下的日志级别都为debug</p>
<p>logging:<br>   level:<br>     com.kingge: debug</p>
<p>2）新建FeignLogConfiguration配置类，定义日志级别</p>
<p>内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class FeignLogConfiguration &#123;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    Logger.Level feignLoggerLevel()&#123;</div><div class="line">        return Logger.Level.FULL;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里指定的Level级别是FULL，Feign支持4种级别：</p>
<p>•               NONE：不记录任何日志信息，这是默认值。</p>
<p>•               BASIC：仅记录请求的方法，URL以及响应状态码和执行时间</p>
<p>•               HEADERS：在BASIC的基础上，额外记录了请求和响应的头信息</p>
<p>•               FULL：记录所有请求和响应的明细，包括头信息、请求体、元数据。</p>
<p>3）在FeignClient中指定配置类：</p>
<p>@FeignClient(value = “MICROSERVICECLOUD-PERSON” configuration = FeignLogConfiguration.class)<br> public interface UserFeignClient {<br>     @GetMapping(“/user/{id}”)<br>     User queryUserById(@PathVariable(“id”) Long id);<br> }</p>
<p>4）重启项目，即可看到每次访问的日志：</p>
<h2 id="8-6-Hystrix支持"><a href="#8-6-Hystrix支持" class="headerlink" title="8.6.Hystrix支持"></a>8.6.Hystrix支持</h2><p>参加下面服务降级的案例</p>
<h1 id="九、Hystrix断路器"><a href="#九、Hystrix断路器" class="headerlink" title="九、Hystrix断路器"></a>九、Hystrix断路器</h1><pre><code>**首先我们来解决第三问题，服务的容灾处理**
</code></pre><p><strong>跟Ribbon和Feign是客户端技术不同的是Hystrix是服务端的技术，也就是他是作用在服务提供端</strong></p>
<h2 id="1-分布式系统面临的问题"><a href="#1-分布式系统面临的问题" class="headerlink" title="1.分布式系统面临的问题"></a>1.<strong>分布式系统面临的问题</strong></h2><p><strong>复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免地失败</strong></p>
<p><strong>1.雪崩问题</strong></p>
<p>微服务中，服务间调用关系错综复杂，一个请求，可能需要调用多个微服务接口才能实现，会形成非常复杂的调用链路：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/646178ttttt01.png" alt="标题: fig:"></p>
<p>如图，一次业务请求，需要调用A、P、H、I四个服务，这四个服务又可能调用其它服务（这个就是所谓的<strong>扇出</strong>）。</p>
<p>如果此时，某个服务出现异常：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/64rrrttt01.png" alt="标题: fig:"></p>
<p>例如微服务I发生异常，请求阻塞，用户不会得到响应，则tomcat的这个线程不会释放，于是越来越多的用户请求到来，越来越多的线程会阻塞：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/565964513rrr626.png" alt="标题: fig:"></p>
<p>服务器支持的线程和并发数有限，请求一直阻塞，会导致服务器资源耗尽，从而导致所有其它服务都不可用，形成<strong>雪崩效应</strong>，<strong>所以我们需要阻断故障的传播，这个就是断路器</strong>。</p>
<p>这就好比，一个汽车生产线，生产不同的汽车，需要使用不同的零件，如果某个零件因为种种原因无法使用，那么就会造成整台车无法装配，陷入等待零件的状态，直到零件到位，才能继续组装。 此时如果有很多个车型都需要这个零件，那么整个工厂都将陷入等待的状态，导致所有生产都陷入瘫痪。一个零件的波及范围不断扩大。 </p>
<p>备注：一般情况对于服务依赖的保护主要有3中解决方案：</p>
<blockquote>
<p><strong>（1）熔断模式：这种模式主要是参考电路熔断，如果一条线路电压过高，保险丝会熔断，防止火灾。放到我们的系统中，如果某个目标服务调用慢或者有大量超时，此时，熔断该服务的调用，对于后续调用请求，不在继续调用目标服务，直接返回，快速释放资源。如果目标服务情况好转则恢复调用。</strong></p>
<p><strong>（2）（降级）隔离模式：这种模式就像对系统请求按类型划分成一个个小岛的一样，当某个小岛被火少光了，不会影响到其他的小岛。例如可以对不同类型的请求使用线程池来资源隔离，每种类型的请求互不影响，如果一种类型的请求线程资源耗尽，则对后续的该类型请求直接返回，不再调用后续资源。这种模式使用场景非常多，例如将一个服务拆开，对于重要的服务使用单独服务器来部署，再或者公司最近推广的多中心。</strong></p>
<p><strong>（3）限流模式：上述的熔断模式和隔离模式都属于出错后的容错处理机制，而限流模式则可以称为预防模式。限流模式主要是提前对各个类型的请求设置最高的QPS阈值，若高于设置的阈值则对该请求直接返回，不再调用后续资源。这种模式不能解决服务依赖的问题，只能解决系统整体资源分配问题，因为没有被限流的请求依然有可能造成雪崩效应。</strong></p>
</blockquote>
<p> springcloud的Hystrix就是提供了前两种解决方式：</p>
<p><strong>Hystix解决雪崩问题的手段有两个：</strong></p>
<p><strong>•               线程隔离（降级）</strong></p>
<p><strong>•               服务熔断</strong></p>
<h2 id="2-Hystrix简介"><a href="#2-Hystrix简介" class="headerlink" title="2.Hystrix简介"></a>2.Hystrix简介</h2><pre><code>Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。

 Hystix是Netflix开源的一个延迟和容错库，用于隔离访问远程服务、第三方库，防止出现级联失败。

“断路器”本身是一种开关装置，当某个服务单元发生故障之后，**通过断路器的故障监控（类似熔断保险丝），向调用方返回一个符合预期的、可处理的备选响应（FallBack）（解决思路）** ，**而不是长时间的等待或者抛出调用方无法处理的异常** ，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。
</code></pre><blockquote>
<p> 官网资料 </p>
</blockquote>
<p><a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use" target="_blank" rel="external">https://github.com/Netflix/Hystrix/wiki/How-To-Use</a></p>
<h2 id="3-服务端的服务熔断"><a href="#3-服务端的服务熔断" class="headerlink" title="3.服务端的服务熔断"></a>3.服务端的服务熔断</h2><p><strong>熔断机制是应对雪崩效应的一种微服务链路保护机制。他是在服务端实现。</strong></p>
<pre><code>**当扇出链路的某个微服务不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回&quot;错误&quot;的响应信息**。 当检测到该节点微服务调用响应正常后恢复调用链路。在SpringCloud框架里熔断机制通过Hystrix实现。Hystrix会监控微服务间调用的状况，当失败的调用到一定阈值，缺省是5秒内20次调用失败就会启动熔断机制。**熔断机制的注解是@HystrixCommand。**
</code></pre><h3 id="3-1-熔断原理"><a href="#3-1-熔断原理" class="headerlink" title="3.1 熔断原理"></a>3.1 熔断原理</h3><p>熔断器，也叫断路器，其英文单词为：Circuit Breaker </p>
<p><img src="/2019/05/01/SpringCloud个人总结/6009599rrr956.png" alt="img"></p>
<p>熔断状态机3个状态：</p>
<p>•               Closed：关闭状态，所有请求都正常访问。</p>
<p>•               Open：打开状态，所有请求都会被降级。Hystix会对请求情况计数，当一定时间内失败请求百分比达到阈值，则触发熔断，断路器会完全打开。默认失败比例的阈值是50%，请求次数最少不低于20次。</p>
<p>•               Half Open：半开状态，open状态不是永久的，打开后会进入休眠时间（默认是5S）。随后断路器会自动进入半开状态。此时会释放部分请求通过，若这些请求都是健康的，则会完全关闭断路器，否则继续保持打开，再次进行休眠计时</p>
<pre><code>当扇出链路的某个微服务不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回&quot;错误&quot;的响应信息。 当检测到该节点微服务调用响应正常后恢复调用链路。在SpringCloud框架里熔断机制通过Hystrix实现。Hystrix会监控微服务间调用的状况，当失败的调用到一定阈值，缺省是5秒内20次调用失败就会启动熔断机制。熔断机制的注解是@HystrixCommand。
</code></pre><h3 id="3-2-案例演示"><a href="#3-2-案例演示" class="headerlink" title="3.2 案例演示"></a>3.2 案例演示</h3><h4 id="3-2-1-参考microservicecloud-provider-person-8001-新建microservicecloud-provider-person-hystrix-8001"><a href="#3-2-1-参考microservicecloud-provider-person-8001-新建microservicecloud-provider-person-hystrix-8001" class="headerlink" title="3.2.1 参考microservicecloud-provider-person-8001 新建microservicecloud-provider-person-hystrix-8001"></a>3.2.1 参考microservicecloud-provider-person-8001 新建microservicecloud-provider-person-hystrix-8001</h4><p>赋值pom文件和代码已经application.yml文件</p>
<h4 id="3-2-2-修改新建hystrix-8001模块的pom文件和启动类"><a href="#3-2-2-修改新建hystrix-8001模块的pom文件和启动类" class="headerlink" title="3.2.2 修改新建hystrix-8001模块的pom文件和启动类"></a>3.2.2 修改新建hystrix-8001模块的pom文件和启动类</h4><p>（1）pom文件添加hystrix依赖</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!--  hystrix --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>（2）修改启动类名称并添加<strong>@EnableCircuitBreaker注解</strong>//对hystrixR熔断机制的支持</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">//@EnableEurekaClient</div><div class="line">@EnableDiscoveryClient //服务发现</div><div class="line">@EnableCircuitBreaker//对hystrixR熔断机制的支持</div><div class="line">public class ApplicationBootStart8001hystrix &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart8001hystrix.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-2-3-修改配置文件"><a href="#3-2-3-修改配置文件" class="headerlink" title="3.2.3 修改配置文件"></a>3.2.3 修改配置文件</h4><p>其实就是修改服务实例名字，避免跟8001模块冲突</p>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566145616539.png" alt="1566145616539"></p>
<h4 id="3-2-4-修改PersonController，添加熔断处理"><a href="#3-2-4-修改PersonController，添加熔断处理" class="headerlink" title="3.2.4 修改PersonController，添加熔断处理"></a>3.2.4 修改PersonController，添加熔断处理</h4><p>在某个方法使用<strong>@HystrixCommand</strong>注解，模拟报异常后如何处理</p>
<p><strong>一旦调用服务方法失败并抛出了错误信息/请求超时后，会自动调用@HystrixCommand标注好的fallbackMethod调用类中的指定方法</strong> </p>
<p>下面以get方法为例，代码内容（下面模拟的是出现异常）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@RestController</div><div class="line">public class PersonController</div><div class="line">&#123;</div><div class="line">   @Autowired</div><div class="line">   private PersonService service;</div><div class="line"></div><div class="line">//全部使用restful风格，返回json字符串</div><div class="line">   @RequestMapping(value = &quot;/person/add&quot;, method = RequestMethod.POST)</div><div class="line">   public boolean add(@RequestBody Person person)</div><div class="line">   &#123;</div><div class="line">      return service.add(person);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   @RequestMapping(value = &quot;/person/get/&#123;id&#125;&quot;, method = RequestMethod.GET)</div><div class="line">   @HystrixCommand(fallbackMethod = &quot;processHystrix_Get&quot;) //关键代码</div><div class="line">   public Person get(@PathVariable(&quot;id&quot;) Long id)</div><div class="line">   &#123;</div><div class="line">      Person person = service.get(id);</div><div class="line">      if(null == person)</div><div class="line">      &#123;</div><div class="line">         throw new RuntimeException(&quot;该ID：&quot;+id+&quot;没有没有对应的信息&quot;);</div><div class="line">      &#125;</div><div class="line">      return person;</div><div class="line"></div><div class="line">   &#125;</div><div class="line">   public Person processHystrix_Get(@PathVariable(&quot;id&quot;) Long id)//关键代码</div><div class="line">   &#123;</div><div class="line">      Person person =    new Person();</div><div class="line">      person.setDeptno(id);person.setDname(&quot;该ID：&quot;+id+&quot;没有没有对应的信息,null--@HystrixCommand&quot;);</div><div class="line">      person.setDb_source(&quot;no this database in MySQL&quot;);</div><div class="line">      return person;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   @RequestMapping(value = &quot;/person/list&quot;, method = RequestMethod.GET)</div><div class="line">   public List&lt;Person&gt; list()</div><div class="line">   &#123;</div><div class="line">      return service.list();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意，配置的fallbackMethod方法必须与被@HystrixCommand注解的方法有相同的入参和返回值</p>
<h4 id="3-2-5-启动EurekaServer集群和8001-hystrix模块、80模块"><a href="#3-2-5-启动EurekaServer集群和8001-hystrix模块、80模块" class="headerlink" title="3.2.5 启动EurekaServer集群和8001-hystrix模块、80模块"></a>3.2.5 启动EurekaServer集群和8001-hystrix模块、80模块</h4><p><img src="/2019/05/01/SpringCloud个人总结/5C1566146282120.png" alt="1566146282120"></p>
<p>消费者访问</p>
<p><a href="http://localhost/consumer/person/get/5" target="_blank" rel="external">http://localhost/consumer/person/get/5</a></p>
<p>输出：{“deptno”:5,”dname”:”开发部”,”db_source”:”test”}</p>
<p>我们假设获取某个不存在的用户</p>
<p><a href="http://localhost/consumer/person/get/55" target="_blank" rel="external">http://localhost/consumer/person/get/55</a></p>
<p>输出：{“deptno”:55,”dname”:”该ID：55没有没有对应的信息,null–@HystrixCommand”,”db_source”:”no this database in MySQL”}</p>
<h2 id="4-客户端的服务降级"><a href="#4-客户端的服务降级" class="headerlink" title="4.客户端的服务降级"></a>4.客户端的服务降级</h2><pre><code>既然有了服务熔断，为什么还需要服务降级？
</code></pre><p>   <strong>服务降级处理是在客户端实现完成的,与服务端没有关系，客户端自带一个异常处理机制。上面的服务熔断是在服务端实现</strong></p>
<p>  <strong>客户端的服务降级，能够快速的响应用户的请求，当服务不可达，那么立即返回定制的错误信息。</strong> </p>
<p> 整体资源快不够了,忍痛将某些服务先关掉,待渡过难关,再开启回来</p>
<p>优先保证核心服务，而非核心服务不可用或弱可用。</p>
<p>用户的请求故障时，不会被阻塞，更不会无休止的等待或者看到系统崩溃，至少可以看到一个执行结果（例如返回友好的提示信息 。</p>
<p><strong>服务降级虽然会导致请求失败，但是不会导致阻塞，而且最多会影响这个依赖服务对应的线程池中的资源，对其它服务没有响应。</strong></p>
<p><strong>而且上面的服务端熔断案例存在一些缺点：控制层每实现一个方法，就要实现对应的fallBack方法处理相关的异常逻辑，那么代码量会越来越大，而且跟业务逻辑偶合在一起。所以我们需要解耦，我们把熔断的的fallback方法都放在一个类中，去除控制层的@HystrixCommand，这样能够保证业务的纯粹。</strong></p>
<h3 id="4-1-案例演示"><a href="#4-1-案例演示" class="headerlink" title="4.1 案例演示"></a>4.1 案例演示</h3><h4 id="4-1-1-修改microservicecloud-api的工程-根据已有的PersonClientService接口新建一个实现类-FallbackFactory接口的类PersonClientServiceFallbackFactory"><a href="#4-1-1-修改microservicecloud-api的工程-根据已有的PersonClientService接口新建一个实现类-FallbackFactory接口的类PersonClientServiceFallbackFactory" class="headerlink" title="4.1.1 修改microservicecloud-api的工程, 根据已有的PersonClientService接口新建一个实现类 FallbackFactory接口的类PersonClientServiceFallbackFactory"></a>4.1.1 修改microservicecloud-api的工程, 根据已有的PersonClientService接口新建一个实现类 FallbackFactory接口的类PersonClientServiceFallbackFactory</h4><p>​    </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Component//不要忘记添加</div><div class="line">public class PersonClientServiceFallbackFactory implements FallbackFactory&lt;PersonClientService&gt; &#123;</div><div class="line">    @Override</div><div class="line">    public PersonClientService create(Throwable throwable) &#123;</div><div class="line">        return new PersonClientService() &#123;</div><div class="line">            @Override</div><div class="line">            public Person get(long id) &#123;</div><div class="line">                Person person = 	new Person();</div><div class="line">                person.setDeptno(id);person.setDname(&quot;该ID&quot;+id+&quot;没有对应的信息,Consumer客户端提供的降级信息,此服务Provider已经关闭&quot;);</div><div class="line">                person.setDb_source(&quot;no this database in MySQL&quot;);</div><div class="line">                return person;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public List&lt;Person&gt; list() &#123;</div><div class="line">                return null;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public boolean add(Person person) &#123;</div><div class="line">                return false;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    </p>
<h4 id="4-1-2-修改microservicecloud-api工程-PersonClientService接口在注解-FeignCLient中添加fallbackFactory属性值"><a href="#4-1-2-修改microservicecloud-api工程-PersonClientService接口在注解-FeignCLient中添加fallbackFactory属性值" class="headerlink" title="4.1.2  修改microservicecloud-api工程,PersonClientService接口在注解@FeignCLient中添加fallbackFactory属性值"></a>4.1.2  修改microservicecloud-api工程,PersonClientService接口在注解@FeignCLient中添加fallbackFactory属性值</h4><p>​    </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@FeignClient(value = &quot;MICROSERVICECLOUD-PERSON&quot;,fallbackFactory = PersonClientServiceFallbackFactory.class)</div><div class="line">public interface PersonClientService</div><div class="line">&#123;</div><div class="line">	@RequestMapping(value = &quot;/person/get/&#123;id&#125;&quot;, method = RequestMethod.GET)</div><div class="line">	public Person get(@PathVariable(&quot;id&quot;) long id);</div><div class="line"></div><div class="line">	@RequestMapping(value = &quot;/person/list&quot;, method = RequestMethod.GET)</div><div class="line">	public List&lt;Person&gt; list();</div><div class="line"></div><div class="line">	@RequestMapping(value = &quot;/person/add&quot;, method = RequestMethod.POST)</div><div class="line">	public boolean add(Person person);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    </p>
<h4 id="4-1-3-修改80-feign消费者端配置文件，开启服务熔断"><a href="#4-1-3-修改80-feign消费者端配置文件，开启服务熔断" class="headerlink" title="4.1.3 修改80-feign消费者端配置文件，开启服务熔断"></a>4.1.3 修改80-feign消费者端配置文件，开启服务熔断</h4><pre><code>microservicecloud-consumer-person-80-feign工程修改YML 
</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">feign:</div><div class="line">  hystrix:</div><div class="line">    enabled: true</div></pre></td></tr></table></figure>
<h4 id="4-1-4-测试"><a href="#4-1-4-测试" class="headerlink" title="4.1.4 测试"></a>4.1.4 测试</h4><pre><code>启动3个eureka先启动和微服务microservicecloud-provider-person-8001启动                                    microservicecloud-consumer-person-80-feign启动      
</code></pre><p> 正常访问测试      <a href="http://localhost/consumer/dept/get/5" target="_blank" rel="external">http://localhost/consumer/dept/get/5</a>        </p>
<p>  输出：{“deptno”:5,”dname”:”hr”,”db_source”:”test”}</p>
<p>​                  </p>
<p> 故意关闭微服务microservicecloud-provider-person-8001                                   </p>
<p> 访问测试     <a href="http://localhost/consumer/dept/get/5" target="_blank" rel="external">http://localhost/consumer/dept/get/5</a></p>
<p>输出：”deptno”:5,”dname”:”该ID5没有对应的信息,Consumer客户端提供的降级信息,此服务Provider已经关闭”,”db_source”:”no this database in MySQL”}</p>
<p>成功！！！</p>
<pre><code>**此时服务端provider已经down了,但是我们做了服务降级处理,让客户端在服务端不可用时也会获得提示信息而不会挂起耗死服务器**
</code></pre><p><strong>也就是说，如果服务端能够正常调用那么就返回值，如果不能够调用那么就返回由fallbackFactory定义的值</strong></p>
<h2 id="5-服务监控HystrixDashboard"><a href="#5-服务监控HystrixDashboard" class="headerlink" title="5. 服务监控HystrixDashboard"></a>5. 服务监控HystrixDashboard</h2><blockquote>
<pre><code>除了隔离依赖服务的调用以外,Hystrix还提供了准实时的调用监控(Hystrix      Dashboard),Hystrix      会持续地**记录所有通过Hystrix发起的请求的执行信息**,并以统计报表和图形的形式展示给用户,包括每秒执行多少请求多少成功,多少失败等.Netflix通过hystrix-metrics-event-stream项目实现了对以上指标的监控.Spring Cloud也提供了Hystrix Dashboard的整合.对监控内容转化成可视化界面.     
</code></pre></blockquote>
<p><strong>也就是说，服务端必须是集成了Hystrix组件，才能够被监控，也即是：启动类添加@EnableCircuitBreaker//对hystrixR熔断机制的支持。例如我们的服务8002和8003是监控不到的</strong></p>
<pre><code>记下来看案例实现
</code></pre><h3 id="5-1-案例实现"><a href="#5-1-案例实现" class="headerlink" title="5.1   案例实现"></a>5.1   案例实现</h3><h4 id="5-1-1-新建-microservicecloud-consumer-hystrix-dashboard-9001-模块"><a href="#5-1-1-新建-microservicecloud-consumer-hystrix-dashboard-9001-模块" class="headerlink" title="5.1.1 新建    microservicecloud-consumer-hystrix-dashboard-9001    模块"></a>5.1.1 新建    microservicecloud-consumer-hystrix-dashboard-9001    模块</h4><p>根据父工程 microservicecloud新建服务监控模块（ 参考microservicecloud-consumer-person-80-feign ）          </p>
<pre><code>（1）复制80-feign模块pom文件并添加dashboard依赖
</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- hystrix和 hystrix-dashboard相关--&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<pre><code>（2）修改application.yml配置文件          
</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 9001</div></pre></td></tr></table></figure>
<pre><code>（3）启动类ApplicationBootStart9001dashboard添加@EnableHystrixDashboard         
</code></pre><p>​    </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableHystrixDashboard</div><div class="line">public class ApplicationBootStart9001dashboard &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart9001dashboard.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    </p>
<p>  （4）所有Provider微服务提供类(8001/8002/8003)都需要监控依赖配置       </p>
<p>​         </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- actuator监控信息完善 --&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>​    </p>
<p>   （5）完整工程                        </p>
<pre><code>![](SpringCloud个人总结/Snipaste_2019-08-19_16-34-32.png)
</code></pre><p>​                            </p>
<h4 id="5-1-2-启动dashboard-9001模块"><a href="#5-1-2-启动dashboard-9001模块" class="headerlink" title="5.1.2 启动dashboard-9001模块"></a>5.1.2 启动dashboard-9001模块</h4><pre><code>http://localhost:9001/hystrix 
</code></pre><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-36-15.png" alt=""></p>
<p>部署成功</p>
<h4 id="5-1-3-启动3个eureka集群"><a href="#5-1-3-启动3个eureka集群" class="headerlink" title="5.1.3 启动3个eureka集群"></a>5.1.3 启动3个eureka集群</h4><h4 id="5-1-4启动microservicecloud-provider-person-hystrix-8001和microservicecloud-consumer-person-80-feign-服务端和消费者"><a href="#5-1-4启动microservicecloud-provider-person-hystrix-8001和microservicecloud-consumer-person-80-feign-服务端和消费者" class="headerlink" title="5.1.4启动microservicecloud-provider-person-hystrix-8001和microservicecloud-consumer-person-80-feign 服务端和消费者"></a>5.1.4启动microservicecloud-provider-person-hystrix-8001和microservicecloud-consumer-person-80-feign 服务端和消费者</h4><h4 id="5-1-4dashboard填写需要监控的服务地址"><a href="#5-1-4dashboard填写需要监控的服务地址" class="headerlink" title="5.1.4dashboard填写需要监控的服务地址"></a>5.1.4dashboard填写需要监控的服务地址</h4><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-46-55.png" alt=""></p>
<p>1：Delay：该参数用来控制服务器上轮询监控信息的延迟时间，默认为2000毫秒，可以通过配置该属性来降低客户端的网络和CPU消耗。</p>
<p>2：Title：该参数对应了头部标题Hystrix Stream之后的内容，默认会使用具体监控实例的URL，可以通过配置该信息来展示更合适的标题。 </p>
<p>点击Monitor Stream  开始监控</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-49-56.png" alt=""></p>
<p><strong>怎么查看这张图：关键的部位我已经用红色方框，框住。核心就是：7色（服务的状态），1圈，1线。</strong>                           </p>
<pre><code>   1圈                   

      实心圆:共有两种含义.它通过颜色的变化代表了 实例健康程度,它的健康度从绿色&lt;黄色&lt;橙色&lt;红色递减.该实心圆除了颜色的变化之外,它的大小也会根据实例的请求流量发生变化,流量越大该实心圆就越大.所以通过该实心圆的展示,就可以在大量的实例中快速的发现故障实例和高压力实例.              

1线                   

     曲线:用来记录2分钟内流量的相对变化,可以通过它来观察到流量的上升和下降趋势.
</code></pre><p><img src="/2019/05/01/SpringCloud个人总结/dashbnoars.png" alt=""></p>
<h4 id="5-1-5-多次刷新http-localhost-consumer-person-get-1"><a href="#5-1-5-多次刷新http-localhost-consumer-person-get-1" class="headerlink" title="5.1.5 多次刷新http://localhost/consumer/person/get/1"></a>5.1.5 多次刷新<a href="http://localhost/consumer/person/get/1" target="_blank" rel="external">http://localhost/consumer/person/get/1</a></h4><p>也即是多次请求8001服务，然后查看监控的状态</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-19_16-53-58.png" alt=""></p>
<p>显示请求的get方法的情况。圆圈变大，曲线上升。（<strong>如果请求多个方法会增加图形说明</strong>）</p>
<h1 id="十、-zuul路由网关"><a href="#十、-zuul路由网关" class="headerlink" title="十、 zuul路由网关"></a>十、 zuul路由网关</h1><pre><code>通过前面的学习，使用Spring Cloud实现微服务的架构基本成型，大致是这样的：
</code></pre><p><img src="/2019/05/01/SpringCloud个人总结/C1566221714611.png" alt="1566221714611"></p>
<p><strong>我们使用Spring Cloud Netflix中的Eureka实现了服务注册中心以及服务注册与发现；而服务间通过Ribbon或Feign实现服务的消费以及均衡负载。为了使得服务集群更为健壮，使用Hystrix的融断机制来避免在微服务架构中个别服务出现异常时引起的故障蔓延。</strong></p>
<p> 在该架构中，我们的服务集群包含：内部服务Service A和Service B，他们都会注册与订阅服务至Eureka Server，而Open Service是一个对外的服务，通过均衡负载公开至服务调用方。我们把焦点聚集在对外服务这块，直接暴露我们的服务地址，这样的实现是否合理，或者是否有更好的实现方式呢？</p>
<p>先来说说这样架构需要做的一些事儿以及存在的不足：</p>
<p>•               破坏了服务无状态特点。</p>
<pre><code>为了保证对外服务的安全性，我们需要实现对服务访问的权限控制，而开放服务的权限控制机制将会贯穿并污染整个开放服务的业务逻辑，这会带来的最直接问题是，破坏了服务集群中REST API无状态的特点。

  从具体开发和测试的角度来说，在工作中除了要考虑实际的业务逻辑之外，还需要额外考虑对接口访问的控制处理。
</code></pre><p>•               无法直接复用既有接口。</p>
<pre><code>当我们需要对一个即有的集群内访问接口，实现外部服务访问时，我们不得不通过在原有接口上增加校验逻辑，或增加一个代理调用来实现权限控制，无法直接复用原有的接口。
</code></pre><p>面对类似上面的问题，我们要如何解决呢？答案是：服务网关！</p>
<p>为了解决上面这些问题，我们需要将权限控制这样的东西从我们的服务单元中抽离出去，而最适合这些逻辑的地方就是处于对外访问最前端的地方，我们需要一个更强大一些的均衡负载器的 服务网关。</p>
<p>服务网关是微服务架构中一个不可或缺的部分。通过服务网关统一向外系统提供REST API的过程中，除了具备服务路由、均衡负载功能之外，它还具备了权限控制等功能。Spring Cloud Netflix中的Zuul就担任了这样的一个角色，为微服务架构提供了前门保护的作用，同时将权限控制这些较重的非业务逻辑内容迁移到服务路由层面，使得服务集群主体能够具备更高的可复用性和可测试性。</p>
<p>Zuul包含了对请求的路由和过滤两个最主要的功能：</p>
<p><strong>其中路由功能负责将外部请求转发到具体的微服务实例上，是实现外部访问统一入口的基础而过滤器功能则负责对请求的处理过程进行干预，是实现请求校验、服务聚合等功能的基础.Zuul和Eureka进行整合，将Zuul自身注册为Eureka服务治理下的应用，同时从Eureka中获得其他微服务的消息，也即以后的访问微服务都是通过Zuul跳转后获得。</strong></p>
<pre><code>**注意：Zuul服务最终还是会注册进Eureka**

提供=代理+路由+过滤三大功能
</code></pre><h2 id="1-简介-1"><a href="#1-简介-1" class="headerlink" title="1.简介"></a>1.简介</h2><p>官网：<a href="https://github.com/Netflix/zuul" target="_blank" rel="external">https://github.com/Netflix/zuul</a></p>
<p> <img src="/2019/05/01/SpringCloud个人总结/njl002.png" alt="标题: fig:"></p>
<p>Zuul：维基百科</p>
<p>电影《捉鬼敢死队》中的怪兽，Zuul，在纽约引发了巨大骚乱。</p>
<p>事实上，在微服务架构中，Zuul就是守门的大Boss！一夫当关，万夫莫开！</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image0yy04.png" alt="img"></p>
<h2 id="2-Zuul加入后的架构"><a href="#2-Zuul加入后的架构" class="headerlink" title="2.Zuul加入后的架构"></a>2.Zuul加入后的架构</h2><p> <img src="file:///C:/Users/JEREMY~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png" alt="标题: fig:"></p>
<p>不管是来自于客户端（PC或移动端）的请求，还是服务内部调用。一切对服务的请求都会经过Zuul这个网关，然后再由网关来实现 鉴权、动态路由等等操作。Zuul就是我们服务的统一入口。</p>
<p>​        </p>
<h2 id="3-路由基本配置（例子）"><a href="#3-路由基本配置（例子）" class="headerlink" title="3.路由基本配置（例子）"></a>3.路由基本配置（例子）</h2><h3 id="3-1新建Module模块microservicecloud-zuul-gateway-9999"><a href="#3-1新建Module模块microservicecloud-zuul-gateway-9999" class="headerlink" title="3.1新建Module模块microservicecloud-zuul-gateway-9999"></a>3.1<strong>新建Module模块microservicecloud-zuul-gateway-9999</strong></h3><h3 id="3-2-修改pom文件"><a href="#3-2-修改pom文件" class="headerlink" title="3.2 修改pom文件"></a>3.2 修改pom文件</h3><p>主要添加：</p>
<pre><code>&lt;!-- zuul路由网关 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>完整内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependencies&gt;</div><div class="line">    &lt;!-- zuul路由网关 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- actuator监控 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!--  hystrix容错--&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- 日常标配 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- 热部署插件 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure>
<h3 id="3-3-修改application-yml"><a href="#3-3-修改application-yml" class="headerlink" title="3.3 修改application.yml"></a>3.3 修改application.yml</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server:</div><div class="line">  port: 9999</div><div class="line"></div><div class="line">spring:</div><div class="line">  application:</div><div class="line">    name: microservicecloud-zuul-gateway</div><div class="line"></div><div class="line">eureka:</div><div class="line">  client:</div><div class="line">    service-url:</div><div class="line">      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">  instance:</div><div class="line">    instance-id: microservicecloud-zuul-gateway9999</div><div class="line">    prefer-ip-address: true</div><div class="line"></div><div class="line"></div><div class="line">info:</div><div class="line">  app.name: $&#123;spring.application.name&#125;</div><div class="line">  company.name: kingge.top</div><div class="line">  build.artifactId: $&#123;project.artifactId&#125;</div><div class="line">  build.version: $&#123;project.version&#125;</div><div class="line">  app.desc: 这是一个zuul</div></pre></td></tr></table></figure>
<h3 id="3-4-修改主启动类ApplicationBootStart9999zuul"><a href="#3-4-修改主启动类ApplicationBootStart9999zuul" class="headerlink" title="3.4 修改主启动类ApplicationBootStart9999zuul"></a>3.4 修改主启动类ApplicationBootStart9999zuul</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableZuulProxy</div><div class="line">public class ApplicationBootStart9999zuul &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart9999zuul.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-4-1完整工程展示"><a href="#3-4-1完整工程展示" class="headerlink" title="3.4.1完整工程展示"></a>3.4.1完整工程展示</h3><p><img src="/2019/05/01/SpringCloud个人总结/C1566226205578.png" alt="1566226205578"></p>
<h3 id="3-5启动三个eureka集群-、一个服务提供类microservicecloud-provider-person-8001-、9999模块路由"><a href="#3-5启动三个eureka集群-、一个服务提供类microservicecloud-provider-person-8001-、9999模块路由" class="headerlink" title="3.5启动三个eureka集群 、一个服务提供类microservicecloud-provider-person-8001 、9999模块路由"></a>3.5启动三个eureka集群 、一个服务提供类microservicecloud-provider-person-8001 、9999模块路由</h3><p><img src="/2019/05/01/SpringCloud个人总结/566222721701.png" alt="1566222721701"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1566222752232.png" alt="1566222752232"></p>
<h3 id="3-6-测试"><a href="#3-6-测试" class="headerlink" title="3.6 测试"></a>3.6 测试</h3><p>不用路由访问：<a href="http://localhost:8001/person/get/2" target="_blank" rel="external">http://localhost:8001/person/get/2</a><br>启用路由访问 <a href="http://localhost:9999/microservicecloud-person/person/get/2" target="_blank" rel="external">http://localhost:9999/microservicecloud-person/person/get/2</a></p>
<p>输出都是：{“deptno”:5,”dname”:”开发部”,”db_source”:”test”}</p>
<h2 id="4-路由访问映射规则"><a href="#4-路由访问映射规则" class="headerlink" title="4.路由访问映射规则"></a>4.<strong>路由访问映射规则</strong></h2><p>上面的案例存在一个问题，那就是使用路由访问服务的时候</p>
<p><a href="http://localhost:9999/microservicecloud-person/person/get/2" target="_blank" rel="external">http://localhost:9999/microservicecloud-person/person/get/2</a></p>
<p>我们暴露了 服务名称：microservicecloud-person ，所以我们想隐藏他。</p>
<h3 id="4-1-修改9999模块配置文件"><a href="#4-1-修改9999模块配置文件" class="headerlink" title="4.1 修改9999模块配置文件"></a>4.1 修改9999模块配置文件</h3><p>添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">zuul: </div><div class="line">  routes: </div><div class="line">    myperson.serviceId: microservicecloud-person</div><div class="line">    myperson.path: /myperson/**</div></pre></td></tr></table></figure>
<p><strong><em>重要</em></strong></p>
<p><strong>规则说明</strong>：</p>
<p>•   zuul.routes.<route>.path=/xxx/**： 来指定映射路径。<route>是自定义的路由名（在上面是myperson）</route></route></p>
<p>•   zuul.routes.<route>.serviceId=service-provider：来指定服务名。</route></p>
<p><strong>而大多数情况下，我们的<route>路由名称往往和服务名会写成一样的。因此Zuul就提供了一种简化的配置语法：zuul.routes.<serviceid>=<path></path></serviceid></route></strong></p>
<p><strong>比方说上面我们关于microservicecloud-person的配置可以简化为一条：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">zuul:</div><div class="line">  routes:</div><div class="line">    microservicecloud-person: /myperson/** # 这里是映射路径</div><div class="line">#    myperson.serviceId: microservicecloud-person</div><div class="line">#    myperson.path: /myperson/**</div></pre></td></tr></table></figure>
<p>省去了对服务名称的配置。</p>
<h3 id="4-2-重启9999模块"><a href="#4-2-重启9999模块" class="headerlink" title="4.2 重启9999模块"></a>4.2 重启9999模块</h3><p>访问如下两个网址</p>
<p>（1）服务名称映射后路由访问OK<br><a href="http://localhost:9999/myperson/person/get/5" target="_blank" rel="external">http://localhost:9999/myperson/person/get/5</a></p>
<p>（2）未映射服务名称原路径访问OK  - <strong>默认的路由规则</strong><br><a href="http://localhost:9999/microservicecloud-person/person/get/5" target="_blank" rel="external">http://localhost:9999/microservicecloud-person/person/get/5</a></p>
<p><strong>如果在保留第一种方式的情况下，禁止第二种方式的访问。</strong></p>
<h3 id="4-3-原真实服务名忽略-关闭默认的路由规则"><a href="#4-3-原真实服务名忽略-关闭默认的路由规则" class="headerlink" title="4.3 原真实服务名忽略-关闭默认的路由规则"></a>4.3 <strong>原真实服务名忽略-关闭默认的路由规则</strong></h3><p>增你家该属性即可：ignored-services:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">zuul:</div><div class="line">  ignored-services: microservicecloud-person #单个具体，多个可以用&quot;*&quot; ignored-services: *</div><div class="line">  routes:</div><div class="line">    myperson.serviceId: microservicecloud-person</div><div class="line">    myperson.path: /myperson/**</div></pre></td></tr></table></figure>
<p>重启9999zuul模块：</p>
<p>访问：<a href="http://localhost:9999/microservicecloud-person/person/get/5" target="_blank" rel="external">http://localhost:9999/microservicecloud-person/person/get/5</a> </p>
<p>访问失败</p>
<p><img src="/2019/05/01/SpringCloud个人总结/C1566223608884.png" alt="1566223608884"></p>
<h3 id="4-4-设置统一公共前缀"><a href="#4-4-设置统一公共前缀" class="headerlink" title="4.4 设置统一公共前缀"></a>4.4 <strong>设置统一公共前缀</strong></h3><p>增加prefix属性即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">zuul:</div><div class="line">  ignored-services: microservicecloud-person #单个具体，多个可以用&quot;*&quot; ignored-services: *</div><div class="line">  routes:</div><div class="line">    myperson.serviceId: microservicecloud-person</div><div class="line">    myperson.path: /myperson/**</div><div class="line">  prefix: /sb  #必须有反斜杠</div></pre></td></tr></table></figure>
<p><a href="http://localhost:9999/sb/myperson/person/get/5" target="_blank" rel="external">http://localhost:9999/sb/myperson/person/get/5</a> //访问成功</p>
<p><a href="http://localhost:9999/myperson/person/get/5" target="_blank" rel="external">http://localhost:9999/myperson/person/get/5</a> //不加前缀访问失败</p>
<h2 id="5-默认的路由规则"><a href="#5-默认的路由规则" class="headerlink" title="5 .默认的路由规则"></a>5 .默认的路由规则</h2><p>在使用Zuul的过程中，上面讲述的规则（<strong>也就是上面4.1小节的规则</strong>）已经大大的简化了配置项。但是当服务较多时，配置也是比较繁琐的。因此Zuul就指定了默认的路由规则：</p>
<p>•               默认情况下，一切服务的映射路径就是服务名本身。例如服务名为：service-provider，则默认的映射路径就 是：/service-provider/**</p>
<p>也就是说，刚才的映射规则我们完全不配置也是OK的，不信就试试看。</p>
<p>终极简化版本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">zuul:</div><div class="line">#  routes:</div><div class="line">#    microservicecloud-person: /myperson/** # 这里是映射路径</div><div class="line">#    myperson.serviceId: microservicecloud-person</div><div class="line">#    myperson.path: /myperson/**</div></pre></td></tr></table></figure>
<p>那么默认microservicecloud-person服务的映射路径是：/microservicecloud-person/**</p>
<p>为了不暴露服务名称，那么我么你需要关闭默认的路由规则：见4.3小节</p>
<h2 id="6-过滤器"><a href="#6-过滤器" class="headerlink" title="6.过滤器"></a>6.过滤器</h2><p>Zuul作为网关的其中一个重要功能，就是实现请求的鉴权。而这个动作我们往往是通过Zuul提供的过滤器来实现的。</p>
<h3 id="6-1-ZuulFilter"><a href="#6-1-ZuulFilter" class="headerlink" title="6.1.ZuulFilter"></a>6.1.ZuulFilter</h3><p>ZuulFilter是过滤器的顶级父类。在这里我们看一下其中定义的4个最重要的方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public abstract ZuulFilter implements IZuulFilter&#123;</div><div class="line"> </div><div class="line">     abstract public String filterType();</div><div class="line"> </div><div class="line">     abstract public int filterOrder();</div><div class="line">     </div><div class="line">     boolean shouldFilter();// 来自IZuulFilter</div><div class="line"> </div><div class="line">     Object run() throws ZuulException;// IZuulFilter</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>•               shouldFilter：返回一个Boolean值，判断该过滤器是否需要执行。返回true执行，返回false不执行。</p>
<p>•               run：过滤器的具体业务逻辑。</p>
<p>•               filterType：返回字符串，代表过滤器的类型。包含以下4种：</p>
<p>–               pre：请求在被路由之前执行</p>
<p>–               route：在路由请求时调用</p>
<p>–               post：在route和errror过滤器之后调用</p>
<p>–               error：处理请求时发生错误调用</p>
<p>•               filterOrder：通过返回的int值来定义过滤器的执行顺序，数字越小优先级越高。</p>
<h3 id="6-2-过滤器执行生命周期"><a href="#6-2-过滤器执行生命周期" class="headerlink" title="6.2.过滤器执行生命周期"></a>6.2.过滤器执行生命周期</h3><p>这张是Zuul官网提供的请求生命周期图，清晰的表现了一个请求在各个过滤器的执行顺序。</p>
<p><img src="/2019/05/01/SpringCloud个人总结/clip_image002yyyy.png" alt="img"></p>
<p>正常流程：</p>
<p>•               请求到达首先会经过pre类型过滤器，而后到达route类型，进行路由，请求就到达真正的服务提供者，执行请求，返回结果后，会到达post过滤器。而后返回响应。</p>
<p>异常流程：</p>
<p>•               整个过程中，pre或者route过滤器出现异常，都会直接进入error过滤器，在error处理完毕后，会将请求交给POST过滤器，最后返回给用户。</p>
<p>•               如果是error过滤器自己出现异常，最终也会进入POST过滤器，将最终结果返回给请求客户端。</p>
<p>•               如果是POST过滤器出现异常，会跳转到error过滤器，但是与pre和route不同的是，请求不会再到达POST过滤器了。</p>
<p>所有内置过滤器列表：</p>
<p> <img src="/2019/05/01/SpringCloud个人总结/clip_imaggggge004.png" alt="标题: fig:"></p>
<h3 id="6-3-使用场景"><a href="#6-3-使用场景" class="headerlink" title="6.3.使用场景"></a>6.3.使用场景</h3><p>场景非常多：</p>
<p>•               请求鉴权：一般放在pre类型，如果发现没有访问权限，直接就拦截了</p>
<p>•               异常处理：一般会在error类型和post类型过滤器中结合来处理。</p>
<p>•               服务调用时长统计：pre和post结合使用。</p>
<h2 id="7-自定义过滤器"><a href="#7-自定义过滤器" class="headerlink" title="7.自定义过滤器"></a>7.自定义过滤器</h2><p>接下来我们来自定义一个过滤器，模拟一个登录的校验。基本逻辑：如果请求中有access-token参数，则认为请求有效，放行。</p>
<h3 id="7-1-定义过滤器类"><a href="#7-1-定义过滤器类" class="headerlink" title="7.1.定义过滤器类"></a>7.1.定义过滤器类</h3><p><img src="/2019/05/01/SpringCloud个人总结/5C1566226606544.png" alt="1566226606544"></p>
<p>内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">package com.kingge.filter;</div><div class="line"></div><div class="line">import com.netflix.zuul.ZuulFilter;</div><div class="line">import com.netflix.zuul.context.RequestContext;</div><div class="line">import com.netflix.zuul.exception.ZuulException;</div><div class="line">import org.apache.commons.lang.StringUtils;</div><div class="line">import org.springframework.http.HttpStatus;</div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class LoginFilter extends ZuulFilter &#123;</div><div class="line">    /**</div><div class="line">     * 过滤器类型，前置过滤器</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public String filterType() &#123;</div><div class="line">        return &quot;pre&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 过滤器的执行顺序</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public int filterOrder() &#123;</div><div class="line">        return 1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 该过滤器是否生效</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public boolean shouldFilter() &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 登陆校验逻辑</div><div class="line">     * @return</div><div class="line">     * @throws ZuulException</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public Object run() &#123;</div><div class="line">        // 获取zuul提供的上下文对象</div><div class="line">        RequestContext context = RequestContext.getCurrentContext();</div><div class="line">        // 从上下文对象中获取请求对象</div><div class="line">        HttpServletRequest request = context.getRequest();</div><div class="line">        // 获取token信息</div><div class="line">        String token = request.getParameter(&quot;access-token&quot;);</div><div class="line">        // 判断</div><div class="line">        if (StringUtils.isBlank(token)) &#123;</div><div class="line">            // 过滤该请求，不对其进行路由</div><div class="line">            context.setSendZuulResponse(false);</div><div class="line">            // 设置响应状态码，401</div><div class="line">            context.setResponseStatusCode(401);</div><div class="line">            // 设置响应信息</div><div class="line">            context.setResponseBody(&quot;&#123;\&quot;status\&quot;:\&quot;401\&quot;, \&quot;text\&quot;:\&quot;request error!\&quot;&#125;&quot;);</div><div class="line">        &#125;</div><div class="line">        // 校验通过，把登陆信息放入上下文信息，继续向后执行</div><div class="line">        context.set(&quot;token&quot;, token);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="7-2-测试"><a href="#7-2-测试" class="headerlink" title="7.2.测试"></a>7.2.测试</h3><p>没有token参数时，访问失败：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/5C1566226821375.png" alt="1566226821375"></p>
<p>添加token参数后：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566226885002.png" alt="1566226885002"></p>
<h2 id="8-负载均衡和熔断"><a href="#8-负载均衡和熔断" class="headerlink" title="8.负载均衡和熔断"></a>8.负载均衡和熔断</h2><p>Zuul中默认就已经集成了Ribbon负载均衡和Hystix熔断机制。但是所有的超时策略都是走的默认值，比如熔断超时时间只有1S，很容易就触发了。因此建议我们手动进行配置：</p>
<p>hystrix:<br>   command:<br>     default:<br>       execution:<br>         isolation:<br>           thread:<br>             timeoutInMilliseconds: 2000 # 设置hystrix的超时时间为6000ms</p>
<h1 id="十一、SpringCloud-Config-分布式配置中心"><a href="#十一、SpringCloud-Config-分布式配置中心" class="headerlink" title="十一、SpringCloud Config 分布式配置中心"></a>十一、<strong>SpringCloud Config 分布式配置中心</strong></h1><pre><code>**解决第四个问题，统一配置的问题**
</code></pre><h2 id="1-为什么需要配置中心"><a href="#1-为什么需要配置中心" class="headerlink" title="1.为什么需要配置中心"></a>1.为什么需要配置中心</h2><p>   举个简单的例子，我们想要修改8001模块的服务名称的值（spring.application.name），那么我们首先得找到8001模块，然后找到配置文件，然后再进去修改。如果修改修改8003模块的配置信息，重复之前的步骤。</p>
<p> 所以我们需要一个集中管理所有微服务配置信息的地方。</p>
<pre><code>微服务意味着要将单体应用中的业务拆分成一个个子服务,每个服务的粒度相对较小,因此系统中会出现大量的服务.由于每个服务都需要必要的配置信息才能运行（application.yml）,所以一套集中式的、动态的配置管理设施是必不可少的.SpringCloud提供了ConfigServer来解决这个问题(我们每一个微服务自己带着一个application.yml,上百个配置文件的管理的问题)
</code></pre><p>​         </p>
<pre><code>**总而言之：是为了更加方便的帮助我们集中式的管理微服务架构里面微服务的配置信息。**
</code></pre><h2 id="2-config配置中心"><a href="#2-config配置中心" class="headerlink" title="2. config配置中心"></a>2. config配置中心</h2><p><strong>SpringCloud Config 为微服务架构中的微服务提供集中化的外部配置支持,配置服务器为各个不同微服务应用的所有环境提供了一个中心化的外部配置，方便我们集中式的修改微服务的配置</strong></p>
<p><strong>SpringCloud Config分为服务端和客户端两部分.</strong></p>
<p><strong>服务端也称为分布式配置中心,它是一个独立的微服务应用,用来连接配置服务器并为客户端提供获取配置信息,加密/解密信息等访问接口</strong></p>
<p><strong>客户端则是通过制定的配置中心来管理应用资源,以及业务相关的配置内容,并在启动的时候从配置中心获取和加载配置信息配置服务器默认采用git来存储配置信息,这样就有助于对环境配置进行版本管理,并且可以通过git客户端工具来方便的管理和访问配置内容.（客户端可以是我们的8001,8003模块，也即是需要获取配置信息的微服务都是客户端）</strong></p>
<blockquote>
<p>功能：</p>
</blockquote>
<ul>
<li>1.集中管理配置文件</li>
<li>2.不同环境不同配置,动态化的配置更新,分环境部署比如dev/test/prod/beta/release</li>
<li>3.运行期间动态调整配置,不再需要在每个服务部署的机器上编写配置文件,服务会向配置中心统一拉取配置自己的信息</li>
<li>4.当配置发生变动时,服务不需要重启即可感知到配置的变化并应用新的配置</li>
<li>5.将配置信息以REST接口的形式暴露</li>
</ul>
<blockquote>
<p>配置中心配置文件放置的位置：与GitHub整合配置</p>
</blockquote>
<p>由于SpringCloudConfig默认使用Git来存储配置文件(也有其他方式,比如支持SVN和本地文件),<br>但最推荐的还是使用Git,而且使用的是http/https访问形式</p>
<h2 id="3-SpringCloud-Config服务端配置"><a href="#3-SpringCloud-Config服务端配置" class="headerlink" title="3.SpringCloud Config服务端配置"></a>3.SpringCloud Config服务端配置</h2><h3 id="3-1-在GitHub上新建一个名为springcloud-config-server的新Repository"><a href="#3-1-在GitHub上新建一个名为springcloud-config-server的新Repository" class="headerlink" title="3.1 在GitHub上新建一个名为springcloud-config-server的新Repository"></a>3.1 在GitHub上新建一个名为springcloud-config-server的新Repository</h3><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_09-42-33.png" alt=""></p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_09-59-45.png" alt=""></p>
<p>git@github.com:JeremyKinge/springcloud-config-server.git</p>
<h3 id="3-2-本地磁盘获取上述创建的仓库"><a href="#3-2-本地磁盘获取上述创建的仓库" class="headerlink" title="3.2 本地磁盘获取上述创建的仓库"></a>3.2 本地磁盘获取上述创建的仓库</h3><p>git命令:<br>git clone git@github.com:JeremyKinge/springcloud-config-server.git</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-01-44.png" alt=""></p>
<h3 id="3-3-在上述磁盘新建配置文件并上传到git仓库"><a href="#3-3-在上述磁盘新建配置文件并上传到git仓库" class="headerlink" title="3.3 在上述磁盘新建配置文件并上传到git仓库"></a>3.3 在上述磁盘新建配置文件并上传到git仓库</h3><p>（1）添加配置文件application.yml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">spring:</div><div class="line">  profiles:</div><div class="line">    active:</div><div class="line">    - dev</div><div class="line">---</div><div class="line">spring:</div><div class="line">  profiles: dev</div><div class="line">  application:    #开发环境</div><div class="line">    name: microservicecloud-config-kingge-dev</div><div class="line">---</div><div class="line">spring:</div><div class="line">  profiles: test   #测试环境</div><div class="line">  application:</div><div class="line">    name: microservicecloud-config-kingge-test</div><div class="line">#请保存为UTF-8格式</div></pre></td></tr></table></figure>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-06-13.png" alt=""></p>
<p>（2）git bash执行上传命令：</p>
<p>git add .<br>git commit -m “新建配置文件”<br>git push origin master</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-08-51.png" alt=""></p>
<p>（3）查看github</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-09-16.png" alt=""></p>
<h3 id="3-4-新建Module模块microservicecloud-config-10000它即为Cloud的配置中心模块"><a href="#3-4-新建Module模块microservicecloud-config-10000它即为Cloud的配置中心模块" class="headerlink" title="3.4 新建Module模块microservicecloud-config-10000它即为Cloud的配置中心模块"></a>3.4 新建Module模块microservicecloud-config-10000它即为Cloud的配置中心模块</h3><h3 id="3-5-修改10000模块pom文件和yml配置文件、启动类"><a href="#3-5-修改10000模块pom文件和yml配置文件、启动类" class="headerlink" title="3.5 修改10000模块pom文件和yml配置文件、启动类"></a>3.5 修改10000模块pom文件和yml配置文件、启动类</h3><p>（1）修改pom文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">&lt;dependencies&gt;</div><div class="line"> &lt;!-- springCloud Config 关键代码--&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;!-- 避免Config的Git插件报错：org/eclipse/jgit/api/TransportConfigCallback  --&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">     &lt;groupId&gt;org.eclipse.jgit&lt;/groupId&gt;</div><div class="line">     &lt;artifactId&gt;org.eclipse.jgit&lt;/artifactId&gt;</div><div class="line">     &lt;version&gt;4.10.0.201712302008-r&lt;/version&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;!-- 图形化监控 --&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;!-- 熔断 --&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;!-- 热部署插件 --&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line"> &lt;dependency&gt;</div><div class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">   &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div class="line"> &lt;/dependency&gt;</div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure>
<p>关键代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- springCloud Config 关键代码--&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>（2）修改yml文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server: </div><div class="line">  port: 10000 </div><div class="line">  </div><div class="line">spring:</div><div class="line">  application:</div><div class="line">    name:  microservicecloud-config</div><div class="line">  cloud:</div><div class="line">    config:</div><div class="line">      server:</div><div class="line">        git:</div><div class="line">          uri: git@github.com:JeremyKinge/springcloud-config-server.git #GitHub上面的git仓库名字</div><div class="line">          #username: xxxxxx  #如果访问github需要密码那么填写下面三项</div><div class="line">          #password: xxxxxxx</div><div class="line">          #force-pull: true</div></pre></td></tr></table></figure>
<p>（3）启动类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableConfigServer</div><div class="line">public class ApplicationBootStart10000config &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line">        SpringApplication.run(ApplicationBootStart10000config.class,args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-6-完整项目结构"><a href="#3-6-完整项目结构" class="headerlink" title="3.6 完整项目结构"></a>3.6 完整项目结构</h3><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-18-53.png" alt=""></p>
<h3 id="3-7-测试通过Config微服务是否可以从GitHub上获取配置内容"><a href="#3-7-测试通过Config微服务是否可以从GitHub上获取配置内容" class="headerlink" title="3.7 测试通过Config微服务是否可以从GitHub上获取配置内容"></a>3.7 测试通过Config微服务是否可以从GitHub上获取配置内容</h3><p>启动微服务10000<br><a href="http://localhost:10000/application-dev.yml" target="_blank" rel="external">http://localhost:10000/application-dev.yml</a></p>
<p>输出：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-23-00.png" alt=""></p>
<p><a href="http://localhost:10000/application-test.yml" target="_blank" rel="external">http://localhost:10000/application-test.yml</a></p>
<p>输出：</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_10-23-19.png" alt=""></p>
<p><a href="http://localhost:10000/application-xxx.yml(不存在的配置" target="_blank" rel="external">http://localhost:10000/application-xxx.yml(不存在的配置</a>)</p>
<p><strong>成功实现了用SpringCloud Config通过GitHub获取配置信息</strong></p>
<h3 id="3-8-配置文件读取规则"><a href="#3-8-配置文件读取规则" class="headerlink" title="3.8 配置文件读取规则"></a>3.8 配置文件读取规则</h3><p><img src="/2019/05/01/SpringCloud个人总结/Topic578NotesImage5.jpg" alt=""></p>
<p>上面3.8测试中，我们采用的是第二种方式，通过10000配置中心去github获取配置文件</p>
<p>请求例子：</p>
<p>/{application}-{profile}.yml<br>  <a href="http://localhost:10000/application-dev.yml" target="_blank" rel="external">http://localhost:10000/application-dev.yml</a><br>  <a href="http://localhost:10000/application-test.yml" target="_blank" rel="external">http://localhost:10000/application-test.yml</a><br>  <a href="http://localhost:10000/application-xxx.yml(不存在的配置" target="_blank" rel="external">http://localhost:10000/application-xxx.yml(不存在的配置</a>)<br>/{application}/{profile}[/{label}]<br>  <a href="http://localhost:10000/application/dev/master" target="_blank" rel="external">http://localhost:10000/application/dev/master</a><br>  <a href="http://localhost:10000/application/test/master" target="_blank" rel="external">http://localhost:10000/application/test/master</a><br>  <a href="http://localhost:10000/application/xxx/master" target="_blank" rel="external">http://localhost:10000/application/xxx/master</a><br>/{label}/{application}-{profile}.yml<br>  <a href="http://localhost:10000/master/application-dev.yml" target="_blank" rel="external">http://localhost:10000/master/application-dev.yml</a><br>  <a href="http://localhost:10000/master/application-test.yml" target="_blank" rel="external">http://localhost:10000/master/application-test.yml</a></p>
<h2 id="4-SpringCloud-Config客户端配置与测试"><a href="#4-SpringCloud-Config客户端配置与测试" class="headerlink" title="4.SpringCloud Config客户端配置与测试"></a>4.SpringCloud Config客户端配置与测试</h2><p>在上面中我们已经搭建好了，配置中心的服务端。那么接下来演示一下客户端怎么取获取服务端的配置信息。</p>
<p><strong>新建8004服务提供者，他的配置信息我们取自配置中心（而不是在application.yml中配置，动态获取）</strong></p>
<h3 id="4-1-新建8004-配置文件并上传到github"><a href="#4-1-新建8004-配置文件并上传到github" class="headerlink" title="4.1 新建8004 配置文件并上传到github"></a>4.1 新建8004 配置文件并上传到github</h3><p>新建microservicecloud-provider-person-config-client-8004.yml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">spring: </div><div class="line">  profiles:</div><div class="line">    active:</div><div class="line">    - dev</div><div class="line">--- </div><div class="line">server:</div><div class="line">  port: 8004</div><div class="line"></div><div class="line">mybatis:</div><div class="line">  config-location: classpath:mybatis/mybatis.cfg.xml        # mybatis配置文件所在路径</div><div class="line">  type-aliases-package: com.kingge.entity    # 所有Entity别名类所在包</div><div class="line">  mapper-locations:</div><div class="line">  - classpath:mybatis/mapper/**/*.xml                       # mapper映射文件</div><div class="line"></div><div class="line">spring:</div><div class="line">   profiles: dev</div><div class="line">   application:</div><div class="line">    name: microservicecloud-person                          #很重要，对外暴露的微服务的名称</div><div class="line">   datasource:</div><div class="line">    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型</div><div class="line">    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包</div><div class="line">    url: jdbc:mysql://127.0.0.1:3306/test              # 数据库名称</div><div class="line">    username: root</div><div class="line">    password: 123</div><div class="line">    dbcp2:</div><div class="line">      min-idle: 5                                           # 数据库连接池的最小维持连接数</div><div class="line">      initial-size: 5                                       # 初始化连接数</div><div class="line">      max-total: 5                                          # 最大连接数</div><div class="line">      max-wait-millis: 200                                  # 等待连接获取的最大超时时间</div><div class="line">#</div><div class="line">eureka:</div><div class="line">  client: #客户端注册进eureka服务列表内</div><div class="line">    service-url:</div><div class="line">      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">#      http://localhost:7001/eureka #单机版本使用</div><div class="line">#      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">  instance:</div><div class="line">    instance-id: microservicecloud-person8001 #自定义服务实例名</div><div class="line">    prefer-ip-address: true     #访问路径可以显示IP地址</div><div class="line">    lease-expiration-duration-in-seconds: 10 # 10秒即过期</div><div class="line">    lease-renewal-interval-in-seconds: 5 # 5秒一次心跳</div><div class="line">#</div><div class="line">info:</div><div class="line">  app.name: $&#123;spring.application.name&#125;</div><div class="line">  company.name: kingge.top</div><div class="line">  build.artifactId: $&#123;project.artifactId&#125;</div><div class="line">  build.version: $&#123;project.version&#125;</div><div class="line">  app.desc: 这是一个提供查询部门人员信息的服务</div><div class="line">---</div><div class="line">server:</div><div class="line">  port: 8005</div><div class="line"></div><div class="line">mybatis:</div><div class="line">  config-location: classpath:mybatis/mybatis.cfg.xml        # mybatis配置文件所在路径</div><div class="line">  type-aliases-package: com.kingge.entity    # 所有Entity别名类所在包</div><div class="line">  mapper-locations:</div><div class="line">  - classpath:mybatis/mapper/**/*.xml                       # mapper映射文件</div><div class="line"></div><div class="line">spring:</div><div class="line">   profiles: test</div><div class="line">   application:</div><div class="line">    name: microservicecloud-person                          #很重要，对外暴露的微服务的名称</div><div class="line">   datasource:</div><div class="line">    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型</div><div class="line">    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包</div><div class="line">    url: jdbc:mysql://127.0.0.1:3306/test2              # 数据库名称</div><div class="line">    username: root</div><div class="line">    password: 123</div><div class="line">    dbcp2:</div><div class="line">      min-idle: 5                                           # 数据库连接池的最小维持连接数</div><div class="line">      initial-size: 5                                       # 初始化连接数</div><div class="line">      max-total: 5                                          # 最大连接数</div><div class="line">      max-wait-millis: 200                                  # 等待连接获取的最大超时时间</div><div class="line">#</div><div class="line">eureka:</div><div class="line">  client: #客户端注册进eureka服务列表内</div><div class="line">    service-url:</div><div class="line">      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">#      http://localhost:7001/eureka #单机版本使用</div><div class="line">#      defaultZone: http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</div><div class="line">  instance:</div><div class="line">    instance-id: microservicecloud-person8001 #自定义服务实例名</div><div class="line">    prefer-ip-address: true     #访问路径可以显示IP地址</div><div class="line">    lease-expiration-duration-in-seconds: 10 # 10秒即过期</div><div class="line">    lease-renewal-interval-in-seconds: 5 # 5秒一次心跳</div><div class="line">#</div><div class="line">info:</div><div class="line">  app.name: $&#123;spring.application.name&#125;</div><div class="line">  company.name: kingge.top</div><div class="line">  build.artifactId: $&#123;project.artifactId&#125;</div><div class="line">  build.version: $&#123;project.version&#125;</div><div class="line">  app.desc: 这是一个提供查询部门人员信息的服务</div></pre></td></tr></table></figure>
<p><strong>dev和test环境的不同在于，他们的服务端口不同和访问的数据库不同</strong></p>
<h3 id="4-2-microservicecloud-provider-person-config-client-8004模块"><a href="#4-2-microservicecloud-provider-person-config-client-8004模块" class="headerlink" title="4.2 microservicecloud-provider-person-config-client-8004模块"></a>4.2 microservicecloud-provider-person-config-client-8004模块</h3><p>（1）修改pom文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependencies&gt;</div><div class="line">    &lt;!-- 引入自己定义的api通用包，可以使用Person用户Entity --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;com.kingge.springcloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- SpringCloud Config客户端 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- actuator监控信息完善 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- 将微服务provider端注册进eureka --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;!-- 修改后立即生效，热部署 --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure>
<p>关键依赖</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!-- SpringCloud Config客户端 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h3 id="4-3-新建bootstrap-yml-系统级别配置文件"><a href="#4-3-新建bootstrap-yml-系统级别配置文件" class="headerlink" title="4.3 新建bootstrap.yml 系统级别配置文件"></a>4.3 新建bootstrap.yml 系统级别配置文件</h3><p>applicaiton.yml是用户级的资源配置项<br>bootstrap.yml是系统级的，优先级更加高</p>
<p>Spring Cloud会创建一个<code>Bootstrap Context</code>，作为Spring应用的<code>Application Context</code>的父上下文。初始化的时候，<code>Bootstrap Context</code>负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的<code>Environment</code>。<code>Bootstrap</code>属性有高优先级，默认情况下，它们不会被本地配置覆盖。 <code>Bootstrap context</code>和<code>Application Context</code>有着不同的约定，<br>所以新增了一个<code>bootstrap.yml</code>文件，保证<code>Bootstrap Context</code>和<code>Application Context</code>配置的分离。</p>
<p><strong>换句话说，如果将下面内容放到application.yml中，那么项目启动会报错，因为是找不到控制层ConfigClientRest导入的属性</strong></p>
<p><strong>@Value(“${spring.application.name}”)</strong></p>
<p>（1）增加内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">spring:</div><div class="line">  cloud:</div><div class="line">    config:</div><div class="line">      name: microservicecloud-provider-person-config-client-8004 #需要从github上读取的资源名称，注意没有yml后缀名</div><div class="line">      profile: dev   #本次访问的配置项-profile值是什么，决定从github上读取什么</div><div class="line">      label: master</div><div class="line">      uri: http://localhost:10000  #本微服务启动后先去找config配置中心地址，通过SpringCloudConfig获取GitHub的服务地址</div></pre></td></tr></table></figure>
<p>（2）为了配置文件的完整性我们新建一个空的application.yml</p>
<h3 id="4-4-新建一个控制层，获取配置文件的某些属性（测试）"><a href="#4-4-新建一个控制层，获取配置文件的某些属性（测试）" class="headerlink" title="4.4 新建一个控制层，获取配置文件的某些属性（测试）"></a>4.4 新建一个控制层，获取配置文件的某些属性（测试）</h3><p>实际上如果8004服务端能够正常启动和访问，也能够说明客户端获取config配置中心配置文件成功。不过为了证实一下，所以这里通过控制层输出某些属性</p>
<p>（1）新建ConfigClientRest </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@RestController</div><div class="line">public class ConfigClientRest &#123;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;spring.application.name&#125;&quot;)</div><div class="line">    private String applicationName;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;eureka.client.service-url.defaultZone&#125;&quot;)</div><div class="line">    private String eurekaServers;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;server.port&#125;&quot;)</div><div class="line">    private String port;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</div><div class="line">    private String datasourceurl;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/config&quot;)</div><div class="line">    public String getConfig()</div><div class="line">    &#123;</div><div class="line">        String str = &quot;applicationName: &quot;+applicationName+&quot;\t eurekaServers:&quot;+eurekaServers+&quot;\t port: &quot;+port;</div><div class="line">        System.out.println(&quot;******str: &quot;+ str);</div><div class="line">        return &quot;applicationName: &quot;+applicationName+&quot;\t eurekaServers:&quot;+eurekaServers+&quot;\t port: &quot;+port + &quot;\t datasourceurl：&quot;+datasourceurl;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>后面可以通过更改 bootstrap.yml的profile属性的值，访问/config,查看服务端口号和数据库url是否改变。</p>
<h3 id="4-5-新建启动类-1"><a href="#4-5-新建启动类-1" class="headerlink" title="4.5 新建启动类"></a>4.5 新建启动类</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">public class ApplicationBootStart8004client &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line">        SpringApplication.run(ApplicationBootStart8004client.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-5-1-完整目录机构"><a href="#4-5-1-完整目录机构" class="headerlink" title="4.5.1 完整目录机构"></a>4.5.1 完整目录机构</h3><p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_11-07-11.png" alt=""></p>
<h3 id="4-6-启动10000配置中心和8004服务"><a href="#4-6-启动10000配置中心和8004服务" class="headerlink" title="4.6 启动10000配置中心和8004服务"></a>4.6 启动10000配置中心和8004服务</h3><p> （1） 启动Config配置中心10000微服务并自测</p>
<p><img src="/2019/05/01/SpringCloud个人总结/Snipaste_2019-08-20_11-05-27.png" alt=""></p>
<p>（2）启动8004作为Client准备访问</p>
<pre><code>  bootstrap.yml里面的profile值是什么，决定从github上读取什么

2.1 启动成功，说明配置文件获取成功



   2.2 额外验证
</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">假如目前是 profile: dev</div><div class="line">  dev默认在github上对应的端口就是8004</div><div class="line">  http://localhost:8004/config</div><div class="line">  输出：applicationName: microservicecloud-person	eurekaServers:http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/	port: 8004	datasourceurl：jdbc:mysql://127.0.0.1:3306/test</div></pre></td></tr></table></figure>
<p>​<br>​    假如目前是 profile: test<br>​      test默认在github上对应的端口就是8005<br>​      <a href="http://localhost:8005/config" target="_blank" rel="external">http://localhost:8005/config</a><br>​      输出：applicationName: microservicecloud-person    eurekaServers:<a href="http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/" target="_blank" rel="external">http://peer1:7001/eureka/,http://peer2:7002/eureka/,http://peer3:7003/eureka/</a>    port: 8005    datasourceurl：jdbc:mysql://127.0.0.1:3306/test2</p>
<h2 id="5-手动刷新配置"><a href="#5-手动刷新配置" class="headerlink" title="5.手动刷新配置"></a>5.手动刷新配置</h2><pre><code>上面的案例，有个缺点，那就是我们修改了github上面的配置文件（例如修改了连接数据库的地址），对应的8004模块没有刷新，也就是，他获取的连接数据库的地址还是未修改前的。

在真实的案例中，我们不可能手动关闭服务器，然后重启。所以就需要8004它能够自动刷新
</code></pre><p><img src="/2019/05/01/SpringCloud个人总结/1566377247710.png" alt="1566377247710"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566377271635.png" alt="1566377271635"></p>
<p> 需要依赖actuator组件和通过psot方式访问请求配置变动的服务器（也即是@RefreshScope注解所在的bean）</p>
<p>（1）8004模块引入actuator依赖</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>（2）8004启动类添加@EnableDiscoveryClient服务发现注解</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@EnableDiscoveryClient</div><div class="line">public class ApplicationBootStart8004client &#123;</div><div class="line">    public static void main(String[] args)</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        SpringApplication.run(ApplicationBootStart8004client.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>（3）8004模块修改application.yml文件，暴露所有端点</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">management:</div><div class="line">  security:</div><div class="line">    enabled: false</div></pre></td></tr></table></figure>
<p>（4）8004添加controller</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@RestController</div><div class="line">@RefreshScope</div><div class="line">public class ConfigClientRest &#123;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;spring.application.name&#125;&quot;)</div><div class="line">    private String applicationName;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;eureka.client.service-url.defaultZone&#125;&quot;)</div><div class="line">    private String eurekaServers;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;server.port&#125;&quot;)</div><div class="line">    private String port;</div><div class="line"></div><div class="line">    @Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</div><div class="line">    private String datasourceurl;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/config&quot;)</div><div class="line">    public String getConfig()</div><div class="line">    &#123;</div><div class="line">        String str = &quot;applicationName: &quot;+applicationName+&quot;\t eurekaServers:&quot;+eurekaServers+&quot;\t port: &quot;+port;</div><div class="line">        System.out.println(&quot;******str: &quot;+ str);</div><div class="line">        return &quot;applicationName: &quot;+applicationName+&quot;\t eurekaServers:&quot;+eurekaServers+&quot;\t port: &quot;+port + &quot;\t datasourceurl：&quot;+datasourceurl;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>（5）启动configserver10000和8004模块</p>
<p> 打印通过configserver从github上面获取的配置信息</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566379397446.png" alt="1566379397446"></p>
<p>此时数据库的url是：jdbc:mysql://127.0.0.1:3306/test1</p>
<p>（5）这个时候我们修改8004模块在github中引入的配置文件-</p>
<p>也就是修改microservicecloud-provider-person-config-client-8004.yml 文件。</p>
<p>1.修改访问数据库的url为，原先是test1</p>
<blockquote>
<p>url: jdbc:mysql://127.0.0.1:3306/test2    </p>
</blockquote>
<p>2.修改8004的服务端口为8005，原先是8008 - <strong>这个修改我们预测不会成功，因为服务器没有重启</strong></p>
<p>server.port：8005</p>
<p>（6）请求：curl -X POST <a href="http://localhost:8008/refresh" target="_blank" rel="external">http://localhost:8008/refresh</a>  手动更新8004模块的配置</p>
<p>  我们只需要请求这个地址就可以实现配置文件的更新，而不用重启8004模块，他默认会帮我们刷新配置文件。</p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566379561052.png" alt="1566379561052"></p>
<p><img src="/2019/05/01/SpringCloud个人总结/1566379675277.png" alt="1566379675277"></p>
<p>我们发现数据库访问地址修改成功，但是服务端口号没有成功（很明显这种做法是错误的，因为服务端口号不会轻易的变动）</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>如果执行curl -X POST <a href="http://localhost:8008/refresh" target="_blank" rel="external">http://localhost:8008/refresh</a> 包如下错误</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&#123;&quot;timestamp&quot;:1513070580796,&quot;status&quot;:401,&quot;error&quot;:&quot;Unauthorized&quot;,&quot;message&quot;:&quot;Full authentication is required to access this resource.&quot;,&quot;path&quot;:&quot;/refresh&quot;&#125;</div></pre></td></tr></table></figure>
<p>那就说明默认开启访问端口验证了。需要关闭</p>
<p>一、在Spring Boot1.5.x版本中通过management.security.enabled=false来暴露所有端点</p>
<p><img src="/2019/05/01/SpringCloud个人总结/asdfafd.png" alt="img"></p>
<p>二、切换SpringBoot版本为2.x 使用IDE的搜索功能，找到类ManagementServerProperties，发现Security内部类已经被删除，通过去官网查看2.0暴露端点的方式得知：</p>
<blockquote>
<p>方式1：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 启用端点 env</div><div class="line">management.endpoint.env.enabled=true</div><div class="line"> </div><div class="line"># 暴露端点 env 配置多个,隔开</div><div class="line">management.endpoints.web.exposure.include=env</div></pre></td></tr></table></figure>
<blockquote>
<p>方式2：</p>
</blockquote>
<p>方式1中的暴露方式需要一个一个去开启需要暴露的端点，方式2直接开启和暴露所有端点</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">management.endpoints.web.exposure.include=*</div></pre></td></tr></table></figure>
<p>注意在使用Http访问端点时，需要加上默认/actuator 前缀</p>
<p>三、如果这三种还不行，可以尝试在8004添加security验证依赖，然后给8004模块设置访问账号和密码， 然后通过  curl -X POST <a href="http://账号:密码@localhost:8008/refresh" target="_blank" rel="external">http://账号:密码@localhost:8008/refresh</a>  这种方式访问</p>
<h2 id="6-自动刷新配置"><a href="#6-自动刷新配置" class="headerlink" title="6.自动刷新配置"></a>6.自动刷新配置</h2><p>上面是通过手动刷新方式，缺点就是，如果我们在github上面修改了20个服务器的配置，那么我们需要手动执行20次 curl -X POST  ——  ，那么我们想能够缩减执行命令的次数或者说自动刷新配置。</p>
<h1 id="额外知识补充"><a href="#额外知识补充" class="headerlink" title="额外知识补充"></a>额外知识补充</h1><h2 id="1-spring-cloud服务发现注解之-EnableDiscoveryClient与-EnableEurekaClient区别"><a href="#1-spring-cloud服务发现注解之-EnableDiscoveryClient与-EnableEurekaClient区别" class="headerlink" title="1.spring cloud服务发现注解之@EnableDiscoveryClient与@EnableEurekaClient区别"></a>1.spring cloud服务发现注解之@EnableDiscoveryClient与@EnableEurekaClient区别</h2><p>在使用服务发现的时候有两种注解，</p>
<p>一种为@EnableDiscoveryClient,</p>
<p>一种为@EnableEurekaClient,</p>
<p>用法上基本一致，下文是从stackoverflow上面找到的对这<a href="https://www.cnblogs.com/liaojie970/p/What%E2%80%99s%20the%20difference%20between%20EnableEurekaClient%20and%20EnableDiscoveryClient?" target="_blank" rel="external">两者的解释</a>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">There are multiple implementations of &quot;Discovery Service&quot; (eureka, consul, zookeeper). </div><div class="line">@EnableDiscoveryClient lives in spring-cloud-commons and picks the implementation on the classpath.  </div><div class="line">@EnableEurekaClient lives in spring-cloud-netflix and only works for eureka. If eureka is on your classpath, they are effectively the same.</div></pre></td></tr></table></figure>
<p>意思也就是spring cloud中discovery service有许多种实现（eureka、consul、zookeeper等等）</p>
<p>@EnableDiscoveryClient基于spring-cloud-commons；而 @EnableEurekaClient基于spring-cloud-netflix</p>
<p>对@EnableEurekaClient的源码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/**</div><div class="line"> * Convenience annotation for clients to enable Eureka discovery configuration</div><div class="line"> * (specifically). Use this (optionally) in case you want discovery and know for sure that</div><div class="line"> * it is Eureka you want. All it does is turn on discovery and let the autoconfiguration</div><div class="line"> * find the eureka classes if they are available (i.e. you need Eureka on the classpath as</div><div class="line"> * well).</div><div class="line"> *</div><div class="line"> * @author Dave Syer</div><div class="line"> * @author Spencer Gibb</div><div class="line"> */</div><div class="line">@Target(ElementType.TYPE)</div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">@Documented</div><div class="line">@Inherited</div><div class="line">@EnableDiscoveryClient</div><div class="line">public @interface EnableEurekaClient &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注解@EnableEurekaClient上有@EnableDiscoveryClient注解，可以说基本就是EnableEurekaClient有@EnableDiscoveryClient的功能，另外上面的注释中提到，其实@EnableEurekaClient注解就是一种方便使用eureka的注解而已，可以说使用其他的注册中心后，都可以使用@EnableDiscoveryClient注解，</p>
<p>但是使用@EnableEurekaClient的情景，就是在服务采用eureka作为注册中心的时候，使用场景较为单一。</p>
<p><strong>所以还是比较建议使用@EnableDiscoveryClient。</strong></p>
<p><strong>所以上面的还是建议使用@EnableDiscoveryClient替换@EnableEurekaClient</strong></p>
<h2 id="2-Ribbon和Feign"><a href="#2-Ribbon和Feign" class="headerlink" title="2.Ribbon和Feign"></a>2.Ribbon和Feign</h2><p>这两种都是SPringcloud提供的负载均衡技术，都是客户端的软负载均衡技术。feign优化的Ribbon的服务调用方式，实现了面向接口编程的封装。</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果你感觉文章对你又些许感悟，你可以支持我！！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.png" alt="Jeremy Kinge WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay.png" alt="Jeremy Kinge Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
	
	<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
</div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/分布式/" rel="tag"><i class="fa fa-tag"></i> 分布式</a>
          
            <a href="/tags/springcloud/" rel="tag"><i class="fa fa-tag"></i> springcloud</a>
          
            <a href="/tags/微服务架构/" rel="tag"><i class="fa fa-tag"></i> 微服务架构</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/27/浅谈dubbo和springcloud/" rel="next" title="浅谈dubbo和springcloud">
                <i class="fa fa-chevron-left"></i> 浅谈dubbo和springcloud
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/01/Hessian 多系统访问/" rel="prev" title="Hessian 多系统访问">
                Hessian 多系统访问 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微薄</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDUxMS83MDY1"></div>
    
  </div>


      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDUxMS83MDY1"></div>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Jeremy Kinge" />
          <p class="site-author-name" itemprop="name">Jeremy Kinge</p>
           
              <p class="site-description motion-element" itemprop="description">To know everything, no words don't talk, listening to people is enough to cause alarm（知无不言，言无不尽 言者无罪，闻者足戒）</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JeremyKinge" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/LJBANANABLUE?s=09" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                      Twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://m.weibo.cn/u/3991058874?from=1078095010&wm=20005_0002&sourceType=qq&uid=3991058874" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/profile.php?id=100010100689349" target="_blank" title="FB Page">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                    
                      FB Page
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/your-user-name" target="_blank" title="StackOverflow">
                  
                    <i class="fa fa-fw fa-stack-overflow"></i>
                  
                    
                      StackOverflow
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xiezejingzhazha.blog.163.com/" target="_blank" title="网易博客">
                  
                    <i class="fa fa-fw fa-spinner"></i>
                  
                    
                      网易博客
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

		<div id="music163player">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=451768026&auto=0&height=66"></iframe>
</div>
		
        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1分布式的演化"><span class="nav-number">1.</span> <span class="nav-text">1.1分布式的演化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1单一应用架构"><span class="nav-number">1.1.</span> <span class="nav-text">1.1.1单一应用架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-垂直应用架构"><span class="nav-number">1.2.</span> <span class="nav-text">1.1.2 垂直应用架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-分布式服务架构"><span class="nav-number">1.3.</span> <span class="nav-text">1.1.3 分布式服务架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-4-流动计算架构"><span class="nav-number">1.4.</span> <span class="nav-text">1.1.4 流动计算架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-5-微服务架构"><span class="nav-number">1.5.</span> <span class="nav-text">1.1.5 微服务架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-基本概念梳理"><span class="nav-number">2.</span> <span class="nav-text">1.2 基本概念梳理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-微服务优缺点"><span class="nav-number">3.</span> <span class="nav-text">1.3 微服务优缺点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-常见微服务架构"><span class="nav-number">4.</span> <span class="nav-text">1.4 常见微服务架构</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、springcloud和dubbo"><span class="nav-number"></span> <span class="nav-text">二、springcloud和dubbo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-各微服务的框架对比"><span class="nav-number">1.</span> <span class="nav-text">1.各微服务的框架对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-springcloud-VS-Dubbo"><span class="nav-number">2.</span> <span class="nav-text">2. springcloud VS Dubbo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">2.0.1.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、服务调用方式"><span class="nav-number"></span> <span class="nav-text">三、服务调用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-RPC和HTTP"><span class="nav-number">1.</span> <span class="nav-text">1.RPC和HTTP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Http客户端工具"><span class="nav-number">2.</span> <span class="nav-text">2.Http客户端工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Spring的RestTemplate"><span class="nav-number">3.</span> <span class="nav-text">3.Spring的RestTemplate</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四、初识SpringCloud"><span class="nav-number"></span> <span class="nav-text">四、初识SpringCloud</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-简介"><span class="nav-number">1.</span> <span class="nav-text">1.简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-SpringCloud和springboot是什么关系"><span class="nav-number">2.</span> <span class="nav-text">2.SpringCloud和springboot是什么关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-springcloud的版本"><span class="nav-number">3.</span> <span class="nav-text">3.springcloud的版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-SpringCloud的参考资料"><span class="nav-number">4.</span> <span class="nav-text">4.SpringCloud的参考资料</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五、springcloud的实现准备"><span class="nav-number"></span> <span class="nav-text">五、springcloud的实现准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-新建父工程-microservicecloud"><span class="nav-number">1.</span> <span class="nav-text">1 新建父工程-microservicecloud</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-根据父工程，新建api公共模块-microservicecloud-api"><span class="nav-number">2.</span> <span class="nav-text">2 根据父工程，新建api公共模块-microservicecloud-api</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-查看父工程pom"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 查看父工程pom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-修改microservicecloud-api的pom文件"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 修改microservicecloud-api的pom文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-新建公共bean-Person"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 新建公共bean-Person</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-项目结构"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 项目结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-根据父工程，新建微服务提供者-provider"><span class="nav-number">3.</span> <span class="nav-text">3 根据父工程，新建微服务提供者-provider</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-修改pom文件"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 修改pom文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-新建application-yml文件"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 新建application.yml文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-新建person数据表"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 新建person数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-新建dao和mapper"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 新建dao和mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-新建mybatis-cfg-xml"><span class="nav-number">3.5.</span> <span class="nav-text">3.4.1 新建mybatis.cfg.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-新建PersonMapper-xml"><span class="nav-number">3.6.</span> <span class="nav-text">3.5 新建PersonMapper.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-新建PersonService接口和接口实现类impl"><span class="nav-number">3.7.</span> <span class="nav-text">3.6 新建PersonService接口和接口实现类impl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-controller控制层-PersonController"><span class="nav-number">3.8.</span> <span class="nav-text">3.7 controller控制层-PersonController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-springboot启动类"><span class="nav-number">3.9.</span> <span class="nav-text">3.8 springboot启动类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-项目整体结构"><span class="nav-number">3.10.</span> <span class="nav-text">3.9 项目整体结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-根据父工程，新建微服务消费者-consumer"><span class="nav-number">4.</span> <span class="nav-text">4 根据父工程，新建微服务消费者-consumer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-修改pom文件"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 修改pom文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-添加application-yml文件"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 添加application.yml文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-新建-Configuration注解的配置类"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 新建@Configuration注解的配置类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-新建消费者控制器，访问服务提供者获取数据"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 新建消费者控制器，访问服务提供者获取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-新建启动类"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 新建启动类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-完整项目结构"><span class="nav-number">4.6.</span> <span class="nav-text">4.6 完整项目结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-同时启动服务提供者和服务消费者"><span class="nav-number">5.</span> <span class="nav-text">5 同时启动服务提供者和服务消费者</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-上面的项目存在什么问题"><span class="nav-number">6.</span> <span class="nav-text">5.上面的项目存在什么问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六、Eureka注册中心"><span class="nav-number"></span> <span class="nav-text">六、Eureka注册中心</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Eureka概念"><span class="nav-number">1.</span> <span class="nav-text">1.Eureka概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Eureka架构和原理"><span class="nav-number">2.</span> <span class="nav-text">2.Eureka架构和原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-实现EurekaServer"><span class="nav-number">3.</span> <span class="nav-text">3. 实现EurekaServer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-根据父工程实现单节点Eureka服务注册中心"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 根据父工程实现单节点Eureka服务注册中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-修改pom文件导入EurekaServer依赖"><span class="nav-number">3.1.1.</span> <span class="nav-text">3.1.1 修改pom文件导入EurekaServer依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-修改application-yml配置文件"><span class="nav-number">3.1.2.</span> <span class="nav-text">3.1.2 修改application.yml配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-创建启动类并添加-EnableEurekaServer注解"><span class="nav-number">3.1.3.</span> <span class="nav-text">3.1.3 创建启动类并添加@EnableEurekaServer注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4-完整项目结构"><span class="nav-number">3.1.4.</span> <span class="nav-text">3.1.4 完整项目结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-5-运行启动类，启动EurekaServer"><span class="nav-number">3.1.5.</span> <span class="nav-text">3.1.5 运行启动类，启动EurekaServer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-修改-服务提供者"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 修改 服务提供者</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-修改pom文件"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 修改pom文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-修改application-yml配置文件"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.2 修改application.yml配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-修改启动类添加-EnableEurekaClient注解"><span class="nav-number">3.2.3.</span> <span class="nav-text">3.2.3 修改启动类添加@EnableEurekaClient注解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-修改服务消费者"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 修改服务消费者</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-修改pom文件"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 修改pom文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-修改application-yml配置文件"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2 修改application.yml配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-修改启动类添加-EnableEurekaClient注解"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3.3 修改启动类添加@EnableEurekaClient注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4修改ConsumerController代码"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.3.4修改ConsumerController代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-启动EurekaServer和服务提供者，以及服务消费者"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 启动EurekaServer和服务提供者，以及服务消费者</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-actuator与注册微服务信息完善"><span class="nav-number">4.</span> <span class="nav-text">4.actuator与注册微服务信息完善</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-修改服务实例名和实例名访问路径显示ip"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 修改服务实例名和实例名访问路径显示ip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-修改服务实例的详情页info"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 修改服务实例的详情页info</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Eureka详解"><span class="nav-number">5.</span> <span class="nav-text">5.Eureka详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-基础架构"><span class="nav-number">5.1.</span> <span class="nav-text">5.1.基础架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-服务提供者"><span class="nav-number">5.2.</span> <span class="nav-text">5.2.服务提供者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-服务消费者"><span class="nav-number">5.3.</span> <span class="nav-text">5.3.服务消费者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-失效剔除和自我保护"><span class="nav-number">5.4.</span> <span class="nav-text">5.4.失效剔除和自我保护</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-消费者获取服务信息"><span class="nav-number">6.</span> <span class="nav-text">6.消费者获取服务信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-EurekaServer集群"><span class="nav-number">7.</span> <span class="nav-text">7.EurekaServer集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-根据microservicecloud-eureka-7001创建两个相同的工程"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 根据microservicecloud-eureka-7001创建两个相同的工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-修改映射配置-实现唯一的eureka服务端的实例名称"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 修改映射配置-实现唯一的eureka服务端的实例名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-修改7001-7003三台EurekaServer的配置文件"><span class="nav-number">7.3.</span> <span class="nav-text">7.3 修改7001-7003三台EurekaServer的配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-修改服务提供者的配置文件"><span class="nav-number">7.4.</span> <span class="nav-text">7.4 修改服务提供者的配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5重启7001-7003服务器"><span class="nav-number">7.5.</span> <span class="nav-text">7.5重启7001-7003服务器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Eureka和Zookeeper-服务注册中心比较"><span class="nav-number">8.</span> <span class="nav-text">8.Eureka和Zookeeper-服务注册中心比较</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-Zookeeper保证CP"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 Zookeeper保证CP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-Eureka保证AP"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 Eureka保证AP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#七、Ribbon负载均衡"><span class="nav-number"></span> <span class="nav-text">七、Ribbon负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-Ribbon概念"><span class="nav-number">1.</span> <span class="nav-text">7.1 Ribbon概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-什么叫LB（负载均衡）"><span class="nav-number">2.</span> <span class="nav-text">7.2 什么叫LB（负载均衡）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-Ribbon负载均衡实现"><span class="nav-number">3.</span> <span class="nav-text">7.3 Ribbon负载均衡实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-1-根据8001模块复制新建两份分别命名为8002和8003"><span class="nav-number">3.1.</span> <span class="nav-text">7.3.1 根据8001模块复制新建两份分别命名为8002和8003</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-新建数据库test2、test3，让各自微服务分别连各自的数据库"><span class="nav-number">3.2.</span> <span class="nav-text">7.3.2 新建数据库test2、test3，让各自微服务分别连各自的数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-3-修改8002-8003各自application-yml配置文件"><span class="nav-number">3.3.</span> <span class="nav-text">7.3.3 修改8002/8003各自application.yml配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-4-启动EurekaServer集群和8001-8003服务模块"><span class="nav-number">3.4.</span> <span class="nav-text">7.3.4 启动EurekaServer集群和8001-8003服务模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-5-自测启动的服务是否可用"><span class="nav-number">3.5.</span> <span class="nav-text">7.3.5 自测启动的服务是否可用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-6-修改服务消费者-采取负载均衡方式访问服务"><span class="nav-number">3.6.</span> <span class="nav-text">7.3.6 修改服务消费者-采取负载均衡方式访问服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-7-修改服务消费者"><span class="nav-number">3.7.</span> <span class="nav-text">7.3.7 修改服务消费者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-8-启动7001-7003-8001-8003，80"><span class="nav-number">3.8.</span> <span class="nav-text">7.3.8 启动7001-7003,8001-8003，80</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-9-总结"><span class="nav-number">3.9.</span> <span class="nav-text">7.3.9 总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-Ribbon负载均衡实现核心接口IRule"><span class="nav-number">4.</span> <span class="nav-text">7.4 Ribbon负载均衡实现核心接口IRule</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-1-源码跟踪"><span class="nav-number">4.1.</span> <span class="nav-text">7.4.1.源码跟踪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-2-负载均衡策略"><span class="nav-number">4.2.</span> <span class="nav-text">7.4.2.负载均衡策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#七大方法"><span class="nav-number">4.2.1.</span> <span class="nav-text">七大方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-3-负载均衡自定义"><span class="nav-number">4.3.</span> <span class="nav-text">7.4.3 负载均衡自定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-修改某个服务的负载均衡策略"><span class="nav-number">4.3.1.</span> <span class="nav-text">1.修改某个服务的负载均衡策略</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#第一种使用配置方式（建议使用）"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">第一种使用配置方式（建议使用）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第二种使用配置方式"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">第二种使用配置方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-修改全局的服务访问策略（替换默认的轮询策略）"><span class="nav-number">4.3.2.</span> <span class="nav-text">2. 修改全局的服务访问策略（替换默认的轮询策略）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-自定义负载均衡策略"><span class="nav-number">4.3.3.</span> <span class="nav-text">3.自定义负载均衡策略</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#（1）新建RandomRuleModify类"><span class="nav-number">4.3.3.1.</span> <span class="nav-text">（1）新建RandomRuleModify类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（2）OwnRule返回我们实现的RandomRuleModify"><span class="nav-number">4.3.3.2.</span> <span class="nav-text">（2）OwnRule返回我们实现的RandomRuleModify</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（3）修改启动类"><span class="nav-number">4.3.3.3.</span> <span class="nav-text">（3）修改启动类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（4）运行测试类LoadBalanceTest"><span class="nav-number">4.3.3.4.</span> <span class="nav-text">（4）运行测试类LoadBalanceTest</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（5）总结"><span class="nav-number">4.3.3.5.</span> <span class="nav-text">（5）总结</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#八、-Feign负载均衡"><span class="nav-number"></span> <span class="nav-text">八、 Feign负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-简介"><span class="nav-number">1.</span> <span class="nav-text">8.1.简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-实现Feign"><span class="nav-number">2.</span> <span class="nav-text">8.2 实现Feign</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#（1）根据父工程新建microservicecloud-consumer-person-80-feign模块"><span class="nav-number">2.1.</span> <span class="nav-text">（1）根据父工程新建microservicecloud-consumer-person-80-feign模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#（2）复制80模块代码到80-feign模块"><span class="nav-number">2.2.</span> <span class="nav-text">（2）复制80模块代码到80-feign模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#（3）修改80-feign模块的pom文件，添加Feign依赖"><span class="nav-number">2.3.</span> <span class="nav-text">（3）修改80-feign模块的pom文件，添加Feign依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#（4）修改api公共模块"><span class="nav-number">2.4.</span> <span class="nav-text">（4）修改api公共模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#（5）feign工程修改Controller，添加上一步新建的PersonClientService接口"><span class="nav-number">2.5.</span> <span class="nav-text">（5）feign工程修改Controller，添加上一步新建的PersonClientService接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#（6）feign工程修改主启动类"><span class="nav-number">2.6.</span> <span class="nav-text">（6）feign工程修改主启动类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#（7）启动EurekaServer7001-7003和服务提供集群8001-8003，启动feign工程进行测试"><span class="nav-number">2.7.</span> <span class="nav-text">（7）启动EurekaServer7001-7003和服务提供集群8001-8003，启动feign工程进行测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-总结"><span class="nav-number">3.</span> <span class="nav-text">8.3 总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-请求压缩-了解"><span class="nav-number">4.</span> <span class="nav-text">8.4.请求压缩(了解)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-日志级别-了解"><span class="nav-number">5.</span> <span class="nav-text">8.5.日志级别(了解)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-Hystrix支持"><span class="nav-number">6.</span> <span class="nav-text">8.6.Hystrix支持</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#九、Hystrix断路器"><span class="nav-number"></span> <span class="nav-text">九、Hystrix断路器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-分布式系统面临的问题"><span class="nav-number">1.</span> <span class="nav-text">1.分布式系统面临的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Hystrix简介"><span class="nav-number">2.</span> <span class="nav-text">2.Hystrix简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-服务端的服务熔断"><span class="nav-number">3.</span> <span class="nav-text">3.服务端的服务熔断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-熔断原理"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 熔断原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-案例演示"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 案例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-参考microservicecloud-provider-person-8001-新建microservicecloud-provider-person-hystrix-8001"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 参考microservicecloud-provider-person-8001 新建microservicecloud-provider-person-hystrix-8001</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-修改新建hystrix-8001模块的pom文件和启动类"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.2 修改新建hystrix-8001模块的pom文件和启动类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-修改配置文件"><span class="nav-number">3.2.3.</span> <span class="nav-text">3.2.3 修改配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-修改PersonController，添加熔断处理"><span class="nav-number">3.2.4.</span> <span class="nav-text">3.2.4 修改PersonController，添加熔断处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-启动EurekaServer集群和8001-hystrix模块、80模块"><span class="nav-number">3.2.5.</span> <span class="nav-text">3.2.5 启动EurekaServer集群和8001-hystrix模块、80模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-客户端的服务降级"><span class="nav-number">4.</span> <span class="nav-text">4.客户端的服务降级</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-案例演示"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 案例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-修改microservicecloud-api的工程-根据已有的PersonClientService接口新建一个实现类-FallbackFactory接口的类PersonClientServiceFallbackFactory"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1 修改microservicecloud-api的工程, 根据已有的PersonClientService接口新建一个实现类 FallbackFactory接口的类PersonClientServiceFallbackFactory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-修改microservicecloud-api工程-PersonClientService接口在注解-FeignCLient中添加fallbackFactory属性值"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2  修改microservicecloud-api工程,PersonClientService接口在注解@FeignCLient中添加fallbackFactory属性值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-修改80-feign消费者端配置文件，开启服务熔断"><span class="nav-number">4.1.3.</span> <span class="nav-text">4.1.3 修改80-feign消费者端配置文件，开启服务熔断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-测试"><span class="nav-number">4.1.4.</span> <span class="nav-text">4.1.4 测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-服务监控HystrixDashboard"><span class="nav-number">5.</span> <span class="nav-text">5. 服务监控HystrixDashboard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-案例实现"><span class="nav-number">5.1.</span> <span class="nav-text">5.1   案例实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-新建-microservicecloud-consumer-hystrix-dashboard-9001-模块"><span class="nav-number">5.1.1.</span> <span class="nav-text">5.1.1 新建    microservicecloud-consumer-hystrix-dashboard-9001    模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-启动dashboard-9001模块"><span class="nav-number">5.1.2.</span> <span class="nav-text">5.1.2 启动dashboard-9001模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-启动3个eureka集群"><span class="nav-number">5.1.3.</span> <span class="nav-text">5.1.3 启动3个eureka集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4启动microservicecloud-provider-person-hystrix-8001和microservicecloud-consumer-person-80-feign-服务端和消费者"><span class="nav-number">5.1.4.</span> <span class="nav-text">5.1.4启动microservicecloud-provider-person-hystrix-8001和microservicecloud-consumer-person-80-feign 服务端和消费者</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4dashboard填写需要监控的服务地址"><span class="nav-number">5.1.5.</span> <span class="nav-text">5.1.4dashboard填写需要监控的服务地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-5-多次刷新http-localhost-consumer-person-get-1"><span class="nav-number">5.1.6.</span> <span class="nav-text">5.1.5 多次刷新http://localhost/consumer/person/get/1</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十、-zuul路由网关"><span class="nav-number"></span> <span class="nav-text">十、 zuul路由网关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-简介-1"><span class="nav-number">1.</span> <span class="nav-text">1.简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Zuul加入后的架构"><span class="nav-number">2.</span> <span class="nav-text">2.Zuul加入后的架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-路由基本配置（例子）"><span class="nav-number">3.</span> <span class="nav-text">3.路由基本配置（例子）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1新建Module模块microservicecloud-zuul-gateway-9999"><span class="nav-number">3.1.</span> <span class="nav-text">3.1新建Module模块microservicecloud-zuul-gateway-9999</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-修改pom文件"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 修改pom文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-修改application-yml"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 修改application.yml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-修改主启动类ApplicationBootStart9999zuul"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 修改主启动类ApplicationBootStart9999zuul</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1完整工程展示"><span class="nav-number">3.5.</span> <span class="nav-text">3.4.1完整工程展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5启动三个eureka集群-、一个服务提供类microservicecloud-provider-person-8001-、9999模块路由"><span class="nav-number">3.6.</span> <span class="nav-text">3.5启动三个eureka集群 、一个服务提供类microservicecloud-provider-person-8001 、9999模块路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-测试"><span class="nav-number">3.7.</span> <span class="nav-text">3.6 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-路由访问映射规则"><span class="nav-number">4.</span> <span class="nav-text">4.路由访问映射规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-修改9999模块配置文件"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 修改9999模块配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-重启9999模块"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 重启9999模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-原真实服务名忽略-关闭默认的路由规则"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 原真实服务名忽略-关闭默认的路由规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-设置统一公共前缀"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 设置统一公共前缀</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-默认的路由规则"><span class="nav-number">5.</span> <span class="nav-text">5 .默认的路由规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-过滤器"><span class="nav-number">6.</span> <span class="nav-text">6.过滤器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-ZuulFilter"><span class="nav-number">6.1.</span> <span class="nav-text">6.1.ZuulFilter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-过滤器执行生命周期"><span class="nav-number">6.2.</span> <span class="nav-text">6.2.过滤器执行生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-使用场景"><span class="nav-number">6.3.</span> <span class="nav-text">6.3.使用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-自定义过滤器"><span class="nav-number">7.</span> <span class="nav-text">7.自定义过滤器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-定义过滤器类"><span class="nav-number">7.1.</span> <span class="nav-text">7.1.定义过滤器类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-测试"><span class="nav-number">7.2.</span> <span class="nav-text">7.2.测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-负载均衡和熔断"><span class="nav-number">8.</span> <span class="nav-text">8.负载均衡和熔断</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十一、SpringCloud-Config-分布式配置中心"><span class="nav-number"></span> <span class="nav-text">十一、SpringCloud Config 分布式配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-为什么需要配置中心"><span class="nav-number">1.</span> <span class="nav-text">1.为什么需要配置中心</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-config配置中心"><span class="nav-number">2.</span> <span class="nav-text">2. config配置中心</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-SpringCloud-Config服务端配置"><span class="nav-number">3.</span> <span class="nav-text">3.SpringCloud Config服务端配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-在GitHub上新建一个名为springcloud-config-server的新Repository"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 在GitHub上新建一个名为springcloud-config-server的新Repository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-本地磁盘获取上述创建的仓库"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 本地磁盘获取上述创建的仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-在上述磁盘新建配置文件并上传到git仓库"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 在上述磁盘新建配置文件并上传到git仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-新建Module模块microservicecloud-config-10000它即为Cloud的配置中心模块"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 新建Module模块microservicecloud-config-10000它即为Cloud的配置中心模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-修改10000模块pom文件和yml配置文件、启动类"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 修改10000模块pom文件和yml配置文件、启动类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-完整项目结构"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 完整项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-测试通过Config微服务是否可以从GitHub上获取配置内容"><span class="nav-number">3.7.</span> <span class="nav-text">3.7 测试通过Config微服务是否可以从GitHub上获取配置内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-配置文件读取规则"><span class="nav-number">3.8.</span> <span class="nav-text">3.8 配置文件读取规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-SpringCloud-Config客户端配置与测试"><span class="nav-number">4.</span> <span class="nav-text">4.SpringCloud Config客户端配置与测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-新建8004-配置文件并上传到github"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 新建8004 配置文件并上传到github</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-microservicecloud-provider-person-config-client-8004模块"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 microservicecloud-provider-person-config-client-8004模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-新建bootstrap-yml-系统级别配置文件"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 新建bootstrap.yml 系统级别配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-新建一个控制层，获取配置文件的某些属性（测试）"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 新建一个控制层，获取配置文件的某些属性（测试）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-新建启动类-1"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 新建启动类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-1-完整目录机构"><span class="nav-number">4.6.</span> <span class="nav-text">4.5.1 完整目录机构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-启动10000配置中心和8004服务"><span class="nav-number">4.7.</span> <span class="nav-text">4.6 启动10000配置中心和8004服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-手动刷新配置"><span class="nav-number">5.</span> <span class="nav-text">5.手动刷新配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注意"><span class="nav-number">5.1.</span> <span class="nav-text">注意</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-自动刷新配置"><span class="nav-number">6.</span> <span class="nav-text">6.自动刷新配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#额外知识补充"><span class="nav-number"></span> <span class="nav-text">额外知识补充</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-spring-cloud服务发现注解之-EnableDiscoveryClient与-EnableEurekaClient区别"><span class="nav-number">1.</span> <span class="nav-text">1.spring cloud服务发现注解之@EnableDiscoveryClient与@EnableEurekaClient区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Ribbon和Feign"><span class="nav-number">2.</span> <span class="nav-text">2.Ribbon和Feign</span></a></li></ol></div>
            

          </div>
		  

		  
        </section>
      <!--/noindex-->
      

      

    </div>
	

	
  </aside>
  

  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2022 &mdash; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeremy Kinge</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">
      183.7k
    </span>
  
</div>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv">
  
</div>



  <span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
<span class="post-meta-divider">|</span>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共183.7k字</span>
</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  




  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</html>
