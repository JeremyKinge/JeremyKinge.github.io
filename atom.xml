<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>King哥</title>
  <subtitle>To know everything, no words don&#39;t talk, listening to people is enough to cause alarm（知无不言，言无不尽 言者无罪，闻者足戒）</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://kingge.top/"/>
  <updated>2017-08-17T09:44:39.015Z</updated>
  <id>http://kingge.top/</id>
  
  <author>
    <name>Jeremy Kinge</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>max-allowed-packet的问题</title>
    <link href="http://kingge.top/2017/08/17/max-allowed-packet%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://kingge.top/2017/08/17/max-allowed-packet的问题/</id>
    <published>2017-08-17T02:37:15.000Z</published>
    <updated>2017-08-17T09:44:39.015Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p> 近期，因启动项目有个批量插入的sql结果太大，超过了mysql自带的缓存，报了这个错误</p>
</blockquote>
<hr>
<blockquote>
<p>修改： 定位到mysql的安装目录下面，然后修改my.ini 的max_allowed_packet = 8M<br>默认是1M </p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt; 近期，因启动项目有个批量插入的sql结果太大，超过了mysql自带的缓存，报了这个错误&lt;/p&gt;
&lt;/blockq
    
    </summary>
    
      <category term="Mysql" scheme="http://kingge.top/categories/Mysql/"/>
    
    
      <category term="Mysql" scheme="http://kingge.top/tags/Mysql/"/>
    
      <category term="异常" scheme="http://kingge.top/tags/%E5%BC%82%E5%B8%B8/"/>
    
      <category term="sql异常" scheme="http://kingge.top/tags/sql%E5%BC%82%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>博客迁移</title>
    <link href="http://kingge.top/2017/08/14/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/"/>
    <id>http://kingge.top/2017/08/14/博客迁移/</id>
    <published>2017-08-14T02:26:07.157Z</published>
    <updated>2017-08-16T02:35:53.838Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>今天周一，天气炎热，调开空调。噼里啪啦的敲完今天的工作，因为今天本人决定再次迁移自己的PersonalBlog。个人一共换过很多个博客，前期使用过网易博客，后来访问量上不去(网易博客他并不是一个IT社区)，后来换到了博客园，感觉还行，但是好景不长，感觉本人有处女座的完美主义，很纠结，总感觉这个博客园UI设计不行。<br>      最后又换到了CSDN，今天又临时决定迁移到了本人的服务器上面，自由管理。<br>      我的性格知道的人应该知道，我是知无不言言无不尽，只要我会的有所感悟的都会分享出来。以后每天心情一更，工作方面一周一更。</p>
</blockquote>
<hr>
<blockquote>
<p>最后：人生需要面对,搞笑我是认真的。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;今天周一，天气炎热，调开空调。噼里啪啦的敲完今天的工作，因为今天本人决定再次迁移自己的PersonalBlog。个人一共换过很多个博客，前期使用过网易博客，后来访问量上不去(网易博客他并不是一个IT社区)，后来换到了博客园，感觉还行，但是好景不长，
    
    </summary>
    
      <category term="心情" scheme="http://kingge.top/categories/%E5%BF%83%E6%83%85/"/>
    
    
  </entry>
  
  <entry>
    <title>Hessian 多系统访问</title>
    <link href="http://kingge.top/2017/08/14/Hessian%20%E5%A4%9A%E7%B3%BB%E7%BB%9F%E8%AE%BF%E9%97%AE/"/>
    <id>http://kingge.top/2017/08/14/Hessian 多系统访问/</id>
    <published>2017-08-14T01:31:13.972Z</published>
    <updated>2017-08-17T03:20:39.201Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>实现多数据量的导入数据库</title>
    <link href="http://kingge.top/2017/08/01/%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%95%B0%E6%8D%AE%E9%87%8F%E7%9A%84%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>http://kingge.top/2017/08/01/实现多数据量的导入数据库/</id>
    <published>2017-08-01T06:37:15.000Z</published>
    <updated>2017-08-17T08:21:15.695Z</updated>
    
    <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><blockquote>
<p>在做一个项目的时候，涉及到需要从一个表格中获取百万条数据然后插入到数据库中，最后采用JDBC的executeBantch方法实现这个功能。</p>
</blockquote>
<hr>
<h2 id="采取的策略"><a href="#采取的策略" class="headerlink" title="采取的策略"></a>采取的策略</h2><ul>
<li><p>尽量关闭字段<a href="/2016/08/01/Mysql索引详解"><strong><em>索引</em></strong></a>（因为再插入数据的时候还是需要维护索引的，在创建索引和维护索引 会耗费时间,随着数据量的增加而增加，可以在插入数据后再去为字段创建索引）</p>
<blockquote>
<p>虽然索引可以提高查询速度但是，插入数据的时候会导致索性的更新。索性越多，插入会越慢。可以看文档描述:<br>Although it can be tempting to create an indexes for every possible column used in a query, unnecessary indexes waste space and waste time for MySQL to determine which indexes to use. Indexes also add to the cost of inserts, updates, and deletes because each index must be updated. You must find the right balance to achieve fast queries using the optimal set of indexes.</p>
</blockquote>
</li>
<li><p>分批次提交数据</p>
</li>
<li><p>在分布式条件下，还可以考虑在不同的数据库结点提交，有底层的消息系统完成数据扩展</p>
</li>
<li>过滤预处理数据<blockquote>
<p>预处理数据的场景：为了避免插入的数据（假设ListA）跟数据库中某些数据重复，那么我们会把要插入的数据去数据库中查询是否已经存在，获得返回的已经存在数据（ListB）。然后在插入数据的时候判断当前数据是否在ListB中，那么当前数据不能够插入数据库。过滤出来，最后得到一个可以插入数据库的ListC</p>
</blockquote>
</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/*数据分析结束*/</span></div><div class="line">     <span class="comment">/*往数据库写数据开始*/</span></div><div class="line">     Connection conn=<span class="keyword">null</span>;</div><div class="line">     PreparedStatement idsUserAdd=<span class="keyword">null</span>;</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">         Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>) ;</div><div class="line">         conn = DriverManager.getConnection(ConfigTool.getProperty(<span class="string">"jdbc.url"</span>).toString() , ConfigTool.getProperty(<span class="string">"jdbc.username"</span>).toString() , ConfigTool.getProperty(<span class="string">"jdbc.password"</span>).toString());</div><div class="line">         conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">         <span class="comment">//构造预处理statement</span></div><div class="line">         idsUserAdd = conn.prepareStatement(<span class="string">"INSERT INTO dc_matedata ("</span>+</div><div class="line">       		  <span class="string">" ID,`NAME`, DATATYPE,`CODE`,TYPE_ID,`LENGTH`, "</span>+</div><div class="line">       		  <span class="string">" DATANAME, VALUEAREA,`RESTRICT`, REMARK,MD_DATE)"</span>+</div><div class="line">       		  <span class="string">" values(?,?,?,?,?,?,?,?,?,?,now())"</span>);</div><div class="line">        <span class="comment">//最大列表的数目当做循环次数</span></div><div class="line">         <span class="keyword">int</span> xhcs=addMetadataList.size();<span class="comment">//addMetadataList需要插入的数据</span></div><div class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;xhcs;i++)&#123;</div><div class="line">                 idsUserAdd.setString(<span class="number">1</span>,addMetadataList.get(i).get(<span class="string">"id"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">2</span>,addMetadataList.get(i).get(<span class="string">"name"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">3</span>,addMetadataList.get(i).get(<span class="string">"dataType"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">4</span>,addMetadataList.get(i).get(<span class="string">"code"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">5</span>,addMetadataList.get(i).get(<span class="string">"typeId"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">6</span>,addMetadataList.get(i).get(<span class="string">"dataLength"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">7</span>,addMetadataList.get(i).get(<span class="string">"dataName"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">8</span>,addMetadataList.get(i).get(<span class="string">"valueArea"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">9</span>,addMetadataList.get(i).get(<span class="string">"dataRestrict"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">10</span>,addMetadataList.get(i).get(<span class="string">"dataRemark"</span>).toString());</div><div class="line">                 idsUserAdd.addBatch();</div><div class="line">                 </div><div class="line">             <span class="comment">//每10000次提交一次</span></div><div class="line">             <span class="keyword">if</span>(i%<span class="number">10000</span>==<span class="number">0</span>||i==xhcs-<span class="number">1</span>)&#123;<span class="comment">//可以设置不同的大小；如50，100，500，1000等等 i==xhcs-1（最后一次）</span></div><div class="line">                 idsUserAdd.executeBatch();</div><div class="line">                 conn.commit();</div><div class="line">                 idsUserAdd.clearBatch();</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">         e.printStackTrace();</div><div class="line">         <span class="keyword">throw</span>  e;</div><div class="line">     &#125;<span class="keyword">finally</span> &#123;</div><div class="line">         <span class="keyword">try</span> &#123;</div><div class="line">             <span class="keyword">if</span>(idsUserAdd!=<span class="keyword">null</span>)</div><div class="line">                 idsUserAdd.close();</div><div class="line">             <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)</div><div class="line">                 conn.close();</div><div class="line">         &#125;<span class="keyword">catch</span>(Exception e)&#123;</div><div class="line">             e.printStackTrace();</div><div class="line">             <span class="keyword">throw</span>  e;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">     &#125;</div><div class="line">     <span class="comment">/*往数据库写数据结束*/</span></div></pre></td></tr></table></figure>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">   * 校验需要导入的元数据信息，封装错误信息并批量插入数据库</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; saveDCMetadataBatch(List&lt;Map&lt;String, Object&gt;&gt; list,  <span class="keyword">boolean</span> valid,</div><div class="line">          <span class="keyword">boolean</span> addError) <span class="keyword">throws</span> Exception&#123;</div><div class="line">      </div><div class="line">      List&lt;Map&lt;String,Object&gt;&gt; errorList=<span class="keyword">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();<span class="comment">//获得不能够添加成功的数据</span></div><div class="line">      Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();<span class="comment">//查询条件</span></div><div class="line">      Map&lt;String,String&gt; codeMap=<span class="keyword">new</span> HashMap&lt;String,String&gt;();<span class="comment">//每个分类对应的元数据的编号最大值</span></div><div class="line">      Map&lt;String,Object&gt; metaName=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();<span class="comment">//查询数据库中是否存在相同的数据（这里校验的是：元数据的中文简称）</span></div><div class="line">      Map&lt;String,Object&gt; metaDataName=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();<span class="comment">//查询数据库中是否存在相同的数据（这里校验的是：元数据的数据项名称）</span></div><div class="line">      </div><div class="line">      map.put(<span class="string">"metaName"</span>,list);<span class="comment">//需要查询的元数据中文名称</span></div><div class="line">      map.put(<span class="string">"metaDataTypeId"</span>,list);<span class="comment">//导入的元数据的编号</span></div><div class="line">      List&lt;Map&lt;String, Object&gt;&gt; metaExistList = dCMatedataDao.getDCMetadata(map);<span class="comment">//根据元数据名称查询当前分类下是否存在同样元数据</span></div><div class="line">      map.put(<span class="string">"metaName"</span>,<span class="keyword">null</span>);<span class="comment">//置空</span></div><div class="line">      </div><div class="line">      map.put(<span class="string">"metaDataName"</span>,list);</div><div class="line">      List&lt;Map&lt;String, Object&gt;&gt; metaExistListTwo = dCMatedataDao.getDCMetadata(map);<span class="comment">//根据元数据数据项名称查询存在的元数据</span></div><div class="line">      </div><div class="line">      <span class="comment">//保存重复的信息</span></div><div class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;metaExistList.size();i++)</div><div class="line">          metaName.put(metaExistList.get(i).get(<span class="string">"name"</span>).toString()+metaExistList.get(i).get(<span class="string">"code"</span>).toString()</div><div class="line">                  ,metaExistList.get(i).get(<span class="string">"id"</span>));<span class="comment">//添加父类的编号为后缀-唯一性保证</span></div><div class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;metaExistListTwo.size();i++)</div><div class="line">          metaDataName.put(metaExistListTwo.get(i).get(<span class="string">"dataname"</span>).toString()+metaExistListTwo.get(i).get(<span class="string">"code"</span>).toString(),</div><div class="line">                  metaExistListTwo.get(i).get(<span class="string">"id"</span>));</div><div class="line">      </div><div class="line">      </div><div class="line">      <span class="comment">/*整理出来的数据-开始*/</span></div><div class="line">      List&lt;Map&lt;String,Object&gt;&gt; addMetadataList=<span class="keyword">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();</div><div class="line">      </div><div class="line">      <span class="comment">/*整理出来的数据-结束*/</span></div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</div><div class="line">          Map&lt;String, Object&gt; MetadataObj = list.get(i);</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              String metadatId = StringUtil.getUUID();<span class="comment">//元数据id</span></div><div class="line">                  <span class="comment">/*校验开始*/</span></div><div class="line">              <span class="keyword">if</span> (valid)&#123;</div><div class="line">                  <span class="keyword">if</span>(validUser(MetadataObj,<span class="string">"name"</span>,addError)!=<span class="keyword">null</span>)&#123;<span class="comment">//验证输入的数据是否符合格式和必填。</span></div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">              &#125;</div><div class="line">              <span class="comment">/*前端校验结束*/</span></div><div class="line">              <span class="comment">/*校验是否存在同名的元数据*/</span></div><div class="line">              String dataCodeCheck = MetadataObj.get(<span class="string">"dataCode"</span>).toString().trim();      <span class="comment">//元数据父分类编号</span></div><div class="line">              String name = MetadataObj.get(<span class="string">"name"</span>).toString().trim();<span class="comment">//元数据中文简称</span></div><div class="line">                  <span class="keyword">if</span> (metaName.containsKey(name+dataCodeCheck)) &#123;</div><div class="line"></div><div class="line">                      <span class="keyword">if</span> (addError) &#123;</div><div class="line">                          MetadataObj.put(<span class="string">"errInfo"</span>, <span class="string">"中文简称已存在"</span>);</div><div class="line">                      &#125;</div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">                  <span class="comment">/*校验是否存在相同数据项的元数据*/</span></div><div class="line">                  String dataName = MetadataObj.get(<span class="string">"dataName"</span>).toString().trim();<span class="comment">//数据项名</span></div><div class="line">                  <span class="keyword">if</span> (metaDataName.containsKey(dataName+dataCodeCheck)) &#123;</div><div class="line">                      </div><div class="line">                      <span class="keyword">if</span> (addError) &#123;</div><div class="line">                          MetadataObj.put(<span class="string">"errInfo"</span>, <span class="string">"数据项名已存在"</span>);</div><div class="line">                      &#125;</div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">                  </div><div class="line">                  String dataCode = MetadataObj.get(<span class="string">"dataCode"</span>).toString().trim();      <span class="comment">//元数据父分类编号</span></div><div class="line">                  List&lt;Map&lt;String, Object&gt;&gt; footCount = dCMatedataDao.getFootCount(dataCode);</div><div class="line">                  <span class="keyword">if</span>( footCount.size() &gt; <span class="number">0</span>)&#123;</div><div class="line">                      <span class="keyword">if</span> (addError) &#123;</div><div class="line">                          MetadataObj.put(<span class="string">"errInfo"</span>, <span class="string">"分类编码不是最后一级分类"</span>);</div><div class="line">                      &#125;</div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">                   Map&lt;String, Object&gt; typeByCode = dCMatedataDao.getMetadataTypeByCode(dataCode);</div><div class="line">                  <span class="keyword">if</span>( typeByCode == <span class="keyword">null</span> || typeByCode.size() &lt; <span class="number">1</span>)&#123;</div><div class="line">                      <span class="keyword">if</span> (addError) &#123;</div><div class="line">                          MetadataObj.put(<span class="string">"errInfo"</span>, <span class="string">"分类编码不存在，请先添加分类"</span>);</div><div class="line">                      &#125;</div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">                  <span class="comment">//校验是在添加的List中是否存在相同的数据项名或者中文简称</span></div><div class="line">                  <span class="comment">//校验导入文件中是否存在一样的中文简称或者数据项名</span></div><div class="line">                  <span class="keyword">boolean</span> nameExist = <span class="keyword">false</span>;</div><div class="line">                  <span class="keyword">boolean</span> dataNameExist = <span class="keyword">false</span>;</div><div class="line">                  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; addMetadataList.size(); j++)&#123;</div><div class="line">                      Map&lt;String, Object&gt; map2 = addMetadataList.get(j);</div><div class="line">                      String typeId = map2.get(<span class="string">"typeId"</span>).toString();</div><div class="line">                      String nameE = map2.get(<span class="string">"name"</span>).toString();</div><div class="line">                      String dataNameE = map2.get(<span class="string">"dataName"</span>).toString();</div><div class="line">                      <span class="keyword">if</span>( typeId.equals(typeByCode.get(<span class="string">"id"</span>).toString()) &amp;&amp; nameE.equals(name))&#123;</div><div class="line">                          nameExist=<span class="keyword">true</span>;</div><div class="line">                          <span class="keyword">break</span>;</div><div class="line">                      &#125;</div><div class="line">                      <span class="keyword">if</span>( typeId.equals(typeByCode.get(<span class="string">"id"</span>).toString()) &amp;&amp; dataNameE.equals(dataName))&#123;</div><div class="line">                          dataNameExist=<span class="keyword">true</span>;</div><div class="line">                          <span class="keyword">break</span>;</div><div class="line">                      &#125;</div><div class="line">                   </div><div class="line">               &#125;</div><div class="line">                  <span class="keyword">if</span>( nameExist )&#123;</div><div class="line">                      <span class="keyword">if</span> (addError) &#123;</div><div class="line">                          MetadataObj.put(<span class="string">"errInfo"</span>, <span class="string">"中文简称已存在"</span>);</div><div class="line">                      &#125;</div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">                  <span class="keyword">if</span>( dataNameExist )&#123;</div><div class="line">                      <span class="keyword">if</span> (addError) &#123;</div><div class="line">                          MetadataObj.put(<span class="string">"errInfo"</span>, <span class="string">"数据项名已存在"</span>);</div><div class="line">                      &#125;</div><div class="line">                      errorList.add(MetadataObj);</div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125;</div><div class="line">                  </div><div class="line">                 <span class="comment">//进入这里说明校验结束，开始填充添加的数据</span></div><div class="line">                  String type_id = typeByCode.get(<span class="string">"id"</span>).toString();<span class="comment">//元数据所属分类id</span></div><div class="line">                  String dataType =  MetadataObj.get(<span class="string">"dataType"</span>).toString().trim();      <span class="comment">//元数据类型</span></div><div class="line">                  String dataLength =  MetadataObj.get(<span class="string">"dataLength"</span>).toString().trim();      <span class="comment">//元数据长度</span></div><div class="line">                  String code  = <span class="string">""</span>;</div><div class="line">                  <span class="comment">////</span></div><div class="line">                  <span class="keyword">if</span>( codeMap.get(dataCode) == <span class="keyword">null</span>||StringUtil.isEmpty(codeMap.get(dataCode)) )&#123;<span class="comment">//表示当前分类不存在已经添加的元数据--因为编码map中不存在对应分类的最大编码</span></div><div class="line">                      </div><div class="line">                      Map maxCodeByPid = <span class="keyword">this</span>.selectMetadataMaxCode(type_id);</div><div class="line">                      <span class="keyword">if</span>( maxCodeByPid == <span class="keyword">null</span> )&#123;<span class="comment">//表示当前分类下不存在任何子分类</span></div><div class="line">                          code =  StringUtil.getCode(<span class="string">"0"</span>, dataCode);<span class="comment">//则从01开始编号</span></div><div class="line">                          codeMap.put(dataCode, <span class="string">"01"</span>);<span class="comment">//保存当前分类下元数据编号最大值</span></div><div class="line">                      &#125;<span class="keyword">else</span>&#123;</div><div class="line">                          String object = (String) maxCodeByPid.get(<span class="string">"codeNum"</span>);<span class="comment">//当前分类节点下的元数据的编号最大值。</span></div><div class="line">                          <span class="keyword">int</span> pSituation = object.indexOf(dataCode);</div><div class="line">                          <span class="keyword">int</span> pLength =   pSituation+dataCode.length() ;</div><div class="line">                          String substring = object.substring(pLength); <span class="comment">//截取出最大编号值得最大值</span></div><div class="line">                          code = StringUtil.getCode(substring, dataCode);</div><div class="line">                          </div><div class="line">                          <span class="keyword">int</span> temp = Integer.parseInt(substring);<span class="comment">//保存当前分类下元数据编号最大值</span></div><div class="line">                          temp+=<span class="number">1</span>;</div><div class="line">                          codeMap.put(dataCode, temp+<span class="string">""</span>);</div><div class="line">                      &#125;</div><div class="line">                  &#125;<span class="keyword">else</span>&#123;</div><div class="line">                      String maxCode = codeMap.get(dataCode);</div><div class="line">                      code = StringUtil.getCode(maxCode, dataCode);</div><div class="line">                      <span class="comment">//保存当前分类下元数据编号最大值</span></div><div class="line">                      <span class="keyword">int</span> temp = Integer.parseInt(maxCode);</div><div class="line">                      temp+=<span class="number">1</span>;</div><div class="line">                      codeMap.put(dataCode, temp+<span class="string">""</span>);</div><div class="line">                  &#125;</div><div class="line">                      </div><div class="line">                  <span class="comment">///</span></div><div class="line">                  Map&lt;String, Object&gt; metadatList = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</div><div class="line">                  metadatList.put(<span class="string">"id"</span>, metadatId);</div><div class="line">                  metadatList.put(<span class="string">"name"</span>,name);</div><div class="line">                  metadatList.put(<span class="string">"dataType"</span>,dataType);</div><div class="line">                  metadatList.put(<span class="string">"code"</span>,code);</div><div class="line">                  metadatList.put(<span class="string">"typeId"</span>,type_id);</div><div class="line">                  metadatList.put(<span class="string">"dataLength"</span>,dataLength);</div><div class="line">                  metadatList.put(<span class="string">"dataName"</span>,dataName);</div><div class="line">                  metadatList.put(<span class="string">"valueArea"</span>, MetadataObj.get(<span class="string">"valueArea"</span>)==<span class="keyword">null</span>?<span class="string">""</span>:MetadataObj.get(<span class="string">"valueArea"</span>) );</div><div class="line">                  metadatList.put(<span class="string">"dataRestrict"</span>,MetadataObj.get(<span class="string">"dataRestrict"</span>)==<span class="keyword">null</span>?<span class="string">""</span>:MetadataObj.get(<span class="string">"dataRestrict"</span>));</div><div class="line">                  metadatList.put(<span class="string">"dataRemark"</span>,MetadataObj.get(<span class="string">"dataRemark"</span>)==<span class="keyword">null</span>?<span class="string">""</span>:MetadataObj.get(<span class="string">"dataRemark"</span>));</div><div class="line">                  metadatList.put(<span class="string">"mdDate"</span>,<span class="keyword">new</span> Date());</div><div class="line">                  </div><div class="line">                  addMetadataList.add(metadatList);</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">              <span class="keyword">if</span>(addError) &#123;</div><div class="line">                  MetadataObj.put(<span class="string">"errInfo"</span>, e.getMessage());</div><div class="line">              &#125;</div><div class="line">              errorList.add(MetadataObj);</div><div class="line"></div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="comment">/*数据分析结束*/</span></div><div class="line">     <span class="comment">/*往数据库写数据开始*/</span></div><div class="line">     Connection conn=<span class="keyword">null</span>;</div><div class="line">     PreparedStatement idsUserAdd=<span class="keyword">null</span>;</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">         Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>) ;</div><div class="line">         conn = DriverManager.getConnection(ConfigTool.getProperty(<span class="string">"jdbc.url"</span>).toString() , ConfigTool.getProperty(<span class="string">"jdbc.username"</span>).toString() , ConfigTool.getProperty(<span class="string">"jdbc.password"</span>).toString());</div><div class="line">         conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">         <span class="comment">//构造预处理statement</span></div><div class="line">         idsUserAdd = conn.prepareStatement(<span class="string">"INSERT INTO dc_matedata ("</span>+</div><div class="line">       		  <span class="string">" ID,`NAME`, DATATYPE,`CODE`,TYPE_ID,`LENGTH`, "</span>+</div><div class="line">       		  <span class="string">" DATANAME, VALUEAREA,`RESTRICT`, REMARK,MD_DATE)"</span>+</div><div class="line">       		  <span class="string">" values(?,?,?,?,?,?,?,?,?,?,now())"</span>);</div><div class="line">        <span class="comment">//最大列表的数目当做循环次数</span></div><div class="line">         <span class="keyword">int</span> xhcs=addMetadataList.size();</div><div class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;xhcs;i++)&#123;</div><div class="line">                 idsUserAdd.setString(<span class="number">1</span>,addMetadataList.get(i).get(<span class="string">"id"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">2</span>,addMetadataList.get(i).get(<span class="string">"name"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">3</span>,addMetadataList.get(i).get(<span class="string">"dataType"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">4</span>,addMetadataList.get(i).get(<span class="string">"code"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">5</span>,addMetadataList.get(i).get(<span class="string">"typeId"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">6</span>,addMetadataList.get(i).get(<span class="string">"dataLength"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">7</span>,addMetadataList.get(i).get(<span class="string">"dataName"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">8</span>,addMetadataList.get(i).get(<span class="string">"valueArea"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">9</span>,addMetadataList.get(i).get(<span class="string">"dataRestrict"</span>).toString());</div><div class="line">                 idsUserAdd.setString(<span class="number">10</span>,addMetadataList.get(i).get(<span class="string">"dataRemark"</span>).toString());</div><div class="line">                 idsUserAdd.addBatch();</div><div class="line">                 </div><div class="line">             <span class="comment">//每10000次提交一次</span></div><div class="line">             <span class="keyword">if</span>(i%<span class="number">10000</span>==<span class="number">0</span>||i==xhcs-<span class="number">1</span>)&#123;<span class="comment">//可以设置不同的大小；如50，100，500，1000等等</span></div><div class="line">                 idsUserAdd.executeBatch();</div><div class="line">                 conn.commit();</div><div class="line">                 idsUserAdd.clearBatch();</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">         e.printStackTrace();</div><div class="line">         <span class="keyword">throw</span>  e;</div><div class="line">     &#125;<span class="keyword">finally</span> &#123;</div><div class="line">         <span class="keyword">try</span> &#123;</div><div class="line">             <span class="keyword">if</span>(idsUserAdd!=<span class="keyword">null</span>)</div><div class="line">                 idsUserAdd.close();</div><div class="line">             <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)</div><div class="line">                 conn.close();</div><div class="line">         &#125;<span class="keyword">catch</span>(Exception e)&#123;</div><div class="line">             e.printStackTrace();</div><div class="line">             <span class="keyword">throw</span>  e;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">     &#125;</div><div class="line">     <span class="comment">/*往数据库写数据结束*/</span></div><div class="line"></div><div class="line">      </div><div class="line">   <span class="keyword">return</span> errorList;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote>
<p>有些网友发现使用StringBuffer 来拼接入参，不通过prepareStatement的预处理，虽然前者速度很快，但是使用prepareStatement可以防止SQL注入</p>
</blockquote>
<hr>
<blockquote>
<p>有的好的建议大家都可以提出来</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;在做一个项目的时候，涉及到需要从一个表格中获取百万条数据然后插入到数据库中，最后采用JDBC的executeBan
    
    </summary>
    
      <category term="JDBC" scheme="http://kingge.top/categories/JDBC/"/>
    
    
      <category term="Mysql" scheme="http://kingge.top/tags/Mysql/"/>
    
      <category term="JDBC" scheme="http://kingge.top/tags/JDBC/"/>
    
      <category term="批量导入" scheme="http://kingge.top/tags/%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5/"/>
    
      <category term="SSM" scheme="http://kingge.top/tags/SSM/"/>
    
      <category term="项目经验" scheme="http://kingge.top/tags/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>Mysql索引详解</title>
    <link href="http://kingge.top/2016/08/01/Mysql%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3/"/>
    <id>http://kingge.top/2016/08/01/Mysql索引详解/</id>
    <published>2016-08-01T02:37:15.000Z</published>
    <updated>2017-08-17T09:35:34.792Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>索引对查询的速度有着至关重要的影响，理解索引也是进行数据库性能调优的起点。考虑如下情况，假设数据库中一个表有10^6条记录，DBMS的页面大小为4K，并存储100条记录。如果没有索引，查询将对整个表进行扫描，最坏的情况下，如果所有数据页都不在内存，需要读取10^4个页面，如果这10^4个页面在磁盘上随机分布，需要进行10^4次I/O，假设磁盘每次I/O时间为10ms(忽略数据传输时间)，则总共需要100s(但实际上要好很多很多)。如果对之建立B-Tree索引，则只需要进行log100(10^6)=3次页面读取，最坏情况下耗时30ms。这就是索引带来的效果，很多时候，当你的应用程序进行SQL查询速度很慢时，应该想想是否可以建索引。进入正题：</p>
</blockquote>
<hr>
<blockquote>
<p>有些硬啃的干货还是得了解的，下面先了解索引的基本知识</p>
</blockquote>
<h1 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h1><ul>
<li>单列索引<ul>
<li>主键索引</li>
<li>唯一索引</li>
<li>普通索引</li>
</ul>
</li>
<li>组合索引<h3 id="用到的表"><a href="#用到的表" class="headerlink" title="用到的表"></a>用到的表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`award`</span> (</div><div class="line">   <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</div><div class="line">   <span class="string">`aty_id`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'活动场景id'</span>,</div><div class="line">   <span class="string">`nickname`</span> <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'用户昵称'</span>,</div><div class="line">   <span class="string">`is_awarded`</span> tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> <span class="keyword">COMMENT</span> <span class="string">'用户是否领奖'</span>,</div><div class="line">   <span class="string">`award_time`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> <span class="keyword">COMMENT</span> <span class="string">'领奖时间'</span>,</div><div class="line">   <span class="string">`account`</span> <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'帐号'</span>,</div><div class="line">   <span class="string">`password`</span> <span class="built_in">char</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</div><div class="line">   <span class="string">`message`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'获奖信息'</span>,</div><div class="line">   <span class="string">`created_time`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</div><div class="line">   <span class="string">`updated_time`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span>,</div><div class="line">   PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line"> ) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'获奖信息表'</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="单列索引"><a href="#单列索引" class="headerlink" title="单列索引"></a>单列索引</h2><h3 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h3><blockquote>
<p>这个是最基本的索引</p>
</blockquote>
<hr>
<blockquote>
<p>创建语法：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">其sql格式是：</div><div class="line">   第一种方式 :</div><div class="line">     CREATE INDEX IndexName ON `TableName`(`字段名`(length))</div><div class="line">   第二种方式 :</div><div class="line">	 ALTER TABLE TableName ADD INDEX IndexName(`字段名`(length))</div></pre></td></tr></table></figure></p>
<p>创建例子：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">第一种方式 :</div><div class="line">  CREATE INDEX account_Index ON `award`(`account`);</div><div class="line">第二种方式:</div><div class="line">  ALTER TABLE award ADD INDEX account_Index(`account`)</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><blockquote>
<p>与普通索引类似,但是不同的是唯一索引要求所有的类的值是唯一的,这一点和主键索引一样.但是他允许有空值</p>
</blockquote>
<hr>
<blockquote>
<p>创建语法：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">其sql格式是：</div><div class="line">   第一种方式 :</div><div class="line">    CREATE UNIQUE INDEX IndexName ON `TableName`(`字段名`(length));</div><div class="line">   第二种方式 :</div><div class="line">	ALTER TABLE TableName ADD UNIQUE (column_list)</div></pre></td></tr></table></figure></p>
<p>创建例子：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE UNIQUE INDEX account_UNIQUE_Index ON `award`(`account`);</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h3><blockquote>
<p>他与唯一索引的不同在于不允许有空值(在B+TREE中的InnoDB引擎中,主键索引起到了至关重要的地位)</p>
</blockquote>
<hr>
<blockquote>
<p>创建语法：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">其sql格式是：</div><div class="line">   第一种方式 :</div><div class="line">    CREATE UNIQUE INDEX IndexName ON `TableName`(`字段名`(length));</div><div class="line">   第二种方式 :</div><div class="line">	ALTER TABLE TableName ADD UNIQUE (column_list)</div></pre></td></tr></table></figure></p>
<p>创建例子：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE UNIQUE INDEX account_UNIQUE_Index ON `award`(`account`);</div></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h3 id="单列索引的总结"><a href="#单列索引的总结" class="headerlink" title="单列索引的总结"></a>单列索引的总结</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">mysql&gt;SELECT ｀uid｀ FROM people WHERE lname｀='Liu'  AND ｀fname｀='Zhiqun' AND ｀age｀=26</div><div class="line">因为我们不想扫描整表，故考虑用索引。</div><div class="line"></div><div class="line">单列索引：</div><div class="line"><span class="function">ALTER TABLE people ADD INDEX <span class="title">lname</span> <span class="params">(lname)</span></span>;</div><div class="line">将lname列建索引，这样就把范围限制在lname='Liu'的结果集1上，之后扫描结果集1，产生满足fname='Zhiqun'的结果集2，再扫描结果集2，找到 age=26的结果集3，即最终结果。</div><div class="line"></div><div class="line">由 于建立了lname列的索引，与执行表的完全扫描相比，效率提高了很多，但我们要求扫描的记录数量仍旧远远超过了实际所需 要的。虽然我们可以删除lname列上的索引，再创建fname或者age 列的索引，但是，不论在哪个列上创建索引搜索效率仍旧相似。</div><div class="line"></div><div class="line">&gt; 所以就需要组合索引</div></pre></td></tr></table></figure>
<hr>
<h2 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h2><blockquote>
<p>一个表中含有多个单列索引不代表是组合索引,通俗一点讲 组合索引是:包含多个字段但是只有索引名称</p>
</blockquote>
<hr>
<blockquote>
<p>创建语法：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">其sql格式是：</div><div class="line"> CREATE INDEX IndexName On `TableName`(`字段名`(length),`字段名`(length),...);</div></pre></td></tr></table></figure></p>
<p>创建例子：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE INDEX nickname_account_createdTime_Index ON `award`(`nickname`, `account`, `created_time`);</div></pre></td></tr></table></figure></p>
<hr>
<blockquote>
<p>如果你建立了 <strong><em>组合索引</em></strong>(nickname_account_createdTime_Index)<strong> 那么他实际包含的是3个索引 (nickname) (nickname,account)(nickname,account,created_time)</strong></p>
</blockquote>
</blockquote>
<hr>
<h3 id="组合索引的最左前缀"><a href="#组合索引的最左前缀" class="headerlink" title="组合索引的最左前缀"></a>组合索引的最左前缀</h3><blockquote>
<p>上面的例子中给nickname,account,created_time 这三个字段建立索引他会去创建<strong>三个索引</strong>，但是在执行查询的时候只会用其中一个索引去查询，mysql会选择一个最严格(获得结果集记录数最少)的索引，所以where子句中使用最频繁的一列放在最左边。所谓最左前缀原则就是先要看第一列，在第一列满足的条件下再看左边第二列</p>
</blockquote>
<hr>
<h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><hr>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">文本字段上(text)如果建立的是普通索引,那么只有对文本的字段内容前面的字符进行索引,其字符大小根据索引建立索引时申明的大小来规定.</div><div class="line"></div><div class="line">如果文本中出现多个一样的字符,而且需要查找的话,那么其条件只能是 where column lick &apos;%xxxx%&apos; 这样做会让索引失效</div><div class="line"></div><div class="line">.这个时候全文索引就祈祷了作用了</div><div class="line"></div><div class="line">ALTER TABLE tablename ADD FULLTEXT(column1, column2)</div><div class="line">有了全文索引，就可以用SELECT查询命令去检索那些包含着一个或多个给定单词的数据记录了。</div><div class="line"></div><div class="line">ELECT * FROM tablename</div><div class="line">WHERE MATCH(column1, column2) AGAINST(‘xxx′, ‘sss′, ‘ddd′)</div><div class="line">这条命令将把column1和column2字段里有xxx、sss和ddd的数据记录全部查询出来。</div></pre></td></tr></table></figure>
<hr>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="使用索引的优点"><a href="#使用索引的优点" class="headerlink" title="使用索引的优点"></a>使用索引的优点</h2><ol>
<li>可以通过建立唯一索引或者主键索引,保证数据库表中每一行数据的唯一性.</li>
<li>建立索引可以大大提高检索的数据,以及减少表的检索行数</li>
<li>在表连接的连接条件 可以加速表与表直接的相连 </li>
<li>在分组和排序字句进行数据检索,可以减少查询时间中 分组 和 排序时所消耗的时间(数据库的记录会重新排序)</li>
<li>建立索引,在查询中使用索引 可以提高性能</li>
</ol>
<h2 id="使用索引的缺点"><a href="#使用索引的缺点" class="headerlink" title="使用索引的缺点"></a>使用索引的缺点</h2><ol>
<li>在创建索引和维护索引 会耗费时间,随着数据量的增加而增加</li>
<li>索引文件会占用物理空间,除了数据表需要占用物理空间之外,每一个索引还会占用一定的物理空间</li>
<li>当对表的数据进行 INSERT,UPDATE,DELETE 的时候,索引也要动态的维护,这样就会降低数据的维护速度,(建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快)。</li>
</ol>
<h2 id="使用索引需要注意的地方"><a href="#使用索引需要注意的地方" class="headerlink" title="使用索引需要注意的地方"></a>使用索引需要注意的地方</h2><ol>
<li><p>在经常需要搜索的列上,可以加快索引的速度</p>
</li>
<li><p>主键列上可以确保列的唯一性</p>
</li>
<li><p>在表与表的而连接条件上加上索引,可以加快连接查询的速度</p>
</li>
<li><p>在经常需要排序(order by),分组(group by)和的distinct 列上加索引 可以加快排序查询的时间,  (单独order by 用不了索引，索引考虑加where 或加limit)</p>
</li>
<li><p>在一些where 之后的 &lt; &lt;= &gt; &gt;= BETWEEN IN 以及某个情况下的like 建立字段的索引(B-TREE)</p>
</li>
<li><p>like语句的 如果你对nickname字段建立了一个索引.当查询的时候的语句是 nickname lick ‘%ABC%’ 那么这个索引讲不会起到作用.而nickname lick ‘ABC%’ 那么将可以用到索引</p>
</li>
<li><p>索引不会包含NULL列,如果列中包含NULL值都将不会被包含在索引中,复合索引中如果有一列含有NULL值那么这个组合索引都将失效,一般需要给默认值0或者 ‘ ‘字符串</p>
</li>
<li><p>使用短索引,如果你的一个字段是Char(32)或者int(32),在创建索引的时候指定前缀长度 比如前10个字符 (前提是多数值是唯一的..)那么短索引可以提高查询速度,并且可以减少磁盘的空间,也可以减少I/0操作.</p>
</li>
<li><p>不要在列上进行运算,这样会使得mysql索引失效,也会进行全表扫描</p>
</li>
<li><p>选择越小的数据类型越好,因为通常越小的数据类型通常在磁盘,内存,cpu,缓存中 占用的空间很少,处理起来更快</p>
</li>
</ol>
<h2 id="什么情况下不建立索引"><a href="#什么情况下不建立索引" class="headerlink" title="什么情况下不建立索引"></a>什么情况下不建立索引</h2><ol>
<li><p>查询中很少使用到的列 不应该创建索引,如果建立了索引然而还会降低mysql的性能和增大了空间需求.</p>
</li>
<li><p>很少数据的列也不应该建立索引,比如 一个性别字段 0或者1,在查询中,结果集的数据占了表中数据行的比例比较大,mysql需要扫描的行数很多,增加索引,并不能提高效率</p>
</li>
<li><p>定义为text和image和bit数据类型的列不应该增加索引</p>
</li>
<li><p>当表的修改(UPDATE,INSERT,DELETE)操作远远大于检索(SELECT)操作时不应该创建索引,这两个操作是互斥的关系</p>
</li>
</ol>
<h1 id="好的文章"><a href="#好的文章" class="headerlink" title="好的文章"></a>好的文章</h1><p><a href="http://blog.csdn.net/zly9923218/article/details/51007554" target="_blank" rel="external">转：SQL优化</a><br><a href="http://blog.jobbole.com/86594/" target="_blank" rel="external">转：MySQL索引原理及慢查询优化</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;索引对查询的速度有着至关重要的影响，理解索引也是进行数据库性能调优的起点。考虑如下情况，假设数据库中一个表有10^
    
    </summary>
    
      <category term="Mysql" scheme="http://kingge.top/categories/Mysql/"/>
    
    
      <category term="Mysql" scheme="http://kingge.top/tags/Mysql/"/>
    
      <category term="索引" scheme="http://kingge.top/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>C++文件流操作的读与写</title>
    <link href="http://kingge.top/2014/11/08/C-%E6%96%87%E4%BB%B6%E6%B5%81%E6%93%8D%E4%BD%9C%E7%9A%84%E8%AF%BB%E4%B8%8E%E5%86%99/"/>
    <id>http://kingge.top/2014/11/08/C-文件流操作的读与写/</id>
    <published>2014-11-08T13:04:00.000Z</published>
    <updated>2017-08-17T06:33:56.710Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对文件的写入"><a href="#对文件的写入" class="headerlink" title="对文件的写入"></a>对文件的写入</h1><h2 id="put和-lt-lt-写入方式"><a href="#put和-lt-lt-写入方式" class="headerlink" title="put和&lt;&lt; 写入方式"></a>put和&lt;&lt; 写入方式</h2><ul>
<li>put的操作：是对文件进行写入的操作，写入一个字符（可以使字母也可以是asci码值）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">file.put(<span class="string">'   A'</span>);</div><div class="line">file.put(<span class="string">'\n'</span>);</div><div class="line">file &lt;&lt; <span class="string">"xiezejing1994"</span>;</div></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>输出： &nbsp;&nbsp;&nbsp;&nbsp;A// 注意到A这里有几个空格 但是不影响左对齐<br>xiezejing1994// 也就是说A的前面不会有空格</p>
</blockquote>
<p>##操作和&lt;&lt; 读写方式区别</p>
<blockquote>
<p>put操作和 file &lt;&lt;‘A’这个基本上是一样的，但是有个区别就是他不可以这样file &lt;&lt;’  A’;（A的前面有空格）因为他是格式化输入 所以中间不能有”空格“<br>但是这样file &lt;&lt;”‘       A”;（也就是以字符串的格式输入则会有空格）</p>
</blockquote>
<hr>
<h1 id="文件的读操作"><a href="#文件的读操作" class="headerlink" title="文件的读操作"></a>文件的读操作</h1><h2 id="1-getline（）"><a href="#1-getline（）" class="headerlink" title="1.getline（）"></a>1.getline（）</h2><blockquote>
<p>getline（ cin ，string类型 ）<br> getline( cin, z );<br>  file1 &lt;&lt; z;  （file1 为文件流对象）</p>
</blockquote>
<hr>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">例子：</div><div class="line"> char c[100];</div><div class="line"></div><div class="line"> while ( !file.eof() )</div><div class="line"> &#123;</div><div class="line">  file.getline( c,100 );</div><div class="line">  cout &lt;&lt; c;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">假设文件1.txt内有'       A</div><div class="line">                 xiezejing1994  这样文本</div><div class="line"></div><div class="line">它的输出：'       Axiezejing1994  也就是说他没有读到换行的功能</div><div class="line"> 不会输出'       A</div><div class="line">         xiezejing1994（原因就是getlibe其实里面有三个参数，第三个参数默认为<span class="string">'\n'</span>）</div></pre></td></tr></table></figure>
<h2 id="2-getline（-fstream，string-）"><a href="#2-getline（-fstream，string-）" class="headerlink" title="2.getline（ fstream，string ）"></a>2.getline（ fstream，string ）</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">while</span> ( getline( file,z ) )</div><div class="line">&#123;</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; z;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-get（）"><a href="#3-get（）" class="headerlink" title="3.get（）"></a>3.get（）</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">char</span> c[<span class="number">100</span>];</div><div class="line"></div><div class="line"> <span class="keyword">while</span> ( !file.eof() )</div><div class="line"> &#123;</div><div class="line">  <span class="comment">//file.getline( c,100 ,'\0');</span></div><div class="line">  file.get( c,<span class="number">100</span> ,<span class="string">'\0'</span>);</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; c;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">输出同getline一样</div><div class="line">----必须要写三个参数 否则只会输出一行（第三个参数为<span class="string">'\n'</span>也是只会输出一行）。非常严格的输出。</div></pre></td></tr></table></figure>
<h2 id="4-get操作"><a href="#4-get操作" class="headerlink" title="4.get操作"></a>4.get操作</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">char</span> c;</div><div class="line"> file.get(c);</div><div class="line"> <span class="keyword">while</span> ( !file.eof() )</div><div class="line"> &#123;</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; c;</div><div class="line">  file.get(c);</div><div class="line">  </div><div class="line"> &#125;</div><div class="line">-----和getline的区别在于 他是读取单个字符的，所以会读取到结束符号</div><div class="line">故会输出</div><div class="line">'       A</div><div class="line">xiezejing1994</div></pre></td></tr></table></figure>
<h1 id="对文件是否读到末尾的判断"><a href="#对文件是否读到末尾的判断" class="headerlink" title="对文件是否读到末尾的判断"></a>对文件是否读到末尾的判断</h1><h1 id="1-feof（）"><a href="#1-feof（）" class="headerlink" title="1.feof（）"></a>1.feof（）</h1><blockquote>
<p>该函数只有“已经读取了”结束标志时 feof（）才会返回非零值  也就是说当文件读取到文件结束标志位时他的返回值不是非零还是零 故还要在进行一次读.</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">例子 假设在<span class="number">1.</span>txt中只有abc三个字符</div><div class="line">在进行 </div><div class="line"><span class="keyword">while</span>（！feof(fp)）</div><div class="line"> &#123;</div><div class="line">   ch = getc(fp);</div><div class="line">   <span class="built_in">putchar</span>(ch);</div><div class="line">  </div><div class="line"> &#125;<span class="comment">//实际上输出的是四个字符</span></div><div class="line"></div><div class="line">改为</div><div class="line">ch = getc（fp）；</div><div class="line"><span class="keyword">while</span> （ ！feof（fp））</div><div class="line">&#123;</div><div class="line">   <span class="built_in">putchar</span>（ch）；</div><div class="line">   ch = getc（fp）；</div><div class="line">&#125;<span class="comment">// 这样就可以正常运行</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="number">3.</span> 可以不调用函数eof 直接就是 </div><div class="line"><span class="keyword">while</span> （ file ） <span class="comment">// file 就是文件流的对象</span></div><div class="line">&#123;</div><div class="line"> 。。。。操作</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="number">4.</span></div><div class="line"><span class="keyword">char</span> c[<span class="number">100</span>];</div><div class="line"></div><div class="line"> <span class="keyword">while</span> ( !file.eof() )</div><div class="line"> &#123;</div><div class="line">  file.getline( c,<span class="number">100</span> ,<span class="string">'\0'</span>);</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; c;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">这个 和</div><div class="line"><span class="keyword">char</span> c[<span class="number">100</span>];</div><div class="line"></div><div class="line"> <span class="keyword">while</span> ( !file.eof() )</div><div class="line"> &#123;</div><div class="line">  file.getline( c,<span class="number">100</span> ,<span class="string">'\n'</span>);</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; c;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">假设文本为上面的。</div><div class="line">输出分别为'       A</div><div class="line">          xiezejing1994</div><div class="line"></div><div class="line"></div><div class="line">'       Axiezejing1994</div></pre></td></tr></table></figure>
<h1 id="读写"><a href="#读写" class="headerlink" title="读写"></a>读写</h1><h2 id="1-read-数组名，接收的个数"><a href="#1-read-数组名，接收的个数" class="headerlink" title="1.read( 数组名，接收的个数 )"></a>1.read( 数组名，接收的个数 )</h2><h2 id="2-write-数组名，gcount函数"><a href="#2-write-数组名，gcount函数" class="headerlink" title="2.write( 数组名，gcount函数  )"></a>2.write( 数组名，gcount函数  )</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line"> <span class="function">ifstream <span class="title">file</span><span class="params">( <span class="string">"D:\\jjj.txt"</span>)</span></span>;</div><div class="line"> <span class="function">ofstream <span class="title">file1</span><span class="params">( <span class="string">"D:\\j.txt"</span> , ios::app)</span></span>;</div><div class="line"> <span class="built_in">string</span> z;</div><div class="line"></div><div class="line"> <span class="keyword">if</span> ( !file )</div><div class="line"> &#123;</div><div class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">" 无法打开\n "</span>;</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> <span class="keyword">char</span> c[<span class="number">100</span>];</div><div class="line"> </div><div class="line"> </div><div class="line"> <span class="keyword">while</span> ( !file.eof() )</div><div class="line"> &#123;</div><div class="line">  file.read( c,<span class="number">100</span>  );</div><div class="line">  file1.write( c, file.gcount() );</div><div class="line"></div><div class="line"> &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"></div><div class="line"> file.close();</div><div class="line"> file.close();</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>判断打开是否正确<strong><strong><strong>**</strong></strong></strong></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="number">1.</span> <span class="keyword">if</span>( !file )</div><div class="line"><span class="number">2.</span><span class="keyword">if</span> ( !file.good() )</div><div class="line"> &#123;</div><div class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">" 无法打开\n "</span>;</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="number">3.</span></div><div class="line"> <span class="keyword">if</span> ( !file.is_open() )</div><div class="line"> &#123;</div><div class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">" 无法打开\n "</span>;</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="number">4.</span> <span class="keyword">if</span> ( file.fail() )</div><div class="line"> &#123;</div><div class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">" 无法打开\n "</span>;</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;对文件的写入&quot;&gt;&lt;a href=&quot;#对文件的写入&quot; class=&quot;headerlink&quot; title=&quot;对文件的写入&quot;&gt;&lt;/a&gt;对文件的写入&lt;/h1&gt;&lt;h2 id=&quot;put和-lt-lt-写入方式&quot;&gt;&lt;a href=&quot;#put和-lt-lt-写入方式&quot; class
    
    </summary>
    
      <category term="c++" scheme="http://kingge.top/categories/c/"/>
    
    
      <category term="文件" scheme="http://kingge.top/tags/%E6%96%87%E4%BB%B6/"/>
    
      <category term="C++" scheme="http://kingge.top/tags/C/"/>
    
      <category term="文件读写" scheme="http://kingge.top/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/"/>
    
  </entry>
  
  <entry>
    <title>文章例子</title>
    <link href="http://kingge.top/2013/12/02/ceshi/"/>
    <id>http://kingge.top/2013/12/02/ceshi/</id>
    <published>2013-12-02T07:30:16.000Z</published>
    <updated>2017-08-16T02:36:44.437Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>使用github pages服务搭建博客的好处有：</p>
<ol>
<li>全是静态文件，访问速度快；</li>
<li>免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；</li>
<li>可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；</li>
</ol>
<a id="more"></a>
<ol>
<li>数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；</li>
<li>博客内容可以轻松打包、转移、发布到其它平台；</li>
<li>等等；</li>
</ol>
]]></content>
    
    <summary type="html">
    
      附加一段文章摘要，字数最好在140字以内，会出现在meta的description里面
    
    </summary>
    
      <category term="默认分类" scheme="http://kingge.top/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="tag1" scheme="http://kingge.top/tags/tag1/"/>
    
      <category term="tag2" scheme="http://kingge.top/tags/tag2/"/>
    
      <category term="tag3" scheme="http://kingge.top/tags/tag3/"/>
    
  </entry>
  
</feed>
